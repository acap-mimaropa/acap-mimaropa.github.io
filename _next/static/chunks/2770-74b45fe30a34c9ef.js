"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2770],{42770:function(i,e,n){var a=n(85893),t=n(67294),l=n(60990),c=n(51015),s=n(60762),r=n(71919),o=n(26541),d=n(76592),u=n(19827),h=n(8863),p=n(25026),m=n(70360),x=n(46577),j=n(93454),y=n(52857),v=n(54453),Z=n(64563),f=n(34279),g=n(97182),b=n(44723),w=n(96788),C=n(84166),S=n(18853);e.Z=function(){var i;let e=(0,S.aC)(),n=null==e?void 0:e.user,k="https://acap-mimaropa-server.onrender.com/api",[z,P]=(0,t.useState)([]),[N,F]=(0,t.useState)(!1),[A,M]=(0,t.useState)(""),[T,O]=(0,t.useState)(""),[B,E]=(0,t.useState)(""),[J,W]=(0,t.useState)({}),[_,D]=(0,t.useState)(null),[I,q]=(0,t.useState)(null),[G,H]=(0,t.useState)(null),[K,L]=(0,t.useState)(""),Q=(0,t.useCallback)(()=>(null==n?void 0:n.accessToken)?n.accessToken:null,[n]),R=(0,t.useCallback)(async()=>{try{F(!0),M("");let i=Q(),e=await fetch("".concat(k,"/admin/provinces-municipalities?ts=").concat(Date.now()),{headers:i?{Authorization:"Bearer ".concat(i)}:{}}),n=await e.json();200===n.status?P(n.data||[]):M(n.error||"Failed to fetch data")}catch(i){M(i.message||"Failed to fetch data")}finally{F(!1)}},[Q]);(0,t.useEffect)(()=>{R()},[R]);let U=async()=>{if(!B.trim()){M("Province name cannot be empty");return}try{F(!0);let i=Q(),e={"Content-Type":"application/json",...i&&{Authorization:"Bearer ".concat(i)}},n=await fetch("".concat(k,"/admin/provinces-municipalities/add-province"),{method:"POST",headers:e,body:JSON.stringify({province:B})}),a=await n.json();200===a.status?(O("Province added successfully"),E(""),R()):M(a.error||"Failed to add province")}catch(i){M(i.message||"Failed to add province")}finally{F(!1)}},V=async i=>{if(window.confirm("Are you sure you want to delete ".concat(i," and all its municipalities?")))try{F(!0);let e=Q(),n={"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}},a=await fetch("".concat(k,"/admin/provinces-municipalities/delete-province"),{method:"POST",headers:n,body:JSON.stringify({province:i})}),t=await a.json();200===t.status?(O("Province deleted successfully"),D(null),R()):M(t.error||"Failed to delete province")}catch(i){M(i.message||"Failed to delete province")}finally{F(!1)}},X=async i=>{let e=J[i];if(!e||!e.trim()){M("Municipality name cannot be empty");return}F(!0);try{let n=Q(),a={"Content-Type":"application/json",...n&&{Authorization:"Bearer ".concat(n)}},t=await fetch("".concat(k,"/admin/provinces-municipalities/add-municipality"),{method:"POST",headers:a,body:JSON.stringify({province:i,municipality:e})}),l=await t.json();200===l.status?(O("Municipality added successfully"),W({...J,[i]:""}),await R()):M(l.error||"Failed to add municipality")}catch(i){M(i.message||"Failed to add municipality")}finally{F(!1)}},Y=async(i,e)=>{if(window.confirm("Are you sure you want to delete ".concat(e,"?"))){F(!0);try{let n=Q(),a={"Content-Type":"application/json",...n&&{Authorization:"Bearer ".concat(n)}},t=await fetch("".concat(k,"/admin/provinces-municipalities/delete-municipality"),{method:"POST",headers:a,body:JSON.stringify({province:i,municipality:e})}),l=await t.json();200===l.status?(O("Municipality deleted successfully"),await R()):M(l.error||"Failed to delete municipality")}catch(i){M(i.message||"Failed to delete municipality")}finally{F(!1)}}},$=async i=>{if(!K.trim()){M("Province name cannot be empty");return}try{F(!0);let e=Q(),n={"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}},a=await fetch("".concat(k,"/admin/provinces-municipalities/edit-province"),{method:"POST",headers:n,body:JSON.stringify({province:i,newProvinceName:K})}),t=await a.json();200===t.status?(O("Province renamed successfully"),q(null),L(""),R()):M(t.error||"Failed to edit province")}catch(i){M(i.message||"Failed to edit province")}finally{F(!1)}},ii=async(i,e)=>{if(!K.trim()){M("Municipality name cannot be empty");return}F(!0);try{let n=Q(),a={"Content-Type":"application/json",...n&&{Authorization:"Bearer ".concat(n)}},t=await fetch("".concat(k,"/admin/provinces-municipalities/edit-municipality"),{method:"POST",headers:a,body:JSON.stringify({province:i,municipality:e,newMunicipalityName:K})}),l=await t.json();200===l.status?(O("Municipality renamed successfully"),H(null),L(""),await R()):M(l.error||"Failed to edit municipality")}catch(i){M(i.message||"Failed to edit municipality")}finally{F(!1)}};return(0,a.jsxs)(l.Z,{sx:{p:2},children:[(0,a.jsx)(w.Z,{variant:"h6",sx:{mb:2},children:"Manage Provinces & Municipalities"}),A&&(0,a.jsx)(b.Z,{severity:"error",sx:{mb:2},children:A}),T&&(0,a.jsx)(b.Z,{severity:"success",sx:{mb:2},children:T}),N&&(0,a.jsx)(g.Z,{}),!N&&(0,a.jsxs)(C.Z,{spacing:3,children:[(0,a.jsx)(s.Z,{children:(0,a.jsxs)(r.Z,{children:[(0,a.jsx)(w.Z,{variant:"h6",sx:{mb:2},children:"Add New Province"}),(0,a.jsxs)(C.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(o.Z,{label:"Province Name",value:B,onChange:i=>E(i.target.value),size:"small",fullWidth:!0}),(0,a.jsx)(c.Z,{variant:"contained",startIcon:(0,a.jsx)(Z.Z,{}),onClick:U,disabled:N,children:"Add"})]})]})}),(0,a.jsx)(p.Z,{component:j.Z,children:(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(m.Z,{children:(0,a.jsxs)(x.Z,{sx:{backgroundColor:"#f5f5f5"},children:[(0,a.jsx)(h.Z,{children:(0,a.jsx)("strong",{children:"Province"})}),(0,a.jsx)(h.Z,{align:"center",children:(0,a.jsx)("strong",{children:"Municipalities Count"})}),(0,a.jsx)(h.Z,{align:"right",children:(0,a.jsx)("strong",{children:"Actions"})})]})}),(0,a.jsx)(u.Z,{children:z.map(i=>(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(h.Z,{onClick:()=>D(_===i.province?null:i.province),sx:{cursor:"pointer",fontWeight:_===i.province?"bold":"normal"},children:i.province}),(0,a.jsx)(h.Z,{align:"center",children:i.municipalities.length}),(0,a.jsxs)(h.Z,{align:"right",children:[(0,a.jsx)(y.Z,{size:"small",color:"primary",onClick:()=>{q(i.province),L(i.province)},disabled:N,title:"Edit",children:(0,a.jsx)(f.Z,{fontSize:"small"})}),(0,a.jsx)(y.Z,{size:"small",color:"error",onClick:()=>V(i.province),disabled:N,title:"Delete",children:(0,a.jsx)(v.Z,{fontSize:"small"})})]})]},i.province))})]})}),I&&(0,a.jsx)(s.Z,{sx:{backgroundColor:"#f0f7ff",border:"2px solid #2196F3"},children:(0,a.jsxs)(r.Z,{children:[(0,a.jsx)(w.Z,{variant:"h6",sx:{mb:2},children:"Edit Province"}),(0,a.jsxs)(C.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(o.Z,{label:"New Province Name",value:K,onChange:i=>L(i.target.value),size:"small",fullWidth:!0}),(0,a.jsx)(c.Z,{variant:"contained",color:"primary",onClick:()=>$(I),disabled:N,children:"Save"}),(0,a.jsx)(c.Z,{variant:"outlined",onClick:()=>{q(null),L("")},disabled:N,children:"Cancel"})]})]})}),_&&(0,a.jsx)(s.Z,{children:(0,a.jsxs)(r.Z,{children:[(0,a.jsxs)(w.Z,{variant:"h6",sx:{mb:2},children:[_," - Municipalities"]}),(0,a.jsxs)(C.Z,{spacing:2,children:[(0,a.jsxs)(C.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(o.Z,{label:"New Municipality",value:J[_]||"",onChange:i=>W({...J,[_]:i.target.value}),size:"small",fullWidth:!0}),(0,a.jsx)(c.Z,{variant:"contained",startIcon:(0,a.jsx)(Z.Z,{}),onClick:()=>X(_),disabled:N,children:"Add"})]}),(0,a.jsx)(p.Z,{component:j.Z,children:(0,a.jsxs)(d.Z,{size:"small",children:[(0,a.jsx)(m.Z,{children:(0,a.jsxs)(x.Z,{sx:{backgroundColor:"#f5f5f5"},children:[(0,a.jsx)(h.Z,{children:(0,a.jsx)("strong",{children:"Municipality"})}),(0,a.jsx)(h.Z,{align:"right",children:(0,a.jsx)("strong",{children:"Action"})})]})}),(0,a.jsx)(u.Z,{children:((null===(i=z.find(i=>i.province===_))||void 0===i?void 0:i.municipalities)||[]).map(i=>(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(h.Z,{children:i}),(0,a.jsxs)(h.Z,{align:"right",children:[(0,a.jsx)(y.Z,{size:"small",color:"primary",onClick:()=>{H({province:_,municipality:i}),L(i)},disabled:N,title:"Edit",children:(0,a.jsx)(f.Z,{fontSize:"small"})}),(0,a.jsx)(y.Z,{size:"small",color:"error",onClick:()=>Y(_,i),disabled:N,title:"Delete",children:(0,a.jsx)(v.Z,{fontSize:"small"})})]})]},i))})]})}),(null==G?void 0:G.province)===_&&(0,a.jsx)(s.Z,{sx:{backgroundColor:"#f0f7ff",border:"2px solid #2196F3"},children:(0,a.jsxs)(r.Z,{children:[(0,a.jsx)(w.Z,{variant:"h6",sx:{mb:2},children:"Edit Municipality"}),(0,a.jsxs)(C.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(o.Z,{label:"New Municipality Name",value:K,onChange:i=>L(i.target.value),size:"small",fullWidth:!0}),(0,a.jsx)(c.Z,{variant:"contained",color:"primary",onClick:()=>ii(G.province,G.municipality),disabled:N,children:"Save"}),(0,a.jsx)(c.Z,{variant:"outlined",onClick:()=>{H(null),L("")},disabled:N,children:"Cancel"})]})]})})]})]})})]})]})}}}]);