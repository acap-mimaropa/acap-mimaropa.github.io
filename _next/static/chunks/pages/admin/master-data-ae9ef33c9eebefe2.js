(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5304],{78918:function(e,i,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/master-data",function(){return n(92405)}])},92405:function(e,i,n){"use strict";n.r(i),n.d(i,{default:function(){return _}});var a=n(85893),t=n(65328),l=n(45773),c=n(88607),s=n(28907),r=n(60990),o=n(96788),d=n(67294),u=n(52224),h=n(13311),p=n(51015),m=n(60762),x=n(71919),j=n(26541),y=n(76592),f=n(19827),Z=n(8863),v=n(25026),g=n(70360),b=n(46577),w=n(93454),C=n(52857),S=n(54453),k=n(64563),N=n(34279),P=n(97182),z=n(44723),M=n(84166),F=n(18853),T=function(){var e;let i=(0,F.aC)(),n=null==i?void 0:i.user,t="https://acap-mimaropa-server.onrender.com/api",[l,c]=(0,d.useState)([]),[s,u]=(0,d.useState)(!1),[T,A]=(0,d.useState)(""),[O,_]=(0,d.useState)(""),[E,B]=(0,d.useState)(""),[D,J]=(0,d.useState)({}),[W,I]=(0,d.useState)(null),[L,X]=(0,d.useState)(null),[R,U]=(0,d.useState)(null),[q,G]=(0,d.useState)(""),H=(0,d.useCallback)(()=>(null==n?void 0:n.accessToken)?n.accessToken:null,[n]),K=(0,d.useCallback)(async()=>{try{u(!0),A("");let e=H(),i=await fetch("".concat(t,"/admin/provinces-municipalities?ts=").concat(Date.now()),{headers:e?{Authorization:"Bearer ".concat(e)}:{}}),n=await i.json();200===n.status?c(n.data||[]):A(n.error||"Failed to fetch data")}catch(e){A(e.message||"Failed to fetch data")}finally{u(!1)}},[H,t]);(0,d.useEffect)(()=>{K()},[K]);let Q=async()=>{if(!E.trim()){A("Province name cannot be empty");return}try{u(!0);let e=H(),i={"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}},n=await fetch("".concat(t,"/admin/provinces-municipalities/add-province"),{method:"POST",headers:i,body:JSON.stringify({province:E})}),a=await n.json();200===a.status?(_("Province added successfully"),B(""),K()):A(a.error||"Failed to add province")}catch(e){A(e.message||"Failed to add province")}finally{u(!1)}},V=async e=>{if(window.confirm("Are you sure you want to delete ".concat(e," and all its municipalities?")))try{u(!0);let i=H(),n={"Content-Type":"application/json",...i&&{Authorization:"Bearer ".concat(i)}},a=await fetch("".concat(t,"/admin/provinces-municipalities/delete-province"),{method:"POST",headers:n,body:JSON.stringify({province:e})}),l=await a.json();200===l.status?(_("Province deleted successfully"),I(null),K()):A(l.error||"Failed to delete province")}catch(e){A(e.message||"Failed to delete province")}finally{u(!1)}},Y=async e=>{let i=D[e];if(!i||!i.trim()){A("Municipality name cannot be empty");return}u(!0);try{let n=H(),a={"Content-Type":"application/json",...n&&{Authorization:"Bearer ".concat(n)}},l=await fetch("".concat(t,"/admin/provinces-municipalities/add-municipality"),{method:"POST",headers:a,body:JSON.stringify({province:e,municipality:i})}),c=await l.json();200===c.status?(_("Municipality added successfully"),J({...D,[e]:""}),await K()):A(c.error||"Failed to add municipality")}catch(e){A(e.message||"Failed to add municipality")}finally{u(!1)}},$=async(e,i)=>{if(window.confirm("Are you sure you want to delete ".concat(i,"?"))){u(!0);try{let n=H(),a={"Content-Type":"application/json",...n&&{Authorization:"Bearer ".concat(n)}},l=await fetch("".concat(t,"/admin/provinces-municipalities/delete-municipality"),{method:"POST",headers:a,body:JSON.stringify({province:e,municipality:i})}),c=await l.json();200===c.status?(_("Municipality deleted successfully"),await K()):A(c.error||"Failed to delete municipality")}catch(e){A(e.message||"Failed to delete municipality")}finally{u(!1)}}},ee=async e=>{if(!q.trim()){A("Province name cannot be empty");return}try{u(!0);let i=H(),n={"Content-Type":"application/json",...i&&{Authorization:"Bearer ".concat(i)}},a=await fetch("".concat(t,"/admin/provinces-municipalities/edit-province"),{method:"POST",headers:n,body:JSON.stringify({province:e,newProvinceName:q})}),l=await a.json();200===l.status?(_("Province renamed successfully"),X(null),G(""),K()):A(l.error||"Failed to edit province")}catch(e){A(e.message||"Failed to edit province")}finally{u(!1)}},ei=async(e,i)=>{if(!q.trim()){A("Municipality name cannot be empty");return}u(!0);try{let n=H(),a={"Content-Type":"application/json",...n&&{Authorization:"Bearer ".concat(n)}},l=await fetch("".concat(t,"/admin/provinces-municipalities/edit-municipality"),{method:"POST",headers:a,body:JSON.stringify({province:e,municipality:i,newMunicipalityName:q})}),c=await l.json();200===c.status?(_("Municipality renamed successfully"),U(null),G(""),await K()):A(c.error||"Failed to edit municipality")}catch(e){A(e.message||"Failed to edit municipality")}finally{u(!1)}};return(0,a.jsxs)(r.Z,{sx:{p:2},children:[(0,a.jsx)(o.Z,{variant:"h6",sx:{mb:2},children:"Manage Provinces & Municipalities"}),T&&(0,a.jsx)(z.Z,{severity:"error",sx:{mb:2},children:T}),O&&(0,a.jsx)(z.Z,{severity:"success",sx:{mb:2},children:O}),s&&(0,a.jsx)(P.Z,{}),!s&&(0,a.jsxs)(M.Z,{spacing:3,children:[(0,a.jsx)(m.Z,{children:(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(o.Z,{variant:"h6",sx:{mb:2},children:"Add New Province"}),(0,a.jsxs)(M.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(j.Z,{label:"Province Name",value:E,onChange:e=>B(e.target.value),size:"small",fullWidth:!0}),(0,a.jsx)(p.Z,{variant:"contained",startIcon:(0,a.jsx)(k.Z,{}),onClick:Q,disabled:s,children:"Add"})]})]})}),(0,a.jsx)(v.Z,{component:w.Z,children:(0,a.jsxs)(y.Z,{children:[(0,a.jsx)(g.Z,{children:(0,a.jsxs)(b.Z,{sx:{backgroundColor:"#f5f5f5"},children:[(0,a.jsx)(Z.Z,{children:(0,a.jsx)("strong",{children:"Province"})}),(0,a.jsx)(Z.Z,{align:"center",children:(0,a.jsx)("strong",{children:"Municipalities Count"})}),(0,a.jsx)(Z.Z,{align:"right",children:(0,a.jsx)("strong",{children:"Actions"})})]})}),(0,a.jsx)(f.Z,{children:l.map(e=>(0,a.jsxs)(b.Z,{children:[(0,a.jsx)(Z.Z,{onClick:()=>I(W===e.label?null:e.label),sx:{cursor:"pointer",fontWeight:W===e.label?"bold":"normal"},children:(0,h.c)(e.label)}),(0,a.jsx)(Z.Z,{align:"center",children:(e.municipalities||[]).length}),(0,a.jsxs)(Z.Z,{align:"right",children:[(0,a.jsx)(C.Z,{size:"small",color:"primary",onClick:()=>{X(e.label),G(e.label)},disabled:s,title:"Edit",children:(0,a.jsx)(N.Z,{fontSize:"small"})}),(0,a.jsx)(C.Z,{size:"small",color:"error",onClick:()=>V(e.label),disabled:s,title:"Delete",children:(0,a.jsx)(S.Z,{fontSize:"small"})})]})]},e.label||e.id))})]})}),L&&(0,a.jsx)(m.Z,{sx:{backgroundColor:"#f0f7ff",border:"2px solid #2196F3"},children:(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(o.Z,{variant:"h6",sx:{mb:2},children:"Edit Province"}),(0,a.jsxs)(M.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(j.Z,{label:"New Province Name",value:q,onChange:e=>G(e.target.value),size:"small",fullWidth:!0}),(0,a.jsx)(p.Z,{variant:"contained",color:"primary",onClick:()=>ee(L),disabled:s,children:"Save"}),(0,a.jsx)(p.Z,{variant:"outlined",onClick:()=>{X(null),G("")},disabled:s,children:"Cancel"})]})]})}),W&&(0,a.jsx)(m.Z,{children:(0,a.jsxs)(x.Z,{children:[(0,a.jsxs)(o.Z,{variant:"h6",sx:{mb:2},children:[W," - Municipalities"]}),(0,a.jsxs)(M.Z,{spacing:2,children:[(0,a.jsxs)(M.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(j.Z,{label:"New Municipality",value:D[W]||"",onChange:e=>J({...D,[W]:e.target.value}),size:"small",fullWidth:!0}),(0,a.jsx)(p.Z,{variant:"contained",startIcon:(0,a.jsx)(k.Z,{}),onClick:()=>Y(W),disabled:s,children:"Add"})]}),(0,a.jsx)(v.Z,{component:w.Z,children:(0,a.jsxs)(y.Z,{size:"small",children:[(0,a.jsx)(g.Z,{children:(0,a.jsxs)(b.Z,{sx:{backgroundColor:"#f5f5f5"},children:[(0,a.jsx)(Z.Z,{children:(0,a.jsx)("strong",{children:"Municipality"})}),(0,a.jsx)(Z.Z,{align:"right",children:(0,a.jsx)("strong",{children:"Action"})})]})}),(0,a.jsx)(f.Z,{children:((null===(e=l.find(e=>e.label===W))||void 0===e?void 0:e.municipalities)||[]).map(e=>{let i="object"==typeof e&&null!==e?e.label:e,n=(0,h.c)(i);return(0,a.jsxs)(b.Z,{children:[(0,a.jsx)(Z.Z,{children:n}),(0,a.jsxs)(Z.Z,{align:"right",children:[(0,a.jsx)(C.Z,{size:"small",color:"primary",onClick:()=>{U({province:W,municipality:i}),G(i)},disabled:s,title:"Edit",children:(0,a.jsx)(N.Z,{fontSize:"small"})}),(0,a.jsx)(C.Z,{size:"small",color:"error",onClick:()=>$(W,i),disabled:s,title:"Delete",children:(0,a.jsx)(S.Z,{fontSize:"small"})})]})]},i)})})]})}),(null==R?void 0:R.province)===W&&(0,a.jsx)(m.Z,{sx:{backgroundColor:"#f0f7ff",border:"2px solid #2196F3"},children:(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(o.Z,{variant:"h6",sx:{mb:2},children:"Edit Municipality"}),(0,a.jsxs)(M.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(j.Z,{label:"New Municipality Name",value:q,onChange:e=>G(e.target.value),size:"small",fullWidth:!0}),(0,a.jsx)(p.Z,{variant:"contained",color:"primary",onClick:()=>ei(R.province,R.municipality),disabled:s,children:"Save"}),(0,a.jsx)(p.Z,{variant:"outlined",onClick:()=>{U(null),G("")},disabled:s,children:"Cancel"})]})]})})]})]})})]})]})},A=function(){let[e,i]=(0,d.useState)(0);return(0,a.jsxs)(r.Z,{sx:{p:2},children:[(0,a.jsx)(o.Z,{variant:"h5",sx:{mb:2},children:(0,a.jsx)("strong",{children:"Master Data Management"})}),(0,a.jsxs)(c.Z,{value:e,onChange:(e,n)=>i(n),children:[(0,a.jsx)(s.Z,{label:"Crops Management"}),(0,a.jsx)(s.Z,{label:"Province & Municipality Management"})]}),(0,a.jsxs)(r.Z,{sx:{mt:3},children:[0===e&&(0,a.jsx)(u.Z,{}),1===e&&(0,a.jsx)(T,{})]})]})},O=n(98813),_=(0,t.Z)(function(e){let{loading:i,user:n,onBtnLogoutClick:t}=e;return(0,a.jsx)(l.Z,{loading:i,user:n,onBtnLogoutClick:t,accLevel:O.DW.ADMIN,children:(0,a.jsx)(A,{})})})},13311:function(e,i,n){"use strict";function a(e){if(!e)return"";try{return decodeURIComponent(escape(e))}catch(i){return e.replace(/Ã±/g,"\xf1").replace(/Ã‘/g,"\xd1").replace(/Ã¡/g,"\xe1").replace(/Ã©/g,"\xe9").replace(/Ã³/g,"\xf3").replace(/Ã­/g,"\xed").replace(/Ã¼/g,"\xfc").replace(/Ã/g,"\xed")}}n.d(i,{c:function(){return a}})}},function(e){e.O(0,[3153,7023,3745,1664,6541,8848,6294,1626,9998,4723,3338,3539,7864,5719,8591,2224,2888,9774,179],function(){return e(e.s=78918)}),_N_E=e.O()}]);