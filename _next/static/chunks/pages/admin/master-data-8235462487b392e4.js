(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5304],{78918:function(i,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/master-data",function(){return n(92405)}])},92405:function(i,e,n){"use strict";n.r(e),n.d(e,{default:function(){return O}});var a=n(85893),t=n(65328),l=n(45773),s=n(88607),c=n(28907),r=n(60990),o=n(96788),d=n(67294),u=n(52224),h=n(51015),p=n(60762),m=n(71919),x=n(26541),j=n(76592),y=n(19827),v=n(8863),Z=n(25026),f=n(70360),g=n(46577),b=n(93454),w=n(52857),C=n(54453),S=n(64563),k=n(34279),N=n(97182),P=n(44723),z=n(84166),M=n(18853),F=function(){var i;let e=(0,M.aC)(),n=null==e?void 0:e.user,t="https://acap-mimaropa-server.onrender.com/api",[l,s]=(0,d.useState)([]),[c,u]=(0,d.useState)(!1),[F,T]=(0,d.useState)(""),[A,O]=(0,d.useState)(""),[_,E]=(0,d.useState)(""),[B,D]=(0,d.useState)({}),[J,W]=(0,d.useState)(null),[I,L]=(0,d.useState)(null),[X,q]=(0,d.useState)(null),[G,H]=(0,d.useState)(""),K=(0,d.useCallback)(()=>(null==n?void 0:n.accessToken)?n.accessToken:null,[n]),Q=(0,d.useCallback)(async()=>{try{u(!0),T("");let i=K(),e=await fetch("".concat(t,"/admin/provinces-municipalities?ts=").concat(Date.now()),{headers:i?{Authorization:"Bearer ".concat(i)}:{}}),n=await e.json();200===n.status?s(n.data||[]):T(n.error||"Failed to fetch data")}catch(i){T(i.message||"Failed to fetch data")}finally{u(!1)}},[K]);(0,d.useEffect)(()=>{Q()},[Q]);let R=async()=>{if(!_.trim()){T("Province name cannot be empty");return}try{u(!0);let i=K(),e={"Content-Type":"application/json",...i&&{Authorization:"Bearer ".concat(i)}},n=await fetch("".concat(t,"/admin/provinces-municipalities/add-province"),{method:"POST",headers:e,body:JSON.stringify({province:_})}),a=await n.json();200===a.status?(O("Province added successfully"),E(""),Q()):T(a.error||"Failed to add province")}catch(i){T(i.message||"Failed to add province")}finally{u(!1)}},U=async i=>{if(window.confirm("Are you sure you want to delete ".concat(i," and all its municipalities?")))try{u(!0);let e=K(),n={"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}},a=await fetch("".concat(t,"/admin/provinces-municipalities/delete-province"),{method:"POST",headers:n,body:JSON.stringify({province:i})}),l=await a.json();200===l.status?(O("Province deleted successfully"),W(null),Q()):T(l.error||"Failed to delete province")}catch(i){T(i.message||"Failed to delete province")}finally{u(!1)}},V=async i=>{let e=B[i];if(!e||!e.trim()){T("Municipality name cannot be empty");return}u(!0);try{let n=K(),a={"Content-Type":"application/json",...n&&{Authorization:"Bearer ".concat(n)}},l=await fetch("".concat(t,"/admin/provinces-municipalities/add-municipality"),{method:"POST",headers:a,body:JSON.stringify({province:i,municipality:e})}),s=await l.json();200===s.status?(O("Municipality added successfully"),D({...B,[i]:""}),await Q()):T(s.error||"Failed to add municipality")}catch(i){T(i.message||"Failed to add municipality")}finally{u(!1)}},Y=async(i,e)=>{if(window.confirm("Are you sure you want to delete ".concat(e,"?"))){u(!0);try{let n=K(),a={"Content-Type":"application/json",...n&&{Authorization:"Bearer ".concat(n)}},l=await fetch("".concat(t,"/admin/provinces-municipalities/delete-municipality"),{method:"POST",headers:a,body:JSON.stringify({province:i,municipality:e})}),s=await l.json();200===s.status?(O("Municipality deleted successfully"),await Q()):T(s.error||"Failed to delete municipality")}catch(i){T(i.message||"Failed to delete municipality")}finally{u(!1)}}},$=async i=>{if(!G.trim()){T("Province name cannot be empty");return}try{u(!0);let e=K(),n={"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}},a=await fetch("".concat(t,"/admin/provinces-municipalities/edit-province"),{method:"POST",headers:n,body:JSON.stringify({province:i,newProvinceName:G})}),l=await a.json();200===l.status?(O("Province renamed successfully"),L(null),H(""),Q()):T(l.error||"Failed to edit province")}catch(i){T(i.message||"Failed to edit province")}finally{u(!1)}},ii=async(i,e)=>{if(!G.trim()){T("Municipality name cannot be empty");return}u(!0);try{let n=K(),a={"Content-Type":"application/json",...n&&{Authorization:"Bearer ".concat(n)}},l=await fetch("".concat(t,"/admin/provinces-municipalities/edit-municipality"),{method:"POST",headers:a,body:JSON.stringify({province:i,municipality:e,newMunicipalityName:G})}),s=await l.json();200===s.status?(O("Municipality renamed successfully"),q(null),H(""),await Q()):T(s.error||"Failed to edit municipality")}catch(i){T(i.message||"Failed to edit municipality")}finally{u(!1)}};return(0,a.jsxs)(r.Z,{sx:{p:2},children:[(0,a.jsx)(o.Z,{variant:"h6",sx:{mb:2},children:"Manage Provinces & Municipalities"}),F&&(0,a.jsx)(P.Z,{severity:"error",sx:{mb:2},children:F}),A&&(0,a.jsx)(P.Z,{severity:"success",sx:{mb:2},children:A}),c&&(0,a.jsx)(N.Z,{}),!c&&(0,a.jsxs)(z.Z,{spacing:3,children:[(0,a.jsx)(p.Z,{children:(0,a.jsxs)(m.Z,{children:[(0,a.jsx)(o.Z,{variant:"h6",sx:{mb:2},children:"Add New Province"}),(0,a.jsxs)(z.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(x.Z,{label:"Province Name",value:_,onChange:i=>E(i.target.value),size:"small",fullWidth:!0}),(0,a.jsx)(h.Z,{variant:"contained",startIcon:(0,a.jsx)(S.Z,{}),onClick:R,disabled:c,children:"Add"})]})]})}),(0,a.jsx)(Z.Z,{component:b.Z,children:(0,a.jsxs)(j.Z,{children:[(0,a.jsx)(f.Z,{children:(0,a.jsxs)(g.Z,{sx:{backgroundColor:"#f5f5f5"},children:[(0,a.jsx)(v.Z,{children:(0,a.jsx)("strong",{children:"Province"})}),(0,a.jsx)(v.Z,{align:"center",children:(0,a.jsx)("strong",{children:"Municipalities Count"})}),(0,a.jsx)(v.Z,{align:"right",children:(0,a.jsx)("strong",{children:"Actions"})})]})}),(0,a.jsx)(y.Z,{children:l.map(i=>(0,a.jsxs)(g.Z,{children:[(0,a.jsx)(v.Z,{onClick:()=>W(J===i.province?null:i.province),sx:{cursor:"pointer",fontWeight:J===i.province?"bold":"normal"},children:i.province}),(0,a.jsx)(v.Z,{align:"center",children:i.municipalities.length}),(0,a.jsxs)(v.Z,{align:"right",children:[(0,a.jsx)(w.Z,{size:"small",color:"primary",onClick:()=>{L(i.province),H(i.province)},disabled:c,title:"Edit",children:(0,a.jsx)(k.Z,{fontSize:"small"})}),(0,a.jsx)(w.Z,{size:"small",color:"error",onClick:()=>U(i.province),disabled:c,title:"Delete",children:(0,a.jsx)(C.Z,{fontSize:"small"})})]})]},i.province))})]})}),I&&(0,a.jsx)(p.Z,{sx:{backgroundColor:"#f0f7ff",border:"2px solid #2196F3"},children:(0,a.jsxs)(m.Z,{children:[(0,a.jsx)(o.Z,{variant:"h6",sx:{mb:2},children:"Edit Province"}),(0,a.jsxs)(z.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(x.Z,{label:"New Province Name",value:G,onChange:i=>H(i.target.value),size:"small",fullWidth:!0}),(0,a.jsx)(h.Z,{variant:"contained",color:"primary",onClick:()=>$(I),disabled:c,children:"Save"}),(0,a.jsx)(h.Z,{variant:"outlined",onClick:()=>{L(null),H("")},disabled:c,children:"Cancel"})]})]})}),J&&(0,a.jsx)(p.Z,{children:(0,a.jsxs)(m.Z,{children:[(0,a.jsxs)(o.Z,{variant:"h6",sx:{mb:2},children:[J," - Municipalities"]}),(0,a.jsxs)(z.Z,{spacing:2,children:[(0,a.jsxs)(z.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(x.Z,{label:"New Municipality",value:B[J]||"",onChange:i=>D({...B,[J]:i.target.value}),size:"small",fullWidth:!0}),(0,a.jsx)(h.Z,{variant:"contained",startIcon:(0,a.jsx)(S.Z,{}),onClick:()=>V(J),disabled:c,children:"Add"})]}),(0,a.jsx)(Z.Z,{component:b.Z,children:(0,a.jsxs)(j.Z,{size:"small",children:[(0,a.jsx)(f.Z,{children:(0,a.jsxs)(g.Z,{sx:{backgroundColor:"#f5f5f5"},children:[(0,a.jsx)(v.Z,{children:(0,a.jsx)("strong",{children:"Municipality"})}),(0,a.jsx)(v.Z,{align:"right",children:(0,a.jsx)("strong",{children:"Action"})})]})}),(0,a.jsx)(y.Z,{children:((null===(i=l.find(i=>i.province===J))||void 0===i?void 0:i.municipalities)||[]).map(i=>(0,a.jsxs)(g.Z,{children:[(0,a.jsx)(v.Z,{children:i}),(0,a.jsxs)(v.Z,{align:"right",children:[(0,a.jsx)(w.Z,{size:"small",color:"primary",onClick:()=>{q({province:J,municipality:i}),H(i)},disabled:c,title:"Edit",children:(0,a.jsx)(k.Z,{fontSize:"small"})}),(0,a.jsx)(w.Z,{size:"small",color:"error",onClick:()=>Y(J,i),disabled:c,title:"Delete",children:(0,a.jsx)(C.Z,{fontSize:"small"})})]})]},i))})]})}),(null==X?void 0:X.province)===J&&(0,a.jsx)(p.Z,{sx:{backgroundColor:"#f0f7ff",border:"2px solid #2196F3"},children:(0,a.jsxs)(m.Z,{children:[(0,a.jsx)(o.Z,{variant:"h6",sx:{mb:2},children:"Edit Municipality"}),(0,a.jsxs)(z.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(x.Z,{label:"New Municipality Name",value:G,onChange:i=>H(i.target.value),size:"small",fullWidth:!0}),(0,a.jsx)(h.Z,{variant:"contained",color:"primary",onClick:()=>ii(X.province,X.municipality),disabled:c,children:"Save"}),(0,a.jsx)(h.Z,{variant:"outlined",onClick:()=>{q(null),H("")},disabled:c,children:"Cancel"})]})]})})]})]})})]})]})},T=function(){let[i,e]=(0,d.useState)(0);return(0,a.jsxs)(r.Z,{sx:{p:2},children:[(0,a.jsx)(o.Z,{variant:"h5",sx:{mb:2},children:(0,a.jsx)("strong",{children:"Master Data Management"})}),(0,a.jsxs)(s.Z,{value:i,onChange:(i,n)=>e(n),children:[(0,a.jsx)(c.Z,{label:"Crops Management"}),(0,a.jsx)(c.Z,{label:"Province & Municipality Management"})]}),(0,a.jsxs)(r.Z,{sx:{mt:3},children:[0===i&&(0,a.jsx)(u.Z,{}),1===i&&(0,a.jsx)(F,{})]})]})},A=n(98813),O=(0,t.Z)(function(i){let{loading:e,user:n,onBtnLogoutClick:t}=i;return(0,a.jsx)(l.Z,{loading:e,user:n,onBtnLogoutClick:t,accLevel:A.DW.ADMIN,children:(0,a.jsx)(T,{})})})}},function(i){i.O(0,[3153,7023,3745,1664,6541,8848,6294,1626,9998,4723,3338,3539,7864,5719,8591,2224,2888,9774,179],function(){return i(i.s=78918)}),_N_E=i.O()}]);