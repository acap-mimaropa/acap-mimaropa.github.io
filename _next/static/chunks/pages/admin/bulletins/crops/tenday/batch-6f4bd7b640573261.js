(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6268],{85786:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bulletins/crops/tenday/batch",function(){return n(26390)}])},26390:function(e,t,n){"use strict";n.r(t);var i=n(85893),r=n(67294),a=n(9473),l=n(45773),s=n(65328),o=n(60990),c=n(51015),d=n(60762),p=n(71919),u=n(12166),h=n(81873),g=n(33453),x=n(40110),m=n(92365),v=n(65806),f=n(56894),j=n(68573),y=n(52857),b=n(92608),Z=n(26541),w=n(96788),S=n(25837),k=n(44723),C=n(97182),B=n(84166),E=n(13539),P=n(95639),R=n(97416),T=n(31695),G=n(75941),I=n(46560),M=n(98813),N=n(96281),_=n(77457),D=n(9704),W=n(38660);let A={card:{padding:"16px",borderRadius:"8px",border:"1px solid #e0e0e0"},progressSection:{marginTop:"24px",padding:"16px",backgroundColor:"#f5f5f5",borderRadius:"8px"}};t.default=(0,s.Z)(function(e){var t,n,s;let{user:F,onBtnLogoutClick:z,loading:O}=e,q=(0,r.useRef)(!0),L=(0,r.useRef)(0),U=(0,a.I0)(),[X,K]=(0,r.useState)(null),[Q,Y]=(0,r.useState)([]),[J,$]=(0,r.useState)([]),[H,V]=(0,r.useState)([]),[ee,et]=(0,r.useState)([]),[en,ei]=(0,r.useState)([]),[er,ea]=(0,r.useState)([]),[el,es]=(0,r.useState)([]),[eo,ec]=(0,r.useState)(!0),[ed,ep]=(0,r.useState)(null),[eu,eh]=(0,r.useState)(null),[eg,ex]=(0,r.useState)(null),em=(0,r.useRef)(null),[ev,ef]=(0,r.useState)({open:!1,url:"",filename:"",loading:!1,error:"",municipality:""}),{cropList:ej}=(0,D.Z)(),{services:ey}=(0,W.Z)(void 0,void 0),eb=ej.map(e=>({label:e,id:e})),[eZ,ew]=(0,r.useState)({isGenerating:!1,current:0,total:0,message:"",errors:[],generated:[],success:!1}),eS=()=>{ew({isGenerating:!1,current:0,total:0,message:"",errors:[],generated:[],success:!1})},ek=(0,r.useCallback)(()=>{em.current&&(clearInterval(em.current),em.current=null)},[]),eC=(0,r.useCallback)(e=>{ek(),e&&(em.current=setInterval(async()=>{try{var t,n;let i=null;try{i=localStorage.getItem("firebaseToken")}catch(e){i=null}if(!i)return;let r=await fetch("".concat("https://acap-mimaropa-server.onrender.com/api","/reports/tenday/batch/progress?requestId=").concat(encodeURIComponent(e)),{headers:{Authorization:"Bearer ".concat(i)}});if(!r.ok)return;let a=await r.json(),l=null==a?void 0:a.data;if(!l)return;let s=(null===(t=l.last)||void 0===t?void 0:t.municipality)&&(null===(n=l.last)||void 0===n?void 0:n.crop)?"".concat(l.last.municipality," - ").concat(l.last.crop):"",o=s?"Generating drafts... ".concat(s):"Generating drafts...";ew(e=>({...e,isGenerating:"done"!==l.status,current:l.current||e.current,total:l.total||e.total,message:o,success:!1})),l.done&&ek()}catch(e){}},800))},[ek]);(0,r.useEffect)(()=>(q.current=!0,(async()=>{try{let e=await (0,R.$m)();q.current&&(V(e.data||[]),$((0,N.m)(e.data)))}catch(e){console.error("Error loading provinces:",e)}})(),()=>{q.current=!1}),[]),(0,r.useEffect)(()=>{et([]),ei([]),ea([]),es([]),eS()},[X,Q]),(0,r.useEffect)(()=>{if(0===Q.length){ep(null);return}ed&&Q.includes(ed)||ep(Q[0])},[Q,ed]);let eB=Array.from(new Set(er.map(e=>e.municipality))).map(e=>({label:e})),eE=Array.from(new Set(er.filter(e=>!eu||e.municipality===eu.label).map(e=>e.crop))).map(e=>({label:e})),eP=er.find(e=>e.municipality===(null==eu?void 0:eu.label)&&e.crop===(null==eg?void 0:eg.label));(0,r.useEffect)(()=>{if(!er.length){eh(null),ex(null);return}eu&&eB.find(e=>e.label===eu.label)||eh(eB[0]||null)},[er,eB,eu]),(0,r.useEffect)(()=>{!er.length||eg&&eE.find(e=>e.label===eg.label)||ex(eE[0]||null)},[er,eE,eg]);let eR=e=>{Y(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},eT=e=>{ei(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},eG=(e,t)=>"".concat(e,"::").concat(t),eI=(e,t)=>{let n=new Map;return e.forEach(e=>{n.set(eG(e.municipality,e.crop),e)}),t.forEach(e=>{n.set(eG(e.municipality,e.crop),e)}),Array.from(n.values())},eM=(0,r.useCallback)(async function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{targets:i=null,isRecheck:r=!1}=n;if(!X||0===Q.length){alert("Please select a province and at least one crop");return}let a=H.find(e=>e.label===X.label),l=Array.isArray(i)?i.length:((null==a?void 0:null===(e=a.municipalities)||void 0===e?void 0:e.length)||0)*Q.length;ew(e=>({...e,isGenerating:!0,current:0,total:l,message:"Checking available crops and municipalities...",errors:[],generated:[],success:!1}));try{let e=null!=t?t:++L.current,n="batch-".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,8));eC(n);let a=await U((0,G.JC)({region:"mimaropa",province:X.label,crops:Q,requestId:n,targets:Array.isArray(i)&&i.length>0?i:void 0})).unwrap();if(e!==L.current)return;let l=a.drafts||[],s=a.errors||[],o=new Map,c=new Map;s.forEach(e=>{if(!(null==e?void 0:e.municipality)||!(null==e?void 0:e.crop))return;c.has(e.municipality)||c.set(e.municipality,new Map);let t=c.get(e.municipality);t.has(e.crop)||t.set(e.crop,[]),t.get(e.crop).push(e.error)}),l.forEach(e=>{o.has(e.municipality)||o.set(e.municipality,new Set),o.get(e.municipality).add(e.crop)});let d=H.find(e=>e.label===X.label),p=((null==d?void 0:d.municipalities)||[]).map(e=>e.label),u=[],h=l,g=Array.from(o.keys());if(r){let e=eI(er,l);h=e;let t=new Map;el.forEach(e=>{var n;null===(n=e.perCropStatuses)||void 0===n||n.forEach(n=>{t.set(eG(e.municipality,n.crop),n)})});let n=new Set(l.map(e=>eG(e.municipality,e.crop))),r=new Map;s.forEach(e=>{(null==e?void 0:e.municipality)&&(null==e?void 0:e.crop)&&r.set(eG(e.municipality,e.crop),e.error||"Missing data")}),Array.isArray(i)&&i.forEach(e=>{let i=eG(e.municipality,e.crop);n.has(i)?t.set(i,{crop:e.crop,status:"complete",reason:""}):r.has(i)&&t.set(i,{crop:e.crop,status:"incomplete",reason:r.get(i)})}),u=p.map(e=>{let n=Q.map(n=>{let i=eG(e,n);return t.get(i)||{crop:n,status:"incomplete",reason:"Not checked"}}),i=n.filter(e=>"incomplete"===e.status).map(e=>{let{crop:t,reason:n}=e;return{crop:t,reason:n}});return{municipality:e,status:0===i.length?"complete":"incomplete",missing:i,perCropStatuses:n}}),ea(e),es(u)}else u=p.map(e=>{let t=o.get(e)||new Set,n=Q.map(n=>{var i;let r=t.has(n),a=(null===(i=c.get(e))||void 0===i?void 0:i.get(n))||[];return{crop:n,status:r?"complete":"incomplete",reason:r?"":a[0]||"Missing data"}}),i=n.filter(e=>"incomplete"===e.status).map(e=>{let{crop:t,reason:n}=e;return{crop:t,reason:n}});return{municipality:e,status:0===i.length?"complete":"incomplete",missing:i,perCropStatuses:n}}),ea(l),et(g),ei(g),es(u);ew({isGenerating:!1,current:a.success+a.failed,total:a.totalToGenerate,message:r?"Rechecked ".concat(a.totalToGenerate," crop entries. ").concat(l.length," new bulletins are ready."):l.length>0?"Found ".concat(l.length," of ").concat(a.totalToGenerate," bulletins with data. ").concat(g.length," municipalities have at least one crop ready."):"No bulletin data found for the selected crops and date range.",errors:s,generated:l,success:h.length>0}),ek()}catch(e){ek(),ew(t=>({...t,isGenerating:!1,message:"Error checking data: ".concat(e),errors:[{error:e.toString()}],success:!1}))}},[U,er,el,H,X,Q,eC,ek]);(0,r.useEffect)(()=>()=>ek(),[ek]);let eN=()=>{if(!el.length)return[];let e=[];return el.forEach(t=>{var n;null===(n=t.perCropStatuses)||void 0===n||n.forEach(n=>{"incomplete"===n.status&&e.push({municipality:t.municipality,crop:n.crop})})}),e},e_=async e=>{if(!X||!ed){alert("Please select a crop for preview");return}ef(t=>({...t,loading:!0,error:"",open:!0,municipality:e}));try{let t={region:"mimaropa",province:X.label,municipality:e,operation:"preview",language:eo?"en":"tag",crop:ed,services:ey.map(e=>e.data)},n=await (0,T.bM)(t),i=new Blob([n],{type:"application/pdf"}),r=URL.createObjectURL(i),a="".concat(X.label,"_").concat(e,"_").concat(ed,".pdf");ef({open:!0,url:r,filename:a,loading:!1,error:"",municipality:e})}catch(t){let e=await (0,_.fu)(t);ef(t=>({...t,loading:!1,error:e||"Failed to load preview."}))}},eD=()=>{ev.url&&URL.revokeObjectURL(ev.url),ef({open:!1,url:"",filename:"",loading:!1,error:"",municipality:""})},eW=async()=>{if(!er.length)return;if(0===en.length){alert("Please select at least one municipality to save");return}let e=new Set(en),t=er.filter(t=>e.has(t.municipality));if(0===t.length){alert("No draft bulletins available for the selected municipalities");return}ew(e=>({...e,isGenerating:!0,current:0,total:t.length,message:"Publishing bulletins and uploading PDFs..."}));try{let e=0,n=[];for(let i of t){try{await (0,T.Bu)({region:"mimaropa",province:i.province,municipality:i.municipality,operation:"create",language:eo?"en":"tag",crop:i.crop,services:ey.map(e=>e.data)}),e+=1}catch(e){n.push({municipality:i.municipality,crop:i.crop,error:e.message||e.toString()})}ew(t=>({...t,current:e+n.length}))}ew({isGenerating:!1,current:e,total:t.length,message:"Published ".concat(e," bulletins to server!"),errors:n,generated:[],success:e>0}),ea([]),et([]),ei([]),U((0,I.uq)(M.Ry.TEN_DAY)),U((0,G.RC)({uid:F.uid,type:M.Ry.TEN_DAY}))}catch(e){ew(t=>({...t,isGenerating:!1,message:"Error saving: ".concat(e),errors:[{error:e.toString()}],success:!1}))}},eA=eZ.isGenerating,eF=eZ.total>0?Math.round(eZ.current/eZ.total*100):0,ez=eA&&(0===eZ.total||0===eZ.current),eO=ee.length>0&&en.length===ee.length,eq=en.length>0&&!eO,eL=H.find(e=>e.label===(null==X?void 0:X.label)),eU=(null==eL?void 0:null===(t=eL.municipalities)||void 0===t?void 0:t.length)||0,eX=el.filter(e=>"complete"===e.status),eK=el.filter(e=>"incomplete"===e.status),eQ=eX.map(e=>e.municipality),eY=eK.map(e=>e.municipality),eJ=er.length,e$=eZ.total||Q.length*eU;return(0,i.jsx)(l.Z,{loading:O,user:F,onBtnLogoutClick:z,accLevel:M.DW.ADMIN,children:(0,i.jsxs)(o.Z,{sx:{padding:"24px"},children:[(0,i.jsx)(w.Z,{variant:"h4",sx:{marginBottom:"8px"},children:"Batch 10-Day Bulletin Generation"}),(0,i.jsx)(w.Z,{variant:"body2",sx:{marginBottom:"24px",color:"#666"},children:"Generate 10-Day bulletins for municipalities with complete data in a province with multiple crops in one operation."}),(0,i.jsxs)(j.ZP,{container:!0,spacing:3,children:[(0,i.jsx)(j.ZP,{item:!0,xs:12,md:6,children:(0,i.jsx)(d.Z,{sx:A.card,children:(0,i.jsxs)(p.Z,{children:[(0,i.jsx)(w.Z,{variant:"h6",sx:{marginBottom:"16px"},children:"Selection Options"}),(0,i.jsx)(o.Z,{sx:{marginBottom:"16px"},children:(0,i.jsx)(S.Z,{disabled:eA,options:J,value:X,onChange:(e,t)=>{K(t)},renderInput:e=>(0,i.jsx)(Z.Z,{...e,label:"Select Province",size:"small"})})}),(0,i.jsx)(w.Z,{variant:"subtitle2",sx:{marginBottom:"12px"},children:"Select Crops (Only enabled crops with data will be generated):"}),(0,i.jsx)(f.Z,{children:eb.map(e=>(0,i.jsx)(v.Z,{control:(0,i.jsx)(u.Z,{checked:Q.includes(e.label),onChange:()=>eR(e.label),disabled:eA}),label:e.label},e.id))}),0===Q.length&&(0,i.jsx)(k.Z,{severity:"info",sx:{marginTop:"12px"},children:"Select at least one crop to proceed"}),Q.length>0&&(0,i.jsx)(o.Z,{sx:{marginTop:"16px"},children:(0,i.jsxs)(B.Z,{direction:"row",spacing:2,alignItems:"center",children:[(0,i.jsx)(v.Z,{control:(0,i.jsx)(E.Z,{checked:eo,onChange:e=>ec(e.target.checked)}),label:eo?"English":"Tagalog"}),(0,i.jsx)(S.Z,{disabled:eA,options:Q.map(e=>({label:e,id:e})),value:ed?{label:ed,id:ed}:null,onChange:(e,t)=>ep((null==t?void 0:t.label)||null),sx:{minWidth:"200px"},renderInput:e=>(0,i.jsx)(Z.Z,{...e,label:"Preview Crop",size:"small"})})]})}),ee.length>0&&(0,i.jsxs)(o.Z,{sx:{marginTop:"16px"},children:[(0,i.jsx)(w.Z,{variant:"subtitle2",sx:{marginBottom:"12px"},children:"Select Municipalities (with data):"}),(0,i.jsxs)(f.Z,{children:[(0,i.jsx)(v.Z,{control:(0,i.jsx)(u.Z,{checked:eO,indeterminate:eq,onChange:()=>{if(en.length===ee.length){ei([]);return}ei(ee)}}),label:"Select All"}),ee.map(e=>(0,i.jsx)(v.Z,{control:(0,i.jsx)(u.Z,{checked:en.includes(e),onChange:()=>eT(e),disabled:eA}),label:e},e))]})]}),el.length>0&&(0,i.jsxs)(o.Z,{sx:{marginTop:"16px"},children:[(0,i.jsx)(w.Z,{variant:"subtitle2",sx:{marginBottom:"12px"},children:"Municipality Status"}),(0,i.jsx)(B.Z,{spacing:1,children:el.map(e=>{var t,n;return(0,i.jsxs)(o.Z,{sx:{padding:"8px 12px",borderRadius:"6px",border:"1px solid #e0e0e0"},children:[(0,i.jsxs)(B.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,i.jsx)(w.Z,{variant:"body2",sx:{fontWeight:600},children:e.municipality}),(0,i.jsx)(h.Z,{size:"small",label:"complete"===e.status?"Complete":"in-progress"===e.status?"In Progress":"Incomplete",color:"complete"===e.status?"success":"in-progress"===e.status?"info":"warning"}),(null===(n=e.perCropStatuses)||void 0===n?void 0:n.some(e=>"complete"===e.status))?(0,i.jsx)(c.Z,{size:"small",variant:"outlined",onClick:()=>{var t;let n=null===(t=e.perCropStatuses)||void 0===t?void 0:t.find(e=>e.crop===ed);if((null==n?void 0:n.status)!=="complete"){alert("Preview crop is missing for this municipality. Choose a crop marked OK.");return}e_(e.municipality)},disabled:eA||!ed,children:"Preview"}):null]}),(null===(t=e.perCropStatuses)||void 0===t?void 0:t.length)>0&&(0,i.jsx)(B.Z,{direction:"row",spacing:1,useFlexGap:!0,flexWrap:"wrap",sx:{marginTop:"6px"},children:e.perCropStatuses.map(t=>{let n="Missing",r="warning",a="outlined";return"complete"===t.status?(n="OK",r="success",a="filled"):"running"===t.status?(n="Running",r="info",a="filled"):"pending"===t.status&&(n="Pending",r="default",a="outlined"),(0,i.jsx)(h.Z,{size:"small",label:"".concat(t.crop,": ").concat(n),color:r,variant:a},"".concat(e.municipality,"-").concat(t.crop))})}),"incomplete"===e.status&&e.missing.length>0&&(0,i.jsx)(o.Z,{sx:{marginTop:"6px"},children:e.missing.map(t=>(0,i.jsxs)(w.Z,{variant:"caption",display:"block",sx:{color:"#d32f2f"},children:[t.crop,": ",t.reason]},"".concat(e.municipality,"-").concat(t.crop)))})]},e.municipality)})})]}),X&&Q.length>0&&0===ee.length&&eZ.message&&(0,i.jsx)(k.Z,{severity:"warning",sx:{marginTop:"12px"},children:"No municipalities found with complete data for the selected crops."})]})})}),(0,i.jsx)(j.ZP,{item:!0,xs:12,md:6,children:(0,i.jsx)(d.Z,{sx:A.card,children:(0,i.jsxs)(p.Z,{children:[(0,i.jsx)(w.Z,{variant:"h6",sx:{marginBottom:"16px"},children:"Generation Summary"}),(0,i.jsxs)(o.Z,{sx:{marginBottom:"12px"},children:[(0,i.jsxs)(w.Z,{variant:"body2",children:[(0,i.jsx)("strong",{children:"Province:"})," ",X?X.label:"Not selected"]}),(0,i.jsxs)(w.Z,{variant:"body2",children:[(0,i.jsx)("strong",{children:"Selected Crops:"})," ",Q.length>0?Q.join(", "):"None"]}),(0,i.jsxs)(w.Z,{variant:"body2",children:[(0,i.jsx)("strong",{children:"Municipalities Selected:"})," ",en.length>0?"".concat(en.length," selected"):"None"]}),(0,i.jsxs)(w.Z,{variant:"body2",children:[(0,i.jsx)("strong",{children:"Municipalities With Data:"})," ",X?"".concat(ee.length," of ").concat(eU):"N/A"]}),(0,i.jsxs)(w.Z,{variant:"body2",children:[(0,i.jsx)("strong",{children:"Status:"})," ",el.length>0?"".concat(eX.length," complete, ").concat(eK.length," incomplete"):"Not checked"]}),(0,i.jsxs)(w.Z,{variant:"body2",children:[(0,i.jsx)("strong",{children:"Bulletins Ready:"})," ",e$>0?"".concat(eJ," of ").concat(e$):"Not checked"]})]}),el.length>0&&(0,i.jsxs)(o.Z,{sx:{marginBottom:"12px"},children:[(0,i.jsx)(w.Z,{variant:"body2",sx:{fontWeight:600,marginBottom:"6px"},children:"Pass/Fail Summary"}),(0,i.jsxs)(w.Z,{variant:"body2",children:[(0,i.jsx)("strong",{children:"Pass:"})," ",eX.length," | ",(0,i.jsx)("strong",{children:"Fail:"})," ",eK.length]}),eQ.length>0&&(0,i.jsxs)(o.Z,{sx:{marginTop:"8px"},children:[(0,i.jsx)(w.Z,{variant:"caption",sx:{fontWeight:600,display:"block"},children:"Successful Municipalities"}),(0,i.jsx)(B.Z,{direction:"row",spacing:1,useFlexGap:!0,flexWrap:"wrap",sx:{marginTop:"4px"},children:eQ.map(e=>(0,i.jsx)(h.Z,{size:"small",label:e,color:"success",variant:"outlined"},"success-".concat(e)))})]}),eY.length>0&&(0,i.jsxs)(o.Z,{sx:{marginTop:"8px"},children:[(0,i.jsx)(w.Z,{variant:"caption",sx:{fontWeight:600,display:"block"},children:"Incomplete Municipalities"}),(0,i.jsx)(B.Z,{direction:"row",spacing:1,useFlexGap:!0,flexWrap:"wrap",sx:{marginTop:"4px"},children:eY.map(e=>(0,i.jsx)(h.Z,{size:"small",label:e,color:"warning",variant:"outlined"},"fail-".concat(e)))})]})]}),X&&Q.length>0&&(0,i.jsxs)(k.Z,{severity:"info",children:["Will generate bulletins only for crops with available data in"," ",(0,i.jsx)("strong",{children:X.label})," for each selected crop"]})]})})}),(0,i.jsx)(j.ZP,{item:!0,xs:12,md:6,children:(0,i.jsx)(d.Z,{sx:A.card,children:(0,i.jsxs)(p.Z,{children:[(0,i.jsx)(w.Z,{variant:"h6",sx:{marginBottom:"16px"},children:"Draft Info Preview"}),0===er.length&&(0,i.jsx)(k.Z,{severity:"info",children:"Run Recheck Data to generate draft details."}),er.length>0&&(0,i.jsxs)(o.Z,{children:[(0,i.jsxs)(B.Z,{direction:"row",spacing:2,sx:{marginBottom:"12px"},children:[(0,i.jsx)(S.Z,{options:eB,value:eu,onChange:(e,t)=>eh(t),sx:{minWidth:"200px"},renderInput:e=>(0,i.jsx)(Z.Z,{...e,label:"Municipality",size:"small"})}),(0,i.jsx)(S.Z,{options:eE,value:eg,onChange:(e,t)=>ex(t),sx:{minWidth:"200px"},renderInput:e=>(0,i.jsx)(Z.Z,{...e,label:"Crop",size:"small"})})]}),!eP&&(0,i.jsx)(k.Z,{severity:"warning",children:"No draft found for the selected municipality and crop."}),eP&&(0,i.jsxs)(o.Z,{children:[(0,i.jsxs)(w.Z,{variant:"body2",children:[(0,i.jsx)("strong",{children:"Climate Risk:"})," ",eP.risk||"-"]}),(0,i.jsxs)(w.Z,{variant:"body2",children:[(0,i.jsx)("strong",{children:"Date Range:"})," ",eP.date_range||"-"]}),(0,i.jsxs)(w.Z,{variant:"body2",children:[(0,i.jsx)("strong",{children:"Condition:"})," ",eP.condition||"-"]}),(0,i.jsxs)(w.Z,{variant:"body2",children:[(0,i.jsx)("strong",{children:"Rainfall:"})," ",eP.rainfall||"-"]}),(0,i.jsxs)(o.Z,{sx:{marginTop:"12px"},children:[(0,i.jsx)(w.Z,{variant:"subtitle2",children:"Stages"}),(null===(n=eP.stages)||void 0===n?void 0:n.length)?(0,i.jsx)(B.Z,{direction:"row",spacing:1,useFlexGap:!0,flexWrap:"wrap",children:eP.stages.map(e=>(0,i.jsx)(h.Z,{size:"small",label:e},"".concat(eP.municipality,"-").concat(eP.crop,"-").concat(e)))}):(0,i.jsx)(w.Z,{variant:"caption",children:"No stages available."})]}),(0,i.jsxs)(o.Z,{sx:{marginTop:"12px"},children:[(0,i.jsx)(w.Z,{variant:"subtitle2",children:"Impact Outlooks"}),(null===(s=eP.activities)||void 0===s?void 0:s.length)?(0,i.jsx)("ul",{style:{margin:"8px 0 0 16px"},children:eP.activities.map((e,t)=>(0,i.jsx)("li",{children:(0,i.jsx)(w.Z,{variant:"caption",children:e})},"".concat(eP.municipality,"-").concat(eP.crop,"-").concat(t)))}):(0,i.jsx)(w.Z,{variant:"caption",children:"No activities available."})]})]})]})]})})}),(0,i.jsx)(j.ZP,{item:!0,xs:12,children:(0,i.jsxs)(o.Z,{sx:{display:"flex",gap:"12px"},children:[(0,i.jsx)(c.Z,{variant:"contained",color:"primary",onClick:()=>{let e=el.length>0,t=e?eN():[];if(e&&0===t.length){alert("All selected crops already have complete data.");return}eM(null,{targets:e?t:null,isRecheck:e})},disabled:eA||!X||0===Q.length,sx:{minWidth:"200px"},children:eA?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(C.Z,{size:20,sx:{marginRight:"8px"}}),"Checking..."]}):"Recheck Data"}),eZ.success&&en.length>0&&(0,i.jsx)(c.Z,{variant:"contained",color:"success",onClick:eW,sx:{minWidth:"200px"},children:"✓ Save Selected Bulletins"}),(0,i.jsx)(c.Z,{variant:"outlined",onClick:()=>{K(null),Y([]),et([]),ei([]),ea([]),eS()},disabled:eA,children:"Reset"})]})}),eZ.message&&(0,i.jsx)(j.ZP,{item:!0,xs:12,children:(0,i.jsxs)(o.Z,{sx:A.progressSection,children:[(0,i.jsx)(w.Z,{variant:"h6",sx:{marginBottom:"12px"},children:"Generation Progress"}),eA&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(o.Z,{sx:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[(0,i.jsxs)(w.Z,{variant:"body2",children:[eZ.current," / ",eZ.total||"..."]}),(0,i.jsx)(w.Z,{variant:"body2",children:ez?"In progress...":"".concat(eF,"%")})]}),(0,i.jsx)(b.Z,{variant:ez?"indeterminate":"determinate",value:ez?void 0:eF,sx:{marginBottom:"12px",height:"8px"}})]}),(0,i.jsx)(k.Z,{severity:eZ.success?"success":eA?"info":"error",sx:{marginBottom:"12px"},children:eZ.message}),eZ.errors.length>0&&(0,i.jsxs)(o.Z,{sx:{marginTop:"12px"},children:[(0,i.jsx)(w.Z,{variant:"subtitle2",sx:{marginBottom:"8px",color:"#d32f2f"},children:"Errors:"}),eZ.errors.slice(0,5).map((e,t)=>(0,i.jsxs)(w.Z,{variant:"caption",display:"block",sx:{color:"#d32f2f",marginBottom:"4px"},children:["• ",e.municipality," - ",e.crop,": ",e.error]},t)),eZ.errors.length>5&&(0,i.jsxs)(w.Z,{variant:"caption",sx:{color:"#d32f2f"},children:["... and ",eZ.errors.length-5," more errors"]})]}),eZ.generated.length>0&&(0,i.jsxs)(o.Z,{sx:{marginTop:"12px"},children:[(0,i.jsxs)(w.Z,{variant:"subtitle2",sx:{marginBottom:"8px",color:"#388e3c"},children:["Successfully Generated (",eZ.generated.length,"):"]}),eZ.generated.slice(0,5).map((e,t)=>(0,i.jsxs)(w.Z,{variant:"caption",display:"block",sx:{color:"#388e3c",marginBottom:"4px"},children:["✓ ",e.municipality," - ",e.crop]},t)),eZ.generated.length>5&&(0,i.jsxs)(w.Z,{variant:"caption",sx:{color:"#388e3c"},children:["... and ",eZ.generated.length-5," more"]})]})]})})]}),(0,i.jsxs)(g.Z,{open:ev.open,onClose:eD,fullWidth:!0,maxWidth:"lg",children:[(0,i.jsxs)(m.Z,{children:["Preview: ",ev.municipality||"Municipality",(0,i.jsx)(y.Z,{"aria-label":"close",onClick:eD,sx:{position:"absolute",right:8,top:8},children:(0,i.jsx)(P.Z,{})})]}),(0,i.jsxs)(x.Z,{dividers:!0,children:[ev.loading&&(0,i.jsx)(o.Z,{sx:{display:"flex",justifyContent:"center",padding:"24px"},children:(0,i.jsx)(C.Z,{})}),ev.error&&(0,i.jsx)(k.Z,{severity:"error",sx:{marginBottom:"12px"},children:ev.error}),ev.url&&(0,i.jsx)(o.Z,{sx:{height:"70vh"},children:(0,i.jsx)("iframe",{title:"10-day preview",src:ev.url,style:{width:"100%",height:"100%",border:"none"}})})]})]})]})})})},9704:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(67294),r=n(61061);function a(){let[e,t]=(0,i.useState)([]),[n,a]=(0,i.useState)(!1),[l,s]=(0,i.useState)("");return(0,i.useEffect)(()=>{(async()=>{var e,n,i;try{a(!0);let n=await (0,r.TQ)();t(null!==(e=null==n?void 0:n.list)&&void 0!==e?e:[]),a(!1),s("")}catch(e){s(null!==(i=null==e?void 0:null===(n=e.response)||void 0===n?void 0:n.data)&&void 0!==i?i:e.message),a(!1),t([])}})()},[]),{cropList:e,loading:n,error:l}}},38660:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(67294),r=n(98037);function a(e,t){let[n,a]=(0,i.useState)([]),[l,s]=(0,i.useState)(!1),[o,c]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{(async()=>{try{let e=await (0,r.yZ)();a(null!=e?e:[])}catch(n){var e,t;c(null!==(t=null==n?void 0:null===(e=n.response)||void 0===e?void 0:e.data)&&void 0!==t?t:n.message),s(!1)}})()},[e,t]),{services:n,loading:l,error:o}}},98037:function(e,t,n){"use strict";n.d(t,{Wn:function(){return o},vo:function(){return d},yZ:function(){return s},Ef:function(){return c}});var i=n(96171),r=n(36100);class a extends i.Z{constructor(...e){super(...e),this.getSupportServices=async()=>{let e=this.collection(this.db,"support_services"),t=this.query(e,(0,r.Xo)("date","asc"));return(await this.getDocs(t)).docs.map(e=>({...e.data(),docId:e.id}))},this.addSupportService=async e=>{let{supportService:t}=e,n=this.collection(this.db,"support_services");await this.addDoc(n,{data:t,date:new Date})},this.updateSupportService=async e=>{let t=this.collection(this.db,"support_services"),n=this.doc(t,e.docId);delete e.docId,await this.updateDoc(n,e)},this.deleteSupportService=async e=>{let t=this.doc(this.db,"support_services",e);await this.deleteDoc(t)}}}let l=new a,s=l.getSupportServices.bind(l),o=l.addSupportService.bind(l),c=l.updateSupportService.bind(l),d=l.deleteSupportService.bind(l)},77457:function(e,t,n){"use strict";n.d(t,{aS:function(){return a},fu:function(){return l}});var i=n(98813);let r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return parseFloat(e).toFixed(t)},a=e=>e===i.nQ?i.DD:r(e),l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return new Promise(t=>{if(void 0===e||"object"!=typeof e)t("Missing error response object");else if(e.response){if(e.response.data instanceof Blob){let n=new Blob([e.response.data],{type:"application/octet-stream"}),i=new FileReader;i.onload=()=>{t(i.result)},i.readAsText(n)}else t("Error reading data")}else e.request?t(e.request):t(e.message)})}},96281:function(e,t,n){"use strict";n.d(t,{m:function(){return i}});let i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label";return e.map((e,n)=>({id:n,label:e[t]}))}}},function(e){e.O(0,[3153,7023,3745,1664,6541,8848,6294,6905,5837,9998,4723,3539,7235,8591,2888,9774,179],function(){return e(e.s=85786)}),_N_E=e.O()}]);