(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6268],{85786:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bulletins/crops/tenday/batch",function(){return t(26390)}])},65328:function(e,n,t){"use strict";var r=t(85893),i=t(67294),s=t(11163),a=t(18853),o=t(98813);n.Z=function(e){function n(n){let t=(0,a.aC)(),l=(0,s.useRouter)();(0,i.useEffect)(()=>{if(!t.loading&&!t.user){let e=l.pathname.includes("/superadmin")?"/superadmin/login":"/admin/login";l.push(e)}t.user&&(t.user.accountlevel===o.DW.ADMIN&&l.pathname.includes("/superadmin")&&l.push("/unauthorized"),t.user.accountlevel===o.DW.SUPERADMIN&&l.pathname.includes("/admin")&&l.push("/unauthorized"))},[t.user,t.loading,l]);let c=async()=>{try{await t.logOut()}catch(e){}};return(0,r.jsx)(e,{...n,loading:t.loading,user:t.user,onBtnLogoutClick:c})}return n.customLayout=!0,n.adminPage=!0,n}},45773:function(e,n,t){"use strict";t.d(n,{Z:function(){return W}});var r=t(85893),i=t(60990),s=t(67294),a=t(14237),o=t(11032),l=t(56912),c=t(37958),d=t(47407),x=t(7638),u=t(32200),p=t(52311),h=t(88539),m=t(41664),g=t.n(m),j=t(11163),f=t(98813),Z=t(29943),v=t(3916),y=t(62967),b=t(14556),k=t(83108),S=t(93535),C=t(53916),w=t(22824),B=t(74972),P=t(93668);let M=[{text:"Get Started",link:"/admin",icon:(0,r.jsx)(y.Z,{})},{text:"ACAP Settings",link:"/admin/weather",icon:(0,r.jsx)(S.Z,{})},{text:"Generate Bulletin",link:"/admin/bulletins/crops",icon:(0,r.jsx)(k.Z,{})},{text:"SMS Management",link:"/admin/sms",icon:(0,r.jsx)(b.Z,{})},{text:"Cropping Calendars",link:"/admin/cropping-calendars",icon:(0,r.jsx)(w.Z,{})},{text:"Crops Management",link:"/admin/crops",icon:(0,r.jsx)(P.Z,{})},{text:"Manage Recommendations",link:"/admin/manage-recommendations",icon:(0,r.jsx)(B.Z,{})}],D=[{text:"Profile",link:"/admin/profile",icon:(0,r.jsx)(C.Z,{})}];var G=t(58505);let N=[{text:"Get Started",link:"/superadmin",icon:(0,r.jsx)(y.Z,{})},{text:"Users",link:"/superadmin/users",icon:(0,r.jsx)(G.Z,{})}],L=[{text:"Profile",link:"/superadmin/profile",icon:(0,r.jsx)(C.Z,{})}];var E=t(41796),A={padding:e=>e.spacing(1),width:"100%","& a":{textDecoration:"none",color:"rgba(0, 0, 0, 0.87)"},"& .MuiListItemButton-root:hover":{backgroundColor:e=>e.palette.primary.light},"& .Mui-selected":{backgroundColor:e=>"".concat((0,E.Fq)(e.palette.primary.light,.3)," !important")},"& .listitembutton-styled":{py:0,minHeight:48,color:e=>e.palette.primary.dark,borderRadius:e=>e.spacing(1),margin:e=>e.spacing(1),"&:hover, &:focus":{"& .MuiTypography-root":{color:e=>e.palette.primary.main}},"& a":{color:e=>e.palette.primary.dark}},"& .MuiListItemIcon-root":{marginRight:"-8px"},"@media (max-width: 600px)":{padding:"2px",width:"100vw"}};let R=[{text:"ACAP Website",link:"/",icon:(0,r.jsx)(Z.Z,{})},{text:"Logout",link:"#",icon:(0,r.jsx)(v.Z,{})}];function T(e){let{window:n}=e,[t,m]=(0,s.useState)(!1),[Z,v]=(0,s.useState)(null),y=(0,j.useRouter)(),{user:b,onBtnLogoutClick:k}=e,S=(0,s.useMemo)(()=>{if(b)return b.accountlevel===f.DW.ADMIN?M:N},[b]),C=(0,s.useMemo)(()=>{if(b)return[...b.accountlevel===f.DW.ADMIN?D:L,...R]},[b]);(0,s.useEffect)(()=>{if(!(null==y?void 0:y.route)||!S||!C)return;let e=[...S,...C].find(e=>e.link===y.route);v(null==e?void 0:e.link)},[e.user.accountlevel,y.route,S,C]);let w=(0,r.jsxs)("div",{children:[(0,r.jsx)(h.Z,{}),(0,r.jsx)(l.Z,{}),(0,r.jsx)(d.Z,{sx:A,disablePadding:!0,children:S.map(e=>(0,r.jsx)(g(),{href:e.link,passHref:!0,legacyBehavior:!0,children:(0,r.jsxs)(p.Z,{className:"listitembutton-styled",selected:Z===e.link,children:[(0,r.jsx)(x.Z,{sx:{color:"inherit"},children:e.icon}),(0,r.jsx)(u.Z,{primaryTypographyProps:{fontSize:14,fontWeight:"medium"},children:e.text})]},e.label)},e.link))}),(0,r.jsx)(l.Z,{}),(0,r.jsx)(d.Z,{sx:A,children:C.map((e,n)=>"Logout"===e.text?(0,r.jsx)(g(),{href:e.link,passHref:!0,legacyBehavior:!0,children:(0,r.jsxs)(p.Z,{className:"listitembutton-styled",selected:Z===e.link,onClick:k,children:[(0,r.jsx)(x.Z,{sx:{color:"inherit"},children:e.icon}),(0,r.jsx)(u.Z,{primary:e.text,primaryTypographyProps:{fontSize:14,fontWeight:"medium"}})]})},e.link):(0,r.jsx)(g(),{href:e.link,passHref:!0,legacyBehavior:!0,children:(0,r.jsxs)(p.Z,{className:"listitembutton-styled",selected:Z===e.link,children:[(0,r.jsx)(x.Z,{sx:{color:"inherit"},children:e.icon}),(0,r.jsx)(u.Z,{primaryTypographyProps:{fontSize:14,fontWeight:"medium"},children:e.text})]})},n))})]});return(0,r.jsxs)(i.Z,{sx:{display:"flex"},children:[(0,r.jsx)(a.ZP,{}),(0,r.jsxs)(i.Z,{component:"nav",sx:{width:{sm:280},flexShrink:{sm:0}},"aria-label":"mailbox folders",children:[(0,r.jsx)(c.ZP,{container:void 0!==n?()=>n().document.body:void 0,variant:"temporary",open:t,onClose:()=>{m(!t)},ModalProps:{keepMounted:!0},sx:{display:{xs:"block",sm:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:280}},children:w}),(0,r.jsx)(c.ZP,{variant:"permanent",sx:{display:{xs:"none",sm:"block"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:280,boxShadow:"0px 0px 20px rgb(1 41 112 / 10%)",color:"#444444",border:"none",backgroundColor:"#fff"}},open:!0,children:w})]}),(0,r.jsx)(i.Z,{component:"main",sx:{flexGrow:1,padding:{xs:"16px 0 0 0",sm:"24px 24px 24px 24px"},width:{sm:"calc(100% - ".concat(280,"px)")}},children:(0,r.jsx)(o.Z,{maxWidth:"lg",children:e.children})})]})}var _=t(85229),W=function(e){return(0,r.jsxs)(i.Z,{sx:{marginTop:e=>e.spacing(4)},children:[e.loading&&(0,r.jsx)(_.Z,{}),!e.loading&&e.user&&e.user.accountlevel===e.accLevel&&(0,r.jsx)(T,{user:e.user,onBtnLogoutClick:e.onBtnLogoutClick,children:e.children})]})}},85229:function(e,n,t){"use strict";t.d(n,{Z:function(){return c}});var r=t(85893),i=t(60990),s=t(97182),a=t(96788),o={width:"100%",backgroundColor:"#fff",minHeight:"50vh",display:"grid",placeItems:"center"},l={display:"flex",justifyContent:"center",alignItems:"center"},c=function(e){let{sx:n}=e;return(0,r.jsx)(i.Z,{sx:{...o,...n&&{...n}},children:(0,r.jsxs)(i.Z,{sx:l,children:[(0,r.jsx)(a.Z,{variant:"subtitle1",children:"Loading..."}),(0,r.jsx)(s.Z,{size:"32px"})]})})}},26390:function(e,n,t){"use strict";t.r(n);var r=t(85893),i=t(67294),s=t(9473),a=t(45773),o=t(65328),l=t(60990),c=t(51015),d=t(60762),x=t(71919),u=t(12166),p=t(65806),h=t(56894),m=t(68573),g=t(92608),j=t(26541),f=t(96788),Z=t(25837),v=t(44723),y=t(97182),b=t(97416),k=t(75941),S=t(46560),C=t(98813),w=t(96281),B=t(9704);let P={card:{padding:"16px",borderRadius:"8px",border:"1px solid #e0e0e0"},progressSection:{marginTop:"24px",padding:"16px",backgroundColor:"#f5f5f5",borderRadius:"8px"}};n.default=(0,o.Z)(function(e){let{user:n,onBtnLogoutClick:t,loading:o}=e,M=(0,i.useRef)(!0),D=(0,s.I0)(),[G,N]=(0,i.useState)(null),[L,E]=(0,i.useState)([]),[A,R]=(0,i.useState)([]),{cropList:T}=(0,B.Z)(),_=T.map(e=>({label:e,id:e})),[W,I]=(0,i.useState)({isGenerating:!1,current:0,total:0,message:"",errors:[],generated:[],success:!1});(0,i.useEffect)(()=>(M.current=!0,(async()=>{try{let e=await (0,b.$m)();M.current&&R((0,w.m)(e.data))}catch(e){console.error("Error loading provinces:",e)}})(),()=>{M.current=!1}),[]);let z=e=>{E(n=>n.includes(e)?n.filter(n=>n!==e):[...n,e])},H=async()=>{if(!G||0===L.length){alert("Please select a province and at least one crop");return}I({isGenerating:!1,current:L.length,total:L.length,message:"Drafts ready for ".concat(L.length," crop(s). Click Save to store to server."),errors:[],generated:L.map(e=>({province:G.label,crop:e,draft:!0})),success:!0})},O=async()=>{if(W.generated.length){I(e=>({...e,isGenerating:!0,message:"Saving to server..."}));try{let e=await D((0,k.il)(W.generated)).unwrap();I({isGenerating:!1,current:e.saved,total:e.saved,message:"Saved ".concat(e.saved," bulletins to server!"),errors:e.errors||[],generated:[],success:!0}),D((0,S.uq)(C.Ry.TEN_DAY)),D((0,k.RC)({uid:n.uid,type:C.Ry.TEN_DAY}))}catch(e){I(n=>({...n,isGenerating:!1,message:"Error saving: ".concat(e),errors:[{error:e.toString()}],success:!1}))}}},F=W.isGenerating,q=W.total>0?Math.round(W.current/W.total*100):0;return(0,r.jsx)(a.Z,{loading:o,user:n,onBtnLogoutClick:t,accLevel:C.DW.ADMIN,children:(0,r.jsxs)(l.Z,{sx:{padding:"24px"},children:[(0,r.jsx)(f.Z,{variant:"h4",sx:{marginBottom:"8px"},children:"Batch 10-Day Bulletin Generation"}),(0,r.jsx)(f.Z,{variant:"body2",sx:{marginBottom:"24px",color:"#666"},children:"Generate 10-Day bulletins for ALL municipalities in a province with multiple crops in one operation."}),(0,r.jsxs)(m.ZP,{container:!0,spacing:3,children:[(0,r.jsx)(m.ZP,{item:!0,xs:12,md:6,children:(0,r.jsx)(d.Z,{sx:P.card,children:(0,r.jsxs)(x.Z,{children:[(0,r.jsx)(f.Z,{variant:"h6",sx:{marginBottom:"16px"},children:"Selection Options"}),(0,r.jsx)(l.Z,{sx:{marginBottom:"16px"},children:(0,r.jsx)(Z.Z,{disabled:F,options:A,value:G,onChange:(e,n)=>{N(n)},renderInput:e=>(0,r.jsx)(j.Z,{...e,label:"Select Province",size:"small"})})}),(0,r.jsx)(f.Z,{variant:"subtitle2",sx:{marginBottom:"12px"},children:"Select Crops (Only enabled crops with data will be generated):"}),(0,r.jsx)(h.Z,{children:_.map(e=>(0,r.jsx)(p.Z,{control:(0,r.jsx)(u.Z,{checked:L.includes(e.label),onChange:()=>z(e.label),disabled:F}),label:e.label},e.id))}),0===L.length&&(0,r.jsx)(v.Z,{severity:"info",sx:{marginTop:"12px"},children:"Select at least one crop to proceed"})]})})}),(0,r.jsx)(m.ZP,{item:!0,xs:12,md:6,children:(0,r.jsx)(d.Z,{sx:P.card,children:(0,r.jsxs)(x.Z,{children:[(0,r.jsx)(f.Z,{variant:"h6",sx:{marginBottom:"16px"},children:"Generation Summary"}),(0,r.jsxs)(l.Z,{sx:{marginBottom:"12px"},children:[(0,r.jsxs)(f.Z,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Province:"})," ",G?G.label:"Not selected"]}),(0,r.jsxs)(f.Z,{variant:"body2",children:[(0,r.jsx)("strong",{children:"Selected Crops:"})," ",L.length>0?L.join(", "):"None"]})]}),G&&L.length>0&&(0,r.jsxs)(v.Z,{severity:"info",children:["Will generate bulletins for ALL municipalities in"," ",(0,r.jsx)("strong",{children:G.label})," for each selected crop"]})]})})}),(0,r.jsx)(m.ZP,{item:!0,xs:12,children:(0,r.jsxs)(l.Z,{sx:{display:"flex",gap:"12px"},children:[(0,r.jsx)(c.Z,{variant:"contained",color:"primary",onClick:H,disabled:F||!G||0===L.length,sx:{minWidth:"200px"},children:F?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.Z,{size:20,sx:{marginRight:"8px"}}),"Generating..."]}):"Generate All"}),W.success&&W.generated.length>0&&(0,r.jsxs)(c.Z,{variant:"contained",color:"success",onClick:O,sx:{minWidth:"200px"},children:["✓ Save ",W.generated.length," Bulletins"]}),(0,r.jsx)(c.Z,{variant:"outlined",onClick:()=>{N(null),E([]),I({isGenerating:!1,current:0,total:0,message:"",errors:[],generated:[],success:!1})},disabled:F,children:"Reset"})]})}),W.message&&(0,r.jsx)(m.ZP,{item:!0,xs:12,children:(0,r.jsxs)(l.Z,{sx:P.progressSection,children:[(0,r.jsx)(f.Z,{variant:"h6",sx:{marginBottom:"12px"},children:"Generation Progress"}),F&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(l.Z,{sx:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[(0,r.jsxs)(f.Z,{variant:"body2",children:[W.current," / ",W.total]}),(0,r.jsxs)(f.Z,{variant:"body2",children:[q,"%"]})]}),(0,r.jsx)(g.Z,{variant:"determinate",value:q,sx:{marginBottom:"12px",height:"8px"}})]}),(0,r.jsx)(v.Z,{severity:W.success?"success":F?"info":"error",sx:{marginBottom:"12px"},children:W.message}),W.errors.length>0&&(0,r.jsxs)(l.Z,{sx:{marginTop:"12px"},children:[(0,r.jsx)(f.Z,{variant:"subtitle2",sx:{marginBottom:"8px",color:"#d32f2f"},children:"Errors:"}),W.errors.slice(0,5).map((e,n)=>(0,r.jsxs)(f.Z,{variant:"caption",display:"block",sx:{color:"#d32f2f",marginBottom:"4px"},children:["• ",e.municipality," - ",e.crop,": ",e.error]},n)),W.errors.length>5&&(0,r.jsxs)(f.Z,{variant:"caption",sx:{color:"#d32f2f"},children:["... and ",W.errors.length-5," more errors"]})]}),W.generated.length>0&&(0,r.jsxs)(l.Z,{sx:{marginTop:"12px"},children:[(0,r.jsxs)(f.Z,{variant:"subtitle2",sx:{marginBottom:"8px",color:"#388e3c"},children:["Successfully Generated (",W.generated.length,"):"]}),W.generated.slice(0,5).map((e,n)=>(0,r.jsxs)(f.Z,{variant:"caption",display:"block",sx:{color:"#388e3c",marginBottom:"4px"},children:["✓ ",e.municipality," - ",e.crop]},n)),W.generated.length>5&&(0,r.jsxs)(f.Z,{variant:"caption",sx:{color:"#388e3c"},children:["... and ",W.generated.length-5," more"]})]})]})})]})]})})})},9704:function(e,n,t){"use strict";t.d(n,{Z:function(){return s}});var r=t(67294),i=t(61061);function s(){let[e,n]=(0,r.useState)([]),[t,s]=(0,r.useState)(!1),[a,o]=(0,r.useState)("");return(0,r.useEffect)(()=>{(async()=>{var e,t,r;try{s(!0);let t=await (0,i.TQ)();n(null!==(e=null==t?void 0:t.list)&&void 0!==e?e:[]),s(!1),o("")}catch(e){o(null!==(r=null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.data)&&void 0!==r?r:e.message),s(!1),n([])}})()},[]),{cropList:e,loading:t,error:a}}},96281:function(e,n,t){"use strict";t.d(n,{m:function(){return r}});let r=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label";return e.map((e,t)=>({id:t,label:e[n]}))}}},function(e){e.O(0,[3153,7023,3745,1664,6541,955,7958,4073,4959,5837,4723,7368,2888,9774,179],function(){return e(e.s=85786)}),_N_E=e.O()}]);