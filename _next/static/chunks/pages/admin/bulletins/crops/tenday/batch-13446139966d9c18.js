(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6268],{85786:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bulletins/crops/tenday/batch",function(){return n(26390)}])},26390:function(e,r,n){"use strict";n.r(r);var t=n(85893),s=n(67294),i=n(9473),a=n(45773),l=n(65328),o=n(60990),c=n(51015),d=n(60762),x=n(71919),u=n(12166),p=n(65806),g=n(56894),h=n(68573),m=n(92608),j=n(26541),Z=n(96788),f=n(25837),v=n(44723),b=n(97182),y=n(97416),S=n(75941),B=n(46560),E=n(98813),_=n(96281),G=n(9704);let P={card:{padding:"16px",borderRadius:"8px",border:"1px solid #e0e0e0"},progressSection:{marginTop:"24px",padding:"16px",backgroundColor:"#f5f5f5",borderRadius:"8px"}};r.default=(0,l.Z)(function(e){let{user:r,onBtnLogoutClick:n,loading:l}=e,T=(0,s.useRef)(!0),w=(0,i.I0)(),[C,k]=(0,s.useState)(null),[N,R]=(0,s.useState)([]),[A,D]=(0,s.useState)([]),{cropList:L}=(0,G.Z)(),O=L.map(e=>({label:e,id:e})),[Y,I]=(0,s.useState)({isGenerating:!1,current:0,total:0,message:"",errors:[],generated:[],success:!1});(0,s.useEffect)(()=>(T.current=!0,(async()=>{try{let e=await (0,y.$m)();T.current&&D((0,_.m)(e.data.map(e=>e.name)))}catch(e){console.error("Error loading provinces:",e)}})(),()=>{T.current=!1}),[]);let W=e=>{R(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])},z=async()=>{if(!C||0===N.length){alert("Please select a province and at least one crop");return}I({isGenerating:!0,current:0,total:N.length,message:"Starting batch generation...",errors:[],generated:[],success:!1});try{let e=await w((0,S.JC)({region:"mimaropa",province:C,crops:N})).unwrap();T.current&&(I({isGenerating:!1,current:e.totalToGenerate,total:e.totalToGenerate,message:"Successfully generated ".concat(e.success," bulletins").concat(e.failed>0?" (".concat(e.failed," failed)"):""),errors:e.errors||[],generated:e.generated||[],success:0===e.failed}),w((0,B.uq)(E.REPORT_TYPE.TEN_DAY)),w((0,S.RC)({uid:r.uid,type:E.REPORT_TYPE.TEN_DAY})))}catch(e){T.current&&I({isGenerating:!1,current:0,total:0,message:"Error: ".concat(e),errors:[{error:e.toString()}],generated:[],success:!1})}},F=Y.isGenerating,M=Y.total>0?Math.round(Y.current/Y.total*100):0;return(0,t.jsx)(a.Z,{loading:l,user:r,onBtnLogoutClick:n,accLevel:E.DW.ADMIN,children:(0,t.jsxs)(o.Z,{sx:{padding:"24px"},children:[(0,t.jsx)(Z.Z,{variant:"h4",sx:{marginBottom:"8px"},children:"Batch 10-Day Bulletin Generation"}),(0,t.jsx)(Z.Z,{variant:"body2",sx:{marginBottom:"24px",color:"#666"},children:"Generate 10-Day bulletins for ALL municipalities in a province with multiple crops in one operation."}),(0,t.jsxs)(h.ZP,{container:!0,spacing:3,children:[(0,t.jsx)(h.ZP,{item:!0,xs:12,md:6,children:(0,t.jsx)(d.Z,{sx:P.card,children:(0,t.jsxs)(x.Z,{children:[(0,t.jsx)(Z.Z,{variant:"h6",sx:{marginBottom:"16px"},children:"Selection Options"}),(0,t.jsx)(o.Z,{sx:{marginBottom:"16px"},children:(0,t.jsx)(f.Z,{disabled:F,options:A,value:C,onChange:(e,r)=>{k(r)},renderInput:e=>(0,t.jsx)(j.Z,{...e,label:"Select Province",size:"small"})})}),(0,t.jsx)(Z.Z,{variant:"subtitle2",sx:{marginBottom:"12px"},children:"Select Crops (Only enabled crops with data will be generated):"}),(0,t.jsx)(g.Z,{children:O.map(e=>(0,t.jsx)(p.Z,{control:(0,t.jsx)(u.Z,{checked:N.includes(e.label),onChange:()=>W(e.label),disabled:F}),label:e.label},e.id))}),0===N.length&&(0,t.jsx)(v.Z,{severity:"info",sx:{marginTop:"12px"},children:"Select at least one crop to proceed"})]})})}),(0,t.jsx)(h.ZP,{item:!0,xs:12,md:6,children:(0,t.jsx)(d.Z,{sx:P.card,children:(0,t.jsxs)(x.Z,{children:[(0,t.jsx)(Z.Z,{variant:"h6",sx:{marginBottom:"16px"},children:"Generation Summary"}),(0,t.jsxs)(o.Z,{sx:{marginBottom:"12px"},children:[(0,t.jsxs)(Z.Z,{variant:"body2",children:[(0,t.jsx)("strong",{children:"Province:"})," ",C||"Not selected"]}),(0,t.jsxs)(Z.Z,{variant:"body2",children:[(0,t.jsx)("strong",{children:"Selected Crops:"})," ",N.length>0?N.join(", "):"None"]})]}),C&&N.length>0&&(0,t.jsxs)(v.Z,{severity:"info",children:["Will generate bulletins for ALL municipalities in"," ",(0,t.jsx)("strong",{children:C})," for each selected crop"]})]})})}),(0,t.jsx)(h.ZP,{item:!0,xs:12,children:(0,t.jsxs)(o.Z,{sx:{display:"flex",gap:"12px"},children:[(0,t.jsx)(c.Z,{variant:"contained",color:"primary",onClick:z,disabled:F||!C||0===N.length,sx:{minWidth:"200px"},children:F?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.Z,{size:20,sx:{marginRight:"8px"}}),"Generating..."]}):"Generate All"}),(0,t.jsx)(c.Z,{variant:"outlined",onClick:()=>{k(null),R([]),I({isGenerating:!1,current:0,total:0,message:"",errors:[],generated:[],success:!1})},disabled:F,children:"Reset"})]})}),Y.message&&(0,t.jsx)(h.ZP,{item:!0,xs:12,children:(0,t.jsxs)(o.Z,{sx:P.progressSection,children:[(0,t.jsx)(Z.Z,{variant:"h6",sx:{marginBottom:"12px"},children:"Generation Progress"}),F&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(o.Z,{sx:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[(0,t.jsxs)(Z.Z,{variant:"body2",children:[Y.current," / ",Y.total]}),(0,t.jsxs)(Z.Z,{variant:"body2",children:[M,"%"]})]}),(0,t.jsx)(m.Z,{variant:"determinate",value:M,sx:{marginBottom:"12px",height:"8px"}})]}),(0,t.jsx)(v.Z,{severity:Y.success?"success":F?"info":"error",sx:{marginBottom:"12px"},children:Y.message}),Y.errors.length>0&&(0,t.jsxs)(o.Z,{sx:{marginTop:"12px"},children:[(0,t.jsx)(Z.Z,{variant:"subtitle2",sx:{marginBottom:"8px",color:"#d32f2f"},children:"Errors:"}),Y.errors.slice(0,5).map((e,r)=>(0,t.jsxs)(Z.Z,{variant:"caption",display:"block",sx:{color:"#d32f2f",marginBottom:"4px"},children:["• ",e.municipality," - ",e.crop,": ",e.error]},r)),Y.errors.length>5&&(0,t.jsxs)(Z.Z,{variant:"caption",sx:{color:"#d32f2f"},children:["... and ",Y.errors.length-5," more errors"]})]}),Y.generated.length>0&&(0,t.jsxs)(o.Z,{sx:{marginTop:"12px"},children:[(0,t.jsxs)(Z.Z,{variant:"subtitle2",sx:{marginBottom:"8px",color:"#388e3c"},children:["Successfully Generated (",Y.generated.length,"):"]}),Y.generated.slice(0,5).map((e,r)=>(0,t.jsxs)(Z.Z,{variant:"caption",display:"block",sx:{color:"#388e3c",marginBottom:"4px"},children:["✓ ",e.municipality," - ",e.crop]},r)),Y.generated.length>5&&(0,t.jsxs)(Z.Z,{variant:"caption",sx:{color:"#388e3c"},children:["... and ",Y.generated.length-5," more"]})]})]})})]})]})})})},9704:function(e,r,n){"use strict";n.d(r,{Z:function(){return i}});var t=n(67294),s=n(61061);function i(){let[e,r]=(0,t.useState)([]),[n,i]=(0,t.useState)(!1),[a,l]=(0,t.useState)("");return(0,t.useEffect)(()=>{(async()=>{var e,n,t;try{i(!0);let n=await (0,s.TQ)();r(null!==(e=null==n?void 0:n.list)&&void 0!==e?e:[]),i(!1),l("")}catch(e){l(null!==(t=null==e?void 0:null===(n=e.response)||void 0===n?void 0:n.data)&&void 0!==t?t:e.message),i(!1),r([])}})()},[]),{cropList:e,loading:n,error:a}}},96281:function(e,r,n){"use strict";n.d(r,{m:function(){return t}});let t=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label";return e.map((e,n)=>({id:n,label:e[r]}))}}},function(e){e.O(0,[3153,6856,190,8583,1664,6541,955,4073,6455,5837,4723,4515,2705,8591,2888,9774,179],function(){return e(e.s=85786)}),_N_E=e.O()}]);