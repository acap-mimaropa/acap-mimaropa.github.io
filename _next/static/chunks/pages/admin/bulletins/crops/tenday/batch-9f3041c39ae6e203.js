(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6268],{85786:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bulletins/crops/tenday/batch",function(){return n(26390)}])},26390:function(e,r,n){"use strict";n.r(r);var t=n(85893),s=n(67294),i=n(9473),a=n(45773),l=n(65328),o=n(60990),c=n(51015),d=n(60762),x=n(71919),u=n(12166),g=n(65806),h=n(56894),p=n(68573),m=n(92608),j=n(26541),v=n(96788),Z=n(25837),f=n(44723),b=n(97182),y=n(97416),S=n(75941),B=n(46560),w=n(98813),C=n(96281),G=n(9704);let _={card:{padding:"16px",borderRadius:"8px",border:"1px solid #e0e0e0"},progressSection:{marginTop:"24px",padding:"16px",backgroundColor:"#f5f5f5",borderRadius:"8px"}};r.default=(0,l.Z)(function(e){let{user:r,onBtnLogoutClick:n,loading:l}=e,k=(0,s.useRef)(!0),E=(0,i.I0)(),[P,N]=(0,s.useState)(null),[T,R]=(0,s.useState)([]),[D,A]=(0,s.useState)([]),{cropList:L}=(0,G.Z)(),O=L.map(e=>({label:e,id:e})),[W,I]=(0,s.useState)({isGenerating:!1,current:0,total:0,message:"",errors:[],generated:[],success:!1});(0,s.useEffect)(()=>(k.current=!0,(async()=>{try{let e=await (0,y.$m)();k.current&&A((0,C.m)(e.data))}catch(e){console.error("Error loading provinces:",e)}})(),()=>{k.current=!1}),[]);let z=e=>{R(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])},F=async()=>{if(!P||0===T.length){alert("Please select a province and at least one crop");return}I({isGenerating:!1,current:T.length,total:T.length,message:"Drafts ready for ".concat(T.length," crop(s). Click Save to store to server."),errors:[],generated:T.map(e=>({province:P.label,crop:e,draft:!0})),success:!0})},M=async()=>{if(W.generated.length){I(e=>({...e,isGenerating:!0,message:"Saving to server..."}));try{let e=await E((0,S.il)(W.generated)).unwrap();I({isGenerating:!1,current:e.saved,total:e.saved,message:"Saved ".concat(e.saved," bulletins to server!"),errors:e.errors||[],generated:[],success:!0}),E((0,B.uq)(w.Ry.TEN_DAY)),E((0,S.RC)({uid:r.uid,type:w.Ry.TEN_DAY}))}catch(e){I(r=>({...r,isGenerating:!1,message:"Error saving: ".concat(e),errors:[{error:e.toString()}],success:!1}))}}},X=W.isGenerating,Y=W.total>0?Math.round(W.current/W.total*100):0;return(0,t.jsx)(a.Z,{loading:l,user:r,onBtnLogoutClick:n,accLevel:w.DW.ADMIN,children:(0,t.jsxs)(o.Z,{sx:{padding:"24px"},children:[(0,t.jsx)(v.Z,{variant:"h4",sx:{marginBottom:"8px"},children:"Batch 10-Day Bulletin Generation"}),(0,t.jsx)(v.Z,{variant:"body2",sx:{marginBottom:"24px",color:"#666"},children:"Generate 10-Day bulletins for ALL municipalities in a province with multiple crops in one operation."}),(0,t.jsxs)(p.ZP,{container:!0,spacing:3,children:[(0,t.jsx)(p.ZP,{item:!0,xs:12,md:6,children:(0,t.jsx)(d.Z,{sx:_.card,children:(0,t.jsxs)(x.Z,{children:[(0,t.jsx)(v.Z,{variant:"h6",sx:{marginBottom:"16px"},children:"Selection Options"}),(0,t.jsx)(o.Z,{sx:{marginBottom:"16px"},children:(0,t.jsx)(Z.Z,{disabled:X,options:D,value:P,onChange:(e,r)=>{N(r)},renderInput:e=>(0,t.jsx)(j.Z,{...e,label:"Select Province",size:"small"})})}),(0,t.jsx)(v.Z,{variant:"subtitle2",sx:{marginBottom:"12px"},children:"Select Crops (Only enabled crops with data will be generated):"}),(0,t.jsx)(h.Z,{children:O.map(e=>(0,t.jsx)(g.Z,{control:(0,t.jsx)(u.Z,{checked:T.includes(e.label),onChange:()=>z(e.label),disabled:X}),label:e.label},e.id))}),0===T.length&&(0,t.jsx)(f.Z,{severity:"info",sx:{marginTop:"12px"},children:"Select at least one crop to proceed"})]})})}),(0,t.jsx)(p.ZP,{item:!0,xs:12,md:6,children:(0,t.jsx)(d.Z,{sx:_.card,children:(0,t.jsxs)(x.Z,{children:[(0,t.jsx)(v.Z,{variant:"h6",sx:{marginBottom:"16px"},children:"Generation Summary"}),(0,t.jsxs)(o.Z,{sx:{marginBottom:"12px"},children:[(0,t.jsxs)(v.Z,{variant:"body2",children:[(0,t.jsx)("strong",{children:"Province:"})," ",P?P.label:"Not selected"]}),(0,t.jsxs)(v.Z,{variant:"body2",children:[(0,t.jsx)("strong",{children:"Selected Crops:"})," ",T.length>0?T.join(", "):"None"]})]}),P&&T.length>0&&(0,t.jsxs)(f.Z,{severity:"info",children:["Will generate bulletins for ALL municipalities in"," ",(0,t.jsx)("strong",{children:P.label})," for each selected crop"]})]})})}),(0,t.jsx)(p.ZP,{item:!0,xs:12,children:(0,t.jsxs)(o.Z,{sx:{display:"flex",gap:"12px"},children:[(0,t.jsx)(c.Z,{variant:"contained",color:"primary",onClick:F,disabled:X||!P||0===T.length,sx:{minWidth:"200px"},children:X?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.Z,{size:20,sx:{marginRight:"8px"}}),"Generating..."]}):"Generate All"}),W.success&&W.generated.length>0&&(0,t.jsxs)(c.Z,{variant:"contained",color:"success",onClick:M,sx:{minWidth:"200px"},children:["✓ Save ",W.generated.length," Bulletins"]}),(0,t.jsx)(c.Z,{variant:"outlined",onClick:()=>{N(null),R([]),I({isGenerating:!1,current:0,total:0,message:"",errors:[],generated:[],success:!1})},disabled:X,children:"Reset"})]})}),W.message&&(0,t.jsx)(p.ZP,{item:!0,xs:12,children:(0,t.jsxs)(o.Z,{sx:_.progressSection,children:[(0,t.jsx)(v.Z,{variant:"h6",sx:{marginBottom:"12px"},children:"Generation Progress"}),X&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(o.Z,{sx:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[(0,t.jsxs)(v.Z,{variant:"body2",children:[W.current," / ",W.total]}),(0,t.jsxs)(v.Z,{variant:"body2",children:[Y,"%"]})]}),(0,t.jsx)(m.Z,{variant:"determinate",value:Y,sx:{marginBottom:"12px",height:"8px"}})]}),(0,t.jsx)(f.Z,{severity:W.success?"success":X?"info":"error",sx:{marginBottom:"12px"},children:W.message}),W.errors.length>0&&(0,t.jsxs)(o.Z,{sx:{marginTop:"12px"},children:[(0,t.jsx)(v.Z,{variant:"subtitle2",sx:{marginBottom:"8px",color:"#d32f2f"},children:"Errors:"}),W.errors.slice(0,5).map((e,r)=>(0,t.jsxs)(v.Z,{variant:"caption",display:"block",sx:{color:"#d32f2f",marginBottom:"4px"},children:["• ",e.municipality," - ",e.crop,": ",e.error]},r)),W.errors.length>5&&(0,t.jsxs)(v.Z,{variant:"caption",sx:{color:"#d32f2f"},children:["... and ",W.errors.length-5," more errors"]})]}),W.generated.length>0&&(0,t.jsxs)(o.Z,{sx:{marginTop:"12px"},children:[(0,t.jsxs)(v.Z,{variant:"subtitle2",sx:{marginBottom:"8px",color:"#388e3c"},children:["Successfully Generated (",W.generated.length,"):"]}),W.generated.slice(0,5).map((e,r)=>(0,t.jsxs)(v.Z,{variant:"caption",display:"block",sx:{color:"#388e3c",marginBottom:"4px"},children:["✓ ",e.municipality," - ",e.crop]},r)),W.generated.length>5&&(0,t.jsxs)(v.Z,{variant:"caption",sx:{color:"#388e3c"},children:["... and ",W.generated.length-5," more"]})]})]})})]})]})})})},9704:function(e,r,n){"use strict";n.d(r,{Z:function(){return i}});var t=n(67294),s=n(61061);function i(){let[e,r]=(0,t.useState)([]),[n,i]=(0,t.useState)(!1),[a,l]=(0,t.useState)("");return(0,t.useEffect)(()=>{(async()=>{var e,n,t;try{i(!0);let n=await (0,s.TQ)();r(null!==(e=null==n?void 0:n.list)&&void 0!==e?e:[]),i(!1),l("")}catch(e){l(null!==(t=null==e?void 0:null===(n=e.response)||void 0===n?void 0:n.data)&&void 0!==t?t:e.message),i(!1),r([])}})()},[]),{cropList:e,loading:n,error:a}}},96281:function(e,r,n){"use strict";n.d(r,{m:function(){return t}});let t=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label";return e.map((e,n)=>({id:n,label:e[r]}))}}},function(e){e.O(0,[3153,7023,3745,1664,6541,8848,6294,6905,5837,4723,7368,8591,2888,9774,179],function(){return e(e.s=85786)}),_N_E=e.O()}]);