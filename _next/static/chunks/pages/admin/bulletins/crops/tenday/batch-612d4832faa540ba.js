(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6268],{85786:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bulletins/crops/tenday/batch",function(){return r(26390)}])},26390:function(e,n,r){"use strict";r.r(n);var t=r(85893),s=r(67294),i=r(9473),a=r(45773),l=r(65328),o=r(60990),c=r(51015),d=r(60762),x=r(71919),u=r(12166),g=r(65806),h=r(56894),p=r(68573),m=r(92608),j=r(26541),Z=r(96788),f=r(25837),v=r(44723),b=r(97182),y=r(97416),S=r(75941),B=r(46560),E=r(98813),_=r(96281),G=r(9704);let P={card:{padding:"16px",borderRadius:"8px",border:"1px solid #e0e0e0"},progressSection:{marginTop:"24px",padding:"16px",backgroundColor:"#f5f5f5",borderRadius:"8px"}};n.default=(0,l.Z)(function(e){let{user:n,onBtnLogoutClick:r,loading:l}=e,T=(0,s.useRef)(!0),w=(0,i.I0)(),[C,k]=(0,s.useState)(null),[N,R]=(0,s.useState)([]),[A,D]=(0,s.useState)([]),{cropList:L}=(0,G.Z)(),O=L.map(e=>({label:e,id:e})),[W,Y]=(0,s.useState)({isGenerating:!1,current:0,total:0,message:"",errors:[],generated:[],success:!1});(0,s.useEffect)(()=>(T.current=!0,(async()=>{try{let e=await (0,y.$m)();T.current&&D((0,_.m)(e.data))}catch(e){console.error("Error loading provinces:",e)}})(),()=>{T.current=!1}),[]);let I=e=>{R(n=>n.includes(e)?n.filter(n=>n!==e):[...n,e])},z=async()=>{if(!C||0===N.length){alert("Please select a province and at least one crop");return}Y({isGenerating:!0,current:0,total:N.length,message:"Starting batch generation...",errors:[],generated:[],success:!1});try{let e=await w((0,S.JC)({region:"mimaropa",province:C.label,crops:N})).unwrap();T.current&&(Y({isGenerating:!1,current:e.totalToGenerate,total:e.totalToGenerate,message:"Successfully generated ".concat(e.success," bulletins").concat(e.failed>0?" (".concat(e.failed," failed)"):""),errors:e.errors||[],generated:e.generated||[],success:0===e.failed}),w((0,B.uq)(E.REPORT_TYPE.TEN_DAY)),w((0,S.RC)({uid:n.uid,type:E.REPORT_TYPE.TEN_DAY})))}catch(e){T.current&&Y({isGenerating:!1,current:0,total:0,message:"Error: ".concat(e),errors:[{error:e.toString()}],generated:[],success:!1})}},F=()=>{k(null),R([]),Y({isGenerating:!1,current:0,total:0,message:"",errors:[],generated:[],success:!1})},M=W.isGenerating,X=W.total>0?Math.round(W.current/W.total*100):0;return(0,t.jsx)(a.Z,{loading:l,user:n,onBtnLogoutClick:r,accLevel:E.DW.ADMIN,children:(0,t.jsxs)(o.Z,{sx:{padding:"24px"},children:[(0,t.jsx)(Z.Z,{variant:"h4",sx:{marginBottom:"8px"},children:"Batch 10-Day Bulletin Generation"}),(0,t.jsx)(Z.Z,{variant:"body2",sx:{marginBottom:"24px",color:"#666"},children:"Generate 10-Day bulletins for ALL municipalities in a province with multiple crops in one operation."}),(0,t.jsxs)(p.ZP,{container:!0,spacing:3,children:[(0,t.jsx)(p.ZP,{item:!0,xs:12,md:6,children:(0,t.jsx)(d.Z,{sx:P.card,children:(0,t.jsxs)(x.Z,{children:[(0,t.jsx)(Z.Z,{variant:"h6",sx:{marginBottom:"16px"},children:"Selection Options"}),(0,t.jsx)(o.Z,{sx:{marginBottom:"16px"},children:(0,t.jsx)(f.Z,{disabled:M,options:A,value:C,onChange:(e,n)=>{k(n)},renderInput:e=>(0,t.jsx)(j.Z,{...e,label:"Select Province",size:"small"})})}),(0,t.jsx)(Z.Z,{variant:"subtitle2",sx:{marginBottom:"12px"},children:"Select Crops (Only enabled crops with data will be generated):"}),(0,t.jsx)(h.Z,{children:O.map(e=>(0,t.jsx)(g.Z,{control:(0,t.jsx)(u.Z,{checked:N.includes(e.label),onChange:()=>I(e.label),disabled:M}),label:e.label},e.id))}),0===N.length&&(0,t.jsx)(v.Z,{severity:"info",sx:{marginTop:"12px"},children:"Select at least one crop to proceed"})]})})}),(0,t.jsx)(p.ZP,{item:!0,xs:12,md:6,children:(0,t.jsx)(d.Z,{sx:P.card,children:(0,t.jsxs)(x.Z,{children:[(0,t.jsx)(Z.Z,{variant:"h6",sx:{marginBottom:"16px"},children:"Generation Summary"}),(0,t.jsxs)(o.Z,{sx:{marginBottom:"12px"},children:[(0,t.jsxs)(Z.Z,{variant:"body2",children:[(0,t.jsx)("strong",{children:"Province:"})," ",C?C.label:"Not selected"]}),(0,t.jsxs)(Z.Z,{variant:"body2",children:[(0,t.jsx)("strong",{children:"Selected Crops:"})," ",N.length>0?N.join(", "):"None"]})]}),C&&N.length>0&&(0,t.jsxs)(v.Z,{severity:"info",children:["Will generate bulletins for ALL municipalities in"," ",(0,t.jsx)("strong",{children:C.label})," for each selected crop"]})]})})}),(0,t.jsx)(p.ZP,{item:!0,xs:12,children:(0,t.jsxs)(o.Z,{sx:{display:"flex",gap:"12px"},children:[(0,t.jsx)(c.Z,{variant:"contained",color:"primary",onClick:z,disabled:M||!C||0===N.length,sx:{minWidth:"200px"},children:M?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b.Z,{size:20,sx:{marginRight:"8px"}}),"Generating..."]}):"Generate All"}),W.success&&W.generated.length>0&&(0,t.jsxs)(c.Z,{variant:"contained",color:"success",onClick:()=>{alert("".concat(W.generated.length," bulletins have been saved successfully!")),F()},sx:{minWidth:"200px"},children:["✓ Save ",W.generated.length," Bulletins"]}),(0,t.jsx)(c.Z,{variant:"outlined",onClick:F,disabled:M,children:"Reset"})]})}),W.message&&(0,t.jsx)(p.ZP,{item:!0,xs:12,children:(0,t.jsxs)(o.Z,{sx:P.progressSection,children:[(0,t.jsx)(Z.Z,{variant:"h6",sx:{marginBottom:"12px"},children:"Generation Progress"}),M&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(o.Z,{sx:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[(0,t.jsxs)(Z.Z,{variant:"body2",children:[W.current," / ",W.total]}),(0,t.jsxs)(Z.Z,{variant:"body2",children:[X,"%"]})]}),(0,t.jsx)(m.Z,{variant:"determinate",value:X,sx:{marginBottom:"12px",height:"8px"}})]}),(0,t.jsx)(v.Z,{severity:W.success?"success":M?"info":"error",sx:{marginBottom:"12px"},children:W.message}),W.errors.length>0&&(0,t.jsxs)(o.Z,{sx:{marginTop:"12px"},children:[(0,t.jsx)(Z.Z,{variant:"subtitle2",sx:{marginBottom:"8px",color:"#d32f2f"},children:"Errors:"}),W.errors.slice(0,5).map((e,n)=>(0,t.jsxs)(Z.Z,{variant:"caption",display:"block",sx:{color:"#d32f2f",marginBottom:"4px"},children:["• ",e.municipality," - ",e.crop,": ",e.error]},n)),W.errors.length>5&&(0,t.jsxs)(Z.Z,{variant:"caption",sx:{color:"#d32f2f"},children:["... and ",W.errors.length-5," more errors"]})]}),W.generated.length>0&&(0,t.jsxs)(o.Z,{sx:{marginTop:"12px"},children:[(0,t.jsxs)(Z.Z,{variant:"subtitle2",sx:{marginBottom:"8px",color:"#388e3c"},children:["Successfully Generated (",W.generated.length,"):"]}),W.generated.slice(0,5).map((e,n)=>(0,t.jsxs)(Z.Z,{variant:"caption",display:"block",sx:{color:"#388e3c",marginBottom:"4px"},children:["✓ ",e.municipality," - ",e.crop]},n)),W.generated.length>5&&(0,t.jsxs)(Z.Z,{variant:"caption",sx:{color:"#388e3c"},children:["... and ",W.generated.length-5," more"]})]})]})})]})]})})})},9704:function(e,n,r){"use strict";r.d(n,{Z:function(){return i}});var t=r(67294),s=r(61061);function i(){let[e,n]=(0,t.useState)([]),[r,i]=(0,t.useState)(!1),[a,l]=(0,t.useState)("");return(0,t.useEffect)(()=>{(async()=>{var e,r,t;try{i(!0);let r=await (0,s.TQ)();n(null!==(e=null==r?void 0:r.list)&&void 0!==e?e:[]),i(!1),l("")}catch(e){l(null!==(t=null==e?void 0:null===(r=e.response)||void 0===r?void 0:r.data)&&void 0!==t?t:e.message),i(!1),n([])}})()},[]),{cropList:e,loading:r,error:a}}},96281:function(e,n,r){"use strict";r.d(n,{m:function(){return t}});let t=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label";return e.map((e,r)=>({id:r,label:e[n]}))}}},function(e){e.O(0,[3153,6856,190,8583,1664,6541,955,4073,6455,5837,4723,4515,2705,8591,2888,9774,179],function(){return e(e.s=85786)}),_N_E=e.O()}]);