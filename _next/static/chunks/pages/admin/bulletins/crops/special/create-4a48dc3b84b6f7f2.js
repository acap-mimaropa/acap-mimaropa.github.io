(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4169],{45379:function(e,l,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bulletins/crops/special/create",function(){return n(17762)}])},17553:function(e,l,n){"use strict";var i=n(85893),a=n(67294),t=n(45697),s=n.n(t),o=n(70760),r=n(44723);let c=a.forwardRef(function(e,l){return(0,i.jsx)(r.Z,{elevation:6,ref:l,variant:"filled",...e})});function d(e){let{openSnackbar:l,message:n,severity:t="info",closeHandlerCB:s=()=>{}}=e,[r,d]=(0,a.useState)(l);(0,a.useEffect)(()=>{d(l)},[l]);let u=()=>{d(!1),s()},p=function(e){if(null==e)return"";if("string"==typeof e)return e;if(e instanceof Error)return e.message||e.toString();if("object"==typeof e&&"string"==typeof e.message)return e.message;try{return JSON.stringify(e)}catch(l){return String(e)}}(n);return(0,i.jsx)(o.Z,{open:r,autoHideDuration:3e3,onClose:u,children:(0,i.jsx)(c,{onClose:u,severity:t,sx:{width:"100%"},children:p})})}d.propTypes={openSnackbar:s().bool,message:s().any,severity:s().string,closeHandlerCB:s().func},l.Z=d},70165:function(e,l){"use strict";l.Z={container:{padding:"24px",width:"100%",position:"relative",minWidth:"0px",overflowWrap:"break-word",background:"#FFFFFF",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px",borderRadius:"16px",borderColor:"#E2E8F0"},welcome:{border:"1px solid #DCEDC8",borderRadius:e=>e.spacing(1),width:"100%",display:"grid",placeContent:"center",padding:"20px",marginTop:e=>e.spacing(1),textAlign:"center","& h6":{lineHeight:"20px"}},summary:{border:"1px solid #DCEDC8",borderRadius:e=>e.spacing(1),marginTop:e=>e.spacing(1),padding:e=>e.spacing(3)},selectionSummary:{minWidth:"100%",paddingLeft:{xs:0,lg:"16px"}},conditionLegend:{borderRadius:e=>e.spacing(1),width:"100%",padding:e=>e.spacing(1),border:"1px solid grey",textAlign:"center",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px",float:"left"},autocomplete:{marginTop:e=>e.spacing(1)},recSeasonal:{marginTop:e=>e.spacing(1),"& p, ul, ol":{fontSize:"14px"}},button:{color:"#FFFFFF",textTransform:"capitalize",fontSize:"14px",fontStyle:"normal",fontWeight:"normal",width:"80px",height:{xs:"40px",sm:"50px"}},pdfcontent:{ul:{paddingLeft:3}},recSeasonalStage:{marginTop:e=>e.spacing(5),marginBottom:e=>e.spacing(2),textDecoration:"underline"}}},17762:function(e,l,n){"use strict";n.r(l),n.d(l,{default:function(){return en}});var i=n(85893),a=n(67294),t=n(9473),s=n(11163),o=n(45697),r=n.n(o),c=n(41664),d=n.n(c),u=n(55292),p=n(25837),g=n(51015),v=n(49986),m=n(60990),h=n(68573),f=n(52857),x=n(26541),b=n(96788),_=n(2052),S=n(16729),y=n(57951),E=n(97182),j=n(81873),Z=n(56912),w=n(28907),C=n(88607),O=n(46560),T=n(25517),I=n(70165);function A(e){var l,n,s,o;let{options:r,smstext:c,loading:u}=e,{handleSave:p,handlePreview:f,show:x=!0,isCreateDisabled:_=!1}=e,S=(0,t.I0)(),{recommendations:y}=(0,t.v9)(e=>e.recommendations),{error:A,status:P}=(0,t.v9)(e=>e.reports),L=(0,t.v9)(e=>e.dashboard.isEnglish),[N,D]=(0,a.useState)(0),[R,k]=(0,a.useState)(!1);function F(e){let{children:l,value:n,index:a,...t}=e;return(0,i.jsx)("div",{role:"tabpanel",hidden:n!==a,id:"simple-tabpanel-".concat(a),"aria-labelledby":"simple-tab-".concat(a),...t,children:n===a&&(0,i.jsx)(m.Z,{sx:{p:3,whiteSpace:e.smsstyle},children:l})})}function G(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}return(0,a.useEffect)(()=>{k(r.loading||P===T.G.PENDING)},[r.loading,P]),(0,i.jsxs)(h.ZP,{container:!0,sx:I.Z.container,gap:3,style:{marginTop:"24px",padding:u?"16px":"24px"},children:[(0,i.jsxs)(h.ZP,{item:!0,sx:I.Z.item,xs:12,lg:12,children:[(0,i.jsx)(m.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,i.jsx)(E.Z,{size:16,color:"primary",sx:{display:u?"block":"none"}})}),(null==y?void 0:y.length)===1&&x&&(0,i.jsx)(m.Z,{children:(0,i.jsxs)(m.Z,{sx:{width:"100%",marginTop:{xs:"85px",lg:"0px"}},children:[(0,i.jsx)(m.Z,{sx:{borderBottom:1,borderColor:"divider"},children:(0,i.jsxs)(C.Z,{value:N,onChange:(e,l)=>{D(l)},"aria-label":"basic tabs example",children:[(0,i.jsx)(w.Z,{label:"PDF FORM",...G(0)}),(0,i.jsx)(w.Z,{label:"SMS FORM",...G(1)})]})}),(0,i.jsxs)(F,{value:N,index:0,smsstyle:"normal",children:[(0,i.jsxs)(m.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"40px"},children:[(0,i.jsx)(b.Z,{variant:"h4",children:"Impact Outlooks"}),(0,i.jsx)(j.Z,{size:"medium",variant:"outlined",label:L?"Tagalog":"English",onClick:()=>S((0,O.cX)()),sx:{width:"90px"}})]}),(null==y?void 0:y.length)===1&&(0,i.jsx)(m.Z,{sx:I.Z.recSeasonal,children:(0,i.jsx)("div",{style:{marginBottom:"80px"},dangerouslySetInnerHTML:{__html:L?null===(l=y[0])||void 0===l?void 0:l.impact_outlook_english:null===(n=y[0])||void 0===n?void 0:n.impact_outlook_tagalog}})}),(0,i.jsx)("hr",{}),(0,i.jsx)(b.Z,{variant:"h4",sx:{marginTop:"32px"},children:"Recommendations"}),(0,i.jsx)(m.Z,{sx:I.Z.recSeasonal,children:(0,i.jsx)("div",{style:{marginBottom:"48px"},dangerouslySetInnerHTML:{__html:L?null===(s=y[0])||void 0===s?void 0:s.management_recommendations_english:null===(o=y[0])||void 0===o?void 0:o.management_recommendations_tagalog}})})]}),(0,i.jsx)(F,{value:N,index:1,smsstyle:"pre-wrap",children:c})]})})]}),(0,i.jsxs)(m.Z,{sx:{marginBottom:"16px",width:"100%",display:(null==y?void 0:y.length)===1&&x?"block":"none"},children:[(0,i.jsx)("br",{}),(0,i.jsx)(Z.Z,{}),(0,i.jsx)("br",{}),""!==A&&(0,i.jsxs)(b.Z,{variant:"caption",sx:{color:"red"},children:["Error: ",A]}),(0,i.jsxs)(v.Z,{size:"large","aria-label":"large button group",sx:{display:"flex",justifyContent:"flex-end",marginTop:"8px"},children:[(0,i.jsx)(d(),{href:"/admin/bulletins/crops",passHref:!0,legacyBehavior:!0,children:(0,i.jsx)(g.Z,{disabled:R,children:"Cancel"})}),(0,i.jsxs)(g.Z,{onClick:f,disabled:R,children:[(0,i.jsx)("span",{style:{display:R?"none":"block"},children:"Preview"})," ","\xa0",(0,i.jsx)(E.Z,{size:20,color:"secondary",sx:{display:R?"block":"none"}})]}),(0,i.jsx)(g.Z,{variant:"contained",onClick:p,disableElevation:!0,disabled:R||_,children:"Save"})]})]})]})}A.propTypes={options:r().object,smstext:r().string,isCreateDisabled:r().bool,show:r().bool,loading:r().bool,handleSave:r().func,handlePreview:r().func};var P=n(24006),L=n(17553),N=n(88925),D=n(98813),R=n(71663);function k(e){var l;let[n,o]=(0,a.useState)(!1),r=(0,s.useRouter)(),c=(0,t.I0)(),{open:E,loading:j,isloadingreport:Z,isdisabled:w}=e,{optsprovinces:C,optsmunicipalities:O,optscrops:T,optswindsignals:I,sel_options:k}=e,{message:F,smstext:G,pageTitle:B="",pageDescription:H="",pdfPreview:M}=e,{handlePreview:W,handleSave:z,resetSelections:V,togglePrompt:Y,toggleViewerOpen:U,onSelectItemChange:q}=e,{report:J}=(0,t.v9)(e=>e.reports);(0,a.useEffect)(()=>{var e;!n||((null==k?void 0:null===(e=k.sel_signal)||void 0===e?void 0:e.code)===D.hi.SIGNAL_0?(null==k?void 0:k.sel_crop)||o(!1):k.sel_municipality||o(!1))},[null==k?void 0:k.sel_municipality,null==k?void 0:k.sel_crop,null==k?void 0:k.sel_signal,n]);let X=()=>{J&&(c((0,N.s_)()),r.push("/admin/bulletins/crops/report/view/?docId=".concat(J.id)))},K=e=>{let{options:l,valueNotNull:n,labelFetch:i,labelSelect:a="Select a province",labelValue:t="Province"}=e,s=null!=i?i:"Loading...";return l.length>0&&(s=null===n?a:t),s};return(0,i.jsxs)("div",{children:[(0,i.jsx)(S.Z,{isOpen:F.isOpen,maxWidth:"xs",openButtonText:null,title:F.title,contentText:F.msg,loading:F.loading,modalCancelHandlerCB:()=>{F.savesuccess?X():Y()},modalConfirmHandlerCB:()=>{F.savesuccess?X():z()}}),(0,i.jsx)(y.Z,{open:E,pdfPreview:M,error:k.error,loading:k.loading,toggleViewerOpen:U}),(0,i.jsx)(L.Z,{openSnackbar:""!==k.error,message:k.error,severity:"warning"}),(0,i.jsxs)(h.ZP,{container:!0,sx:R.Z.container,children:[(0,i.jsxs)(m.Z,{sx:R.Z.headerText,children:[(0,i.jsxs)(m.Z,{children:[(0,i.jsx)(b.Z,{variant:"h5",children:B}),(0,i.jsx)("p",{dangerouslySetInnerHTML:{__html:H}})]}),(0,i.jsx)(m.Z,{children:(0,i.jsx)(d(),{href:"/admin/bulletins/crops",passHref:!0,legacyBehavior:!0,children:(0,i.jsx)(f.Z,{"aria-label":"exit",size:"medium",children:(0,i.jsx)(u.Z,{fontSize:"inherit"})})})})]}),(0,i.jsxs)(h.ZP,{item:!0,sx:R.Z.item,xs:12,lg:4,children:[(0,i.jsx)(b.Z,{variant:"h6",children:"Selection Options"}),(0,i.jsx)(p.Z,{disablePortal:!0,id:"signal",size:"small",value:k.sel_signal,disabled:0===I.length||""!==k.error||j,options:I,sx:R.Z.autocomplete,PaperComponent:_.Z,renderInput:e=>(0,i.jsx)(x.Z,{...e,label:K({options:I,valueNotNull:null==k?void 0:k.sel_signal,labelSelect:"Select a wind signal",labelValue:"Wind Signal"})}),getOptionDisabled:e=>e.disabled,isOptionEqualToValue:(e,l)=>e.label===l,onChange:(e,l)=>{q(e,{...l,from:"signal"}),o(!1)}}),(0,i.jsx)(p.Z,{disablePortal:!0,id:"crop",size:"small",value:k.sel_crop,disabled:!(null==k?void 0:k.sel_signal)||0===T.length||""!==k.error||j,options:T,sx:R.Z.autocomplete,PaperComponent:_.Z,renderInput:e=>(0,i.jsx)(x.Z,{...e,label:K({options:T,valueNotNull:null==k?void 0:k.sel_crop,labelSelect:"Select crop",labelValue:"Crop"})}),getOptionDisabled:e=>e.disabled,isOptionEqualToValue:(e,l)=>e.label===l,onChange:(e,l)=>{q(e,{...l,from:"crop"}),o(!1)}}),(0,i.jsx)(p.Z,{disablePortal:!0,id:"province",size:"small",value:k.sel_province,disabled:0===C.length||!(null==k?void 0:k.sel_crop)||!(null==k?void 0:k.sel_signal)||(null==k?void 0:null===(l=k.sel_signal)||void 0===l?void 0:l.value)===0||""!==k.error||j,options:C,sx:R.Z.autocomplete,PaperComponent:_.Z,renderInput:e=>(0,i.jsx)(x.Z,{...e,label:K({options:C,valueNotNull:null==k?void 0:k.sel_province,labelFetch:"Select a province",labelSelect:"Select a province",labelValue:"Province"})}),getOptionDisabled:e=>e.disabled,isOptionEqualToValue:(e,l)=>e.label===l,onChange:(e,l)=>{q(e,{...l,from:"province"})}}),(0,i.jsx)(p.Z,{disablePortal:!0,id:"municipality",size:"small",value:k.sel_municipality,disabled:0===O.length||!(null==k?void 0:k.sel_crop)||""!==k.error||j,options:O,sx:R.Z.autocomplete,PaperComponent:_.Z,renderInput:e=>(0,i.jsx)(x.Z,{...e,label:null===k.sel_municipality?"Select a municipality":"Municipality"}),getOptionDisabled:e=>e.disabled||void 0!==e.iscalendar,isOptionEqualToValue:(e,l)=>e.label===l,onChange:(e,l)=>{q(e,{...l,from:"municipality"}),o(!1)}}),(0,i.jsxs)(v.Z,{disableElevation:!0,size:"small","aria-label":"outlined button controls group",disabled:Z||w,sx:{marginTop:"16px",float:"right"},children:[(0,i.jsx)(g.Z,{variant:"outlined",disabled:j||Z,onClick:V,children:"Reset"}),(0,i.jsx)(g.Z,{variant:"contained",onClick:()=>o(e=>!e),disabled:j||w||""!==k.error||n,children:"Generate"})]})]}),(0,i.jsx)(h.ZP,{item:!0,sx:R.Z.item,xs:12,lg:8,children:(0,i.jsx)(P.Z,{selecteditems:k,loading:j,reportType:"special"})})]}),(0,i.jsx)(A,{show:n,loading:j,options:k,smstext:G,isCreateDisabled:w,handlePreview:W,handleSave:Y})]})}k.propTypes={optsprovinces:r().array,optsmunicipalities:r().array,sel_options:r().object,loading:r().bool,isloadingreport:r().bool,isdisabled:r().bool,open:r().bool,message:r().object,smstext:r().string,pageTitle:r().string,pageDescription:r().string,pdfPreview:r().object,onSelectItemChange:r().func,handlePreview:r().func,handleSave:r().func,toggleViewerOpen:r().func,resetSelections:r().func,togglePrompt:r().func};var F=n(45773),G=n(65328),B=n(26525),H=n(88002),M=n(97416),W=n(75941),z=n(31695),V=n(32343),Y=n(9704),U=n(63867);let q=[{id:0,label:D.hl.general_no_signal,value:0,code:D.hi.SIGNAL_0,disabled:!1},{id:1,label:D.hl.signal_number_1,value:1,code:D.hi.SIGNAL_1,disabled:!0},{id:2,label:D.hl.signal_number_2,value:2,code:D.hi.SIGNAL_2,disabled:!0},{id:3,label:D.hl.signal_number_3,value:3,code:D.hi.SIGNAL_3,disabled:!0},{id:4,label:D.hl.signal_number_4,value:4,code:D.hi.SIGNAL_4,disabled:!0},{id:5,label:D.hl.signal_number_5,value:5,code:D.hi.SIGNAL_5,disabled:!0}];var J=n(22088);function X(e){let{crop:l,signal:n,type:i="special",isDispatch:s=!1}=e,[o,r]=(0,a.useState)([]),[c,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(""),g=(0,t.I0)();return(0,a.useEffect)(()=>{let e=async()=>{try{d(!0),g((0,V.nS)());let e=await (0,J.O_)({type:i,queryFields:[{field:"crop",op:"==",value:l},{field:"wind_signal",op:"==",value:n}]});if(d(!1),r(e),s&&g((0,V.lO)(e||[])),0===(e||[]).length)throw Error("No available recommendations")}catch(l){var e,a;p(null!==(a=null==l?void 0:null===(e=l.response)||void 0===e?void 0:e.data)&&void 0!==a?a:l.message),d(!1)}};l&&n&&e()},[l,n,i,s,g]),{recommendations:o,loading:c,error:u}}var K=n(18938),$=n(84325),Q=n(77457);let ee={url:"",filename:""},el={sel_province:null,sel_municipality:null,sel_crop:null,sel_signal:null,sel_typhoon:null,processed:!1,loading:!1,error:"",success:""};var en=(0,G.Z)(function(e){var l,n;let{user:s,onBtnLogoutClick:o,loading:r}=e,[c,d]=(0,a.useState)(el),[u,p]=(0,a.useState)([]),{status:g,report:v}=(0,t.v9)(e=>e.reports),m=(0,t.v9)(e=>e.dashboard.reportType),h=(0,t.v9)(e=>e.dashboard.isEnglish),[f,x]=(0,a.useState)(!0),[b,_]=(0,a.useState)(!1),S=(0,a.useRef)(!1),[y,E]=(0,a.useState)(ee),[j,Z]=(0,a.useState)($.BF),w=(0,t.I0)(),[C,I]=(0,K.ky)(H.K.GLOBAL_COLLECTIONS,H.K.CYCLONE_ADVISORY),[A,P]=(0,K.ky)(B.M.WEATHER_FORECASTS,"".concat("mimaropa","/").concat(B.M.SUB_SPECIAL_COMMON,"/").concat(B.M.COMMON_SPECIAL_TYPE.WIND_SPEED)),{windSignals:L}=function(e){let l=!(arguments.length>1)||void 0===arguments[1]||arguments[1],[n,i]=(0,a.useState)([]),[t,s]=(0,a.useState)(null);return(0,a.useEffect)(()=>{if(!l){if(0===(null!=e?e:[]).length)i(q);else{var n,a,t,o;let l=null==e?void 0:null===(a=e.data)||void 0===a?void 0:null===(n=a.signal)||void 0===n?void 0:n.map(e=>e.number);s(null==e?void 0:null===(o=e.data)||void 0===o?void 0:null===(t=o.meta)||void 0===t?void 0:t.typhoon_name),i(q.map(e=>({...e,disabled:0!==e.value&&!l.includes(e.value)})))}}},[e,l]),{windSignals:n,typhoon:t}}(C,I),{affectedprovinces:R}=function(e,l,n,i){let[t,s]=(0,a.useState)([]);return(0,a.useEffect)(()=>{if((null==e?void 0:e.data)&&(null==l?void 0:l.data)&&n.length>0&&null!==i){let l=e.data.filter(e=>e.signal===(null==i?void 0:i.value)).map(e=>e.province).filter((e,l,n)=>n.indexOf(e)===l),a=e.data.reduce((e,l)=>(void 0===e[l.province]&&(e[l.province]=[]),e[l.province]=[...e[l.province],...l.municipalities],{...e}),{}),t=[...n];t.forEach(n=>{n.disabled=!l.includes(n.label),n.municipalities.forEach(l=>{let i=e.data.findIndex(e=>e.province===l.province&&e.municipalities.includes(l.label));n.disabled?l.disabled=!0:(l.disabled=!a[n.label].includes(l.label),l.signal=i>-1?e.data[i].signal:0)})}),s(t)}},[e,l,n,i]),{affectedprovinces:t}}(A,C,u,null==c?void 0:c.sel_signal),G=(0,U.Z)(c.sel_province,R),{cropList:J,loading:en}=(0,Y.Z)(),ei=J.map((e,l)=>({disabled:!1,label:e,id:l})),ea=(0,a.useMemo)(()=>{var e,l;return((null===(e=c.sel_signal)||void 0===e?void 0:e.value)!==0||(null==c?void 0:c.sel_crop)===null)&&(!((null===(l=c.sel_signal)||void 0===l?void 0:l.value)>0)||!c.sel_province||!c.sel_municipality)},[c]),{loading:et,error:es}=X({type:"special",crop:null==c?void 0:c.sel_crop,signal:null==c?void 0:null===(l=c.sel_signal)||void 0===l?void 0:l.code,isDispatch:!0}),{recommendations:eo,loading:er,error:ec}=X({type:"special_sms",crop:null==c?void 0:c.sel_crop,signal:null==c?void 0:null===(n=c.sel_signal)||void 0===n?void 0:n.code}),ed=(0,a.useMemo)(()=>{if((null==eo?void 0:eo.length)>0&&C){var e,l,n;let i=eo[0].sms.replace("{{special_weather_name_identifier}}",null!==(n=null==C?void 0:null===(l=C.data)||void 0===l?void 0:null===(e=l.meta)||void 0===e?void 0:e.typhoon_name)&&void 0!==n?n:"-");return(null==c?void 0:c.sel_province)&&(null==c?void 0:c.sel_municipality)&&(i=i.replace("{{municipality_identifier}}","".concat(null==c?void 0:c.sel_province,", ").concat(null==c?void 0:c.sel_municipality))),i}return null},[eo,C,null==c?void 0:c.sel_province,null==c?void 0:c.sel_municipality]);(0,a.useEffect)(()=>(S.current=!0,(async()=>{try{let e=await (0,M.$m)();S&&p(e.data)}catch(e){}})(),()=>{S.current=!1}),[]),(0,a.useEffect)(()=>{w((0,V.nS)()),w((0,N.s_)())},[w]),(0,a.useEffect)(()=>{x(r||et||en||er||I===T.G.PENDING||P===T.G.PENDING)},[r,et,en,er,I,P,C,A,u,null==c?void 0:c.sel_signal]),(0,a.useEffect)(()=>{E(ee)},[h]),(0,a.useEffect)(()=>{if(""!==es){let e=es||ec;d(l=>({...l,error:e}))}else d(e=>({...e,error:""}))},[es,ec]),(0,a.useEffect)(()=>{g===T.G.FULLFILLED&&null!==v&&S.current&&Z(e=>({...e,msg:"Success! Bulletin report created.",loading:!1,savesuccess:!0,docId:v.id}))},[g,v]);let eu=async()=>{if(""!==y.url){_(!0);return}d(e=>({...e,loading:!0,error:"",success:""}));try{let e={region:"mimaropa",province:c.sel_province,municipality:c.sel_municipality,crop:c.sel_crop,language:h?"en":"tag",signal:null==c?void 0:c.sel_signal.code,operation:"preview"};_(!0),d(e=>({...e,loading:!0,error:""}));let l=await (0,z.U1)(e),n=new Blob([l],{type:"application/pdf"}),i={};i.href=URL.createObjectURL(n),i.download="".concat(c.sel_province,"_").concat(c.sel_municipality,".pdf"),E(e=>({...e,url:i.href,filename:i.download})),d(e=>({...e,loading:!1,success:"Bulletin preview created."}))}catch(l){let e=await (0,Q.fu)(l);d(l=>({...l,loading:!1,error:e}))}},ep=async()=>{Z({...j,loading:!0,msg:"Saving report..."});try{let e={region:"mimaropa",province:c.sel_province,municipality:c.sel_municipality,crop:c.sel_crop,language:h?"en":"tag",signal:null==c?void 0:c.sel_signal.code,operation:"create"};w((0,W.tR)(e)).unwrap().then(()=>{m!==$.Ry.SPECIAL_WEATHER&&(w((0,O.uq)($.Ry.SPECIAL_WEATHER)),w((0,W.RC)({uid:s.uid,type:$.Ry.SPECIAL_WEATHER})))}).catch(e=>{S.current&&Z(l=>({...l,msg:e,loading:!1,savesuccess:!1,docId:null}))})}catch(l){let e="";void 0!==l.response&&(e=void 0!==l.response.data&&"[object Blob]"==typeof l.response.data?l.response.data:""),""===e&&(e=l.message),d(l=>({...l,loading:!1,error:e}))}};return(0,i.jsx)(F.Z,{loading:r,user:s,onBtnLogoutClick:o,accLevel:D.DW.ADMIN,children:(0,i.jsx)(k,{optsprovinces:R,optsmunicipalities:G,optswindsignals:L,optscrops:ei,sel_options:c,loading:f,isloadingreport:g===T.G.PENDING,isdisabled:ea,open:b,message:j,smstext:ed,pageTitle:"Special Weather Bulletin",pageDescription:"Create <strong>Special Weather</strong> crop recommendations bulletins. Finalized bulletins will be automatically uploaded to the site for public download.",pdfPreview:y,onSelectItemChange:(e,l)=>{let{from:n,label:i}=l;if(E(ee),["signal","crop"].includes(n)&&w((0,V.nS)()),""!==c.error&&d(e=>({...e,error:""})),Object.keys(l).includes("id"))switch(n){case"signal":var a,t,s;d({...el,sel_signal:l,sel_typhoon:(null==l?void 0:l.code)===D.hi.SIGNAL_0?"(General - No Signal)":null!==(s=null==C?void 0:null===(t=C.data)||void 0===t?void 0:null===(a=t.meta)||void 0===a?void 0:a.typhoon_name)&&void 0!==s?s:"-"});break;case"crop":d(e=>({...e,sel_crop:i}));break;case"province":d(e=>({...e,sel_province:i,sel_municipality:null}));break;case"municipality":d(e=>({...e,sel_municipality:i}))}else"signal"===n?d(el):"crop"===n?d(e=>({...e,sel_crop:null})):"province"===n?d(e=>({...e,sel_province:null,sel_municipality:null})):"municipality"===n&&d(e=>({...e,sel_municipality:null}))},handlePreview:eu,handleSave:ep,toggleViewerOpen:()=>{_(e=>!e)},resetSelections:()=>{d(el),w((0,V.nS)())},togglePrompt:()=>{Z(e=>({...$.BF,isOpen:!e.isOpen}))}})})})},63867:function(e,l,n){"use strict";n.d(l,{Z:function(){return a}});var i=n(67294);function a(e,l){let[n,a]=(0,i.useState)([]);return(0,i.useEffect)(()=>{var n,i;a(e&&l&&null!==(i=null===(n=l.find(l=>l.label===e))||void 0===n?void 0:n.municipalities)&&void 0!==i?i:[])},[e,l]),n}},18938:function(e,l,n){"use strict";n.d(l,{Kx:function(){return o},ky:function(){return s},m$:function(){return r},tl:function(){return c}});var i=n(67294),a=n(36100),t=n(20988);function s(e,l){let[n,s]=(0,i.useState)(null),[o,r]=(0,i.useState)(!0),[c,d]=(0,i.useState)(""),u=(0,i.useRef)(!0);return(0,i.useEffect)(()=>((async()=>{try{let n=(0,a.JU)(t.db,e,l),i=await (0,a.QT)(n);u.current&&(i.exists()&&s(i.data()),r(!1))}catch(e){d(e.message),r(!1)}})(),()=>u.current=!1),[e,l]),[n,o,c]}function o(e,l){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,[o,r]=(0,i.useState)([]),[c,d]=(0,i.useState)(!0),[u,p]=(0,i.useState)(""),g=(0,i.useRef)(!0);return(0,i.useEffect)(()=>((async()=>{try{let i=[(0,a.Xo)(l,"asc")];s>0&&i.push((0,a.b9)(s));let o=(0,a.hJ)(t.db,e),c=n||(0,a.IO)(o,...i),u=await (0,a.PL)(c);g.current&&(r(u.docs.map(e=>({...e.data()}))),d(!1))}catch(e){p(e.message),d(!1)}})(),()=>g.current=!1),[e,l,n,s]),{documents:o,loading:c,error:u}}function r(e,l,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",[o,r]=(0,i.useState)([]),[c,d]=(0,i.useState)(!0),[u,p]=(0,i.useState)(""),g=(0,i.useRef)(!0);return(0,i.useEffect)(()=>((async()=>{try{let i=(0,a.IO)((0,a.hJ)(t.db,e,l,n),(0,a.Xo)(s)),o=await (0,a.PL)(i);g.current&&(r(o.docs.map(e=>({...e.data()}))),d(!1))}catch(e){p(e.message),d(!1)}})(),()=>g.current=!1),[e,l,n,s]),{documents:o,loading:c,error:u}}function c(e,l,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4?arguments[4]:void 0,[r,c]=(0,i.useState)([]),[d,u]=(0,i.useState)(!0),[p,g]=(0,i.useState)(""),v=(0,i.useRef)(!0);return(0,i.useEffect)(()=>((async()=>{try{let i=(0,a.hJ)(t.db,e,l,n);""!==s&&(i=(0,a.IO)(i,(0,a.Xo)(s))),o&&(i=(0,a.IO)(i,(0,a.b9)(o)));let r=await (0,a.PL)(i);v.current&&(c(r.docs.map(e=>({...e.data()}))),u(!1))}catch(e){g(e.message),u(!1)}})(),()=>v.current=!1),[e,l,n,s,o]),{documents:r,loading:d,error:p}}},88002:function(e,l,n){"use strict";n.d(l,{K:function(){return o},d:function(){return r}});var i=n(96171),a=n(20988),t=n(98813),s=n(84325);let o={MEDIA_ASSETS:"n_page_media",ASSETS:"n_page_assets",PAGE_SEARCH:"n_page_search",GLOBAL_COLLECTIONS:"w_services",TYPHOON_ADVISORY:"typhoon_advisory",CYCLONE_ADVISORY:"cyclone_advisory"};class r extends i.Z{constructor(...e){var l;super(...e),l=this,this.getPageAssetsDoc=async function(e,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=[];try{if(!(a=await l.getDocumentData(o.ASSETS,e)))return[];if(!n)return a;if(i)return a.data.filter(e=>e.page===n);return a.data.filter(e=>e.page===n).map(e=>e.url)}catch(e){throw console.error(e.message),Error(e.message)}},this.getTyphoonAdvisory=async()=>{let e=this.doc(this.db,o.GLOBAL_COLLECTIONS,o.TYPHOON_ADVISORY),l=await this.getDoc(e);return l.exists()?l.data():null},this.getWeatherForecast=async(e,l)=>await this.getNestedCollectionData(o.WEATHER_FORECASTS,e,l,"name"),this.getPdfDownloadURL=async function(e){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.Ry.SEASONAL,n="";switch(l){case s.Ry.SEASONAL:n=t.Do.PDF_STORAGE_SEASONAL;break;case s.Ry.TEN_DAY:n=t.Do.PDF_STORAGE_TENDAY;break;case s.Ry.SPECIAL_WEATHER:n=t.Do.PDF_STORAGE_SPECIAL}try{let l="acap-mimaropa-d77f1";if(l)return"https://storage.googleapis.com/".concat(l,"/").concat(n,"/").concat(e);let i=(0,a.iH)(a.tO,"".concat(n,"/").concat(e));return await (0,a.Jt)(i)}catch(e){throw Error(e.message)}}}}}},function(e){e.O(0,[3153,6856,190,8583,1664,6541,955,4073,6455,6080,5837,4723,760,3338,8591,4381,2888,9774,179],function(){return e(e.s=45379)}),_N_E=e.O()}]);