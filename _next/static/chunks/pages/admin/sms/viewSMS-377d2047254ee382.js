(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8226],{91395:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/sms/viewSMS",function(){return n(48600)}])},29365:function(e,t){"use strict";t.Z={button:{color:"#FFFFFF",textTransform:"capitalize",fontSize:"14px",fontStyle:"normal",fontWeight:"normal",width:"80px",height:{xs:"40px",sm:"48px"}},container:{padding:"24px",width:"100%",position:"relative",minWidth:"0px",overflowWrap:"break-word",background:"#FFFFFF",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px",borderRadius:"16px",margin:"auto",borderColor:"#E2E8F0"},tabsContainer:{marginTop:e=>e.spacing(8),border:e=>"1px solid ".concat(e.palette.bacap.border),minHeight:"800px",borderRadius:"8px",background:"#FFFFFF",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px"},customizedButtonLink:{cursor:"pointer",color:"#8BC24A",textDecoration:"underline",fontWeight:600}}},42823:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var i=n(85893),a=n(25675),o=n.n(a),r=n(60990),l=n(96788),s=n(71604),d={textAlign:"center",minHeight:"200px",width:"100%",border:"4px solid rgba(0, 0, 0, 0.11)",borderRadius:e=>e.spacing(2),color:e=>e.palette.text.secondary,borderStyle:"dashed",padding:e=>e.spacing(2),marginTop:e=>e.spacing(4)},c=function(e){let{message:t="Failed to load data",style:n={}}=e;return(0,i.jsxs)(r.Z,{sx:d,style:n,children:[(0,i.jsx)(o(),{unoptimized:!0,src:(0,s.assetPrefixer)("images/icons/empty-state-light.svg"),height:120,width:120,loader:s.imageLoader,alt:"Empty data"}),(0,i.jsx)(l.Z,{variant:"subtitle1",children:t})]})}},40155:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var i=n(85893),a=n(60990),o=n(56912),r=n(84324),l={padding:"24px",width:"100%",position:"relative",minWidth:"0px",overflowWrap:"break-word",background:"#FFFFFF",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px",borderRadius:"16px",margin:"auto",borderColor:"#E2E8F0"},s={marginTop:"32px",marginBottom:"32px"},d={marginTop:"16px",marginBottom:"16px"},c=function(){return(0,i.jsxs)(a.Z,{sx:l,children:[(0,i.jsx)(a.Z,{sx:{width:"300px"},children:[1,2,3,4,5,6,7,8].map(e=>(0,i.jsx)(r.Z,{variant:"text"},"up-".concat(e)))}),(0,i.jsx)(o.Z,{sx:s}),(0,i.jsx)(a.Z,{children:[1,2,3,4,5,6,7,8].map(e=>(0,i.jsx)(r.Z,{variant:"rectangular",sx:d},"down-".concat(e)))})]})}},76975:function(e,t){"use strict";t.Z={htmlReportHR:{color:"rgba(0, 0, 0, 0.87)",fontWeight:400,fontSize:"1rem",lineHeight:"1.5",flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:"rgba(0, 0, 0, 0.12)",borderBottomWidth:"thin",margin:"48px 0 48px 0"},details:{maxWidth:{md:"60%",sm:"100%"},"& div":{marginBottom:"4px"},"& p":{color:e=>e.palette.grey[800]}},content:{"& h2":{fontFamily:"Roboto, Helvetica, Arial, sans-serif",fontWeight:400,fontSize:"1.5rem",lineHeight:1.334,letterSpacing:"0em",textDecoration:"underline"},"& h3":{fontFamily:"Roboto, Helvetica, Arial, sans-serif",fontWeight:500,fontSize:"1.25rem",lineHeight:1.6,letterSpacing:"0.0075em",color:"rgba(0, 0, 0, 0.67)"},"& li":{fontSize:"14px"}}}},48600:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return q}});var i=n(85893),a=n(67294),o=n(11163),r=n(65328),l=n(31695),s=n(40923),d=n(45773),c=n(98813),u=n(92246),m=n(60990),p=n(96788),h=n(49986),x=n(51015),f=n(56912),g=n(68573),b=n(11032),v=n(59591),T=n(24022),S=n(29204),C=n(31051),E=n(31121),N=n(65806),j=n(6897),O=n(92878),y=n(61730),I=n(9669),R=n.n(I),Z=n(15426);let A={SEND_SMS_RECOMMENDATIONS:"".concat("https://acap-mimaropa-server.onrender.com/api","/send")};class D extends Z.Z{async sendSMS(e){let t=await this.createRequestObject({body:e});return(await R()({...t,url:A.SEND_SMS_RECOMMENDATIONS,method:"POST"})).data}}let _=new D,w=_.sendSMS.bind(_);var F=n(40155),k=n(42823),M=n(16729),P=n(84325),W=n(67812),L=n(29365),B=n(76975),G=n(51963),U=n(77208),z=n(14971);let H=(0,U.Z)();H.typography.h5={fontSize:"1.2rem","@media (min-width:600px)":{fontSize:"1.5rem"},[H.breakpoints.up("md")]:{fontSize:"2rem"}};var X=function(e){let{contacts:t,contactsState:n,onBackBtnClick:r,report:l,setReport:s,loading:d}=e,[c,u]=(0,a.useState)(null),[I,R]=(0,a.useState)(null),[Z,A]=(0,a.useState)([]),D=(0,o.useRouter)(),{fieldValues:_}=(0,G.Z)(l,[W.X3.REGION,W.X3.TYPE,W.X3.UID,W.X3.ID]);(0,a.useEffect)(()=>{0!==t.length&&X(t.filter(e=>e.subscribed_crops.includes(l.crop)))},[t,l.crop,X]);let U=(e,t,n)=>{let i=e.target.checked?n:null;i&&(u(i),A(I[t][n].map(e=>e.cellnumber)))},X=(0,a.useCallback)(e=>{R(e.reduce((e,t)=>(e[t.province]||(e[t.province]={}),e[t.province][t.municipality]||(e[t.province][t.municipality]=[]),t.subscribed_crops.includes(l.crop)&&e[t.province][t.municipality].push(t),e),{}))},[l.crop,R]),Y=(0,y.Z)(H.breakpoints.between("xs","md")),q=async()=>{if(""===l.info){s({...l,sending:!0});let e=[],n=[];Z.map(i=>{let a=t.find(e=>e.cellnumber===i);a?(e.push(a.cellnumber),n.push(""===a.name?a.cellnumber:a.name)):e.push(i)});try{await w({docId:l.id,recipientsNumber:e.toString(),message:l.smsRecommendations,currentSmsLogs:(null==l?void 0:l.logs)?l.logs:[],recipientsWithName:n.toString()}),s(e=>({...e,sending:!1,info:"Crop Recommendation sent."}))}catch(e){D.push({pathname:"/admin/sms/",query:{isSent:!1}},"/admin/sms/"),console.error(e.message)}}else D.push({pathname:"/admin/sms/"})},K=()=>{D.push({pathname:"/admin/sms/",query:{toAddContact:!0}},"/admin/sms/")};return(0,i.jsx)("div",{children:d||l.loading?(0,i.jsx)(F.Z,{}):void 0!==l.stages?(0,i.jsxs)(m.Z,{container:!0,sx:L.Z.container,children:[(0,i.jsxs)(m.Z,{sx:{marginBottom:"32px",display:"flex",justifyContent:"space-between"},children:[(0,i.jsx)(z.Z,{theme:H,children:(0,i.jsxs)(m.Z,{children:[(0,i.jsx)(p.Z,{variant:"h5",children:"Send Text-Form Crop Recommendation"}),(0,i.jsx)(p.Z,{variant:"h6",children:P.eT[l.type]})]})}),(0,i.jsxs)(h.Z,{orientation:Y?"vertical":"horizontal",children:[(0,i.jsx)(x.Z,{disableElevation:!0,variant:"outlined",color:"primary",sx:{...L.Z.button,color:e=>e.palette.primary.main,borderTopRightRadius:0,borderBottomRightRadius:0},onClick:r,children:"Back"}),(0,i.jsx)(M.Z,{isDisabled:0===Z.length||(null==l?void 0:l.smsRecommendations)===void 0,isOpen:!1,maxWidth:"sm",openButtonText:"Send",title:"Send Crop Recommendation",contentText:""!==l.info?l.info:"Sending this allows your contacts to receive the Text-Form Crop Recommendation on their cellphone numbers as text.",confirmBtnText:""!==l.info?"Ok":"Send",modalConfirmHandlerCB:q,loading:l.sending,modalButtonStyles:{borderTopLeftRadius:0,borderBottomLeftRadius:0,width:"80px"}})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)(m.Z,{sx:B.Z.details,children:[_.map(e=>{var t;return(0,i.jsx)("div",{children:(0,i.jsxs)(p.Z,{variant:"body2",children:[(0,i.jsxs)("strong",{children:[null==e?void 0:e.label,": "]})," ",null!==(t=null==e?void 0:e.value)&&void 0!==t?t:"-"]})},e.id)}),(0,i.jsxs)(p.Z,{variant:"caption",children:[(0,i.jsx)("strong",{children:"ID:"})," ",l.id]})]}),(0,i.jsx)(f.Z,{sx:{marginTop:"32px"}})]}),(0,i.jsxs)(g.ZP,{container:!0,style:{paddingTop:"10px"},children:[(0,i.jsxs)(g.ZP,{item:!0,xs:12,md:5,children:[(0,i.jsx)(p.Z,{variant:"h6",children:"Text-Form Crop Recommendation"}),(0,i.jsx)(b.Z,{children:(null==l?void 0:l.smsRecommendations)||(0,i.jsx)("span",{style:{color:"#ff1744"},children:"No SMS Recommendations available."})})]}),(0,i.jsxs)(g.ZP,{item:!0,xs:12,md:7,children:[(0,i.jsx)(p.Z,{variant:"h6",children:"List of Contacts"}),n.loading?(0,i.jsx)("div",{children:"Loading phonebook..."}):""!==n.error?(0,i.jsx)("div",{children:n.error}):t.length>0?(0,i.jsxs)("div",{children:[(0,i.jsx)(m.Z,{children:(0,i.jsxs)(p.Z,{variant:"body2",children:["These are your contacts that you can send the recommendation thru SMS.",(0,i.jsx)("br",{}),"Need to change some of your contacts? Click"," ",(0,i.jsx)("span",{onClick:K,style:L.Z.customizedButtonLink,children:"here"}),"."]})}),(0,i.jsx)("br",{}),(0,i.jsx)("div",{children:I&&Object.keys(I).sort().map((e,t)=>(0,i.jsxs)(v.Z,{children:[(0,i.jsx)(T.Z,{expandIcon:(0,i.jsx)(C.Z,{}),"aria-controls":"panel1-content",id:"panel1-header",children:e}),(0,i.jsx)(S.Z,{children:Object.keys(I[e]).sort().map(t=>(0,i.jsx)(j.Z,{children:(0,i.jsx)(O.Z,{"aria-labelledby":"demo-radio-buttons-group-label",defaultValue:"female",name:"radio-buttons-group",value:c,onChange:e=>u(e.target.value),children:(0,i.jsx)(N.Z,{onClick:n=>U(n,e,t),control:(0,i.jsx)(E.Z,{}),label:t,value:t})})},t))})]},t))})]}):(0,i.jsx)("div",{children:(0,i.jsxs)(p.Z,{variant:"subtitle1",children:["No contacts yet. Please add contacts first in your Phonebook\xa0",(0,i.jsx)("span",{onClick:K,style:L.Z.customizedButtonLink,children:"here"}),"."]})})]})]})]}):(0,i.jsx)(k.Z,{})})};let Y={loading:!0,error:"",info:"",sending:!1};var q=(0,r.Z)(function(e){let[t,n]=(0,a.useState)(Y),[r,m]=(0,a.useState)(Y),[p,h]=(0,a.useState)([]),x=(0,o.useRouter)();return(0,a.useEffect)(()=>{if(t.loading&&Object.keys(x.query).length>0&&null!==e.user){let e=async()=>{try{m({...Y,loading:!0});let e=await (0,s.K2)();h(t=>e),m(e=>({...e,loading:!1}))}catch(e){n(t=>({...Y,loading:!1,error:e.message})),m(t=>({...Y,loading:!1,error:e.message}))}};(async()=>{try{let e=await (0,l.QL)(x.query.docId),t=e.date_created.toDate();e.date_created="".concat(t.toDateString()," ").concat(t.toLocaleTimeString("it-IT",u.W6)),n(t=>({...t,loading:!1,...e}))}catch(e){n({...Y,loading:!1,error:e.message})}})(),e()}},[x,t.loading,e.user]),(0,i.jsx)(d.Z,{loading:e.loading,user:e.user,onBtnLogoutClick:e.onBtnLogoutClick,accLevel:c.DW.ADMIN,children:(0,i.jsx)(X,{setReport:n,report:t,loading:e.loading,contacts:p,contactsState:r,onBackBtnClick:()=>{x.push("/admin/sms/")}})})})},67812:function(e,t,n){"use strict";n.d(t,{$P:function(){return r},GW:function(){return o},I4:function(){return s},KM:function(){return d},X3:function(){return i},qv:function(){return a},vU:function(){return l}});let i={UID:"uid",ID:"id",REGION:"region",PROVINCE:"province",MUNICIPALITY:"municipality",TYPE:"type",CROP:"crop",STAGES:"stages",ACTIVITIES:"activities",MONTH:"month",CONDITION:"condition",CONDITIONS:"conditions",RISK:"risk",DATE_RANGE:"date_range",RAINFALL:"rainfall",TYPHOON:"typhoon",WIND_SIGNAL:"wind_signal",RECOMMENDATIONS:"recommendations",SMS_RECOMMENDATIONS:"smsRecommendations",UPDATED_BY:"updated_by",DATE_CREATED:"date_created"},a=[{field:i.REGION,label:"Region"},{field:i.PROVINCE,label:"Province"},{field:i.MUNICIPALITY,label:"Municipality"},{field:i.TYPE,label:"Report Type"},{field:i.CROP,label:"Crop"}],o=[{field:i.MONTH,label:"Month"},{field:i.STAGES,label:"Crop Stage(s)"},{field:i.ACTIVITIES,label:"Farming Activities"},{field:i.RISK,label:"Climate Risk"}],r=[{field:i.CONDITION,label:"Weather Condition"},{field:i.CONDITIONS,label:"Weather Condition"}],l=[{field:i.DATE_RANGE,label:"Weather data validity"},{field:i.RAINFALL,label:"Weather Condition"}],s=[{field:i.TYPHOON,label:"Typhoon Name"},{field:i.WIND_SIGNAL,label:"Wind Signal No."}],d={CROP_RECOMMENDATIONS:[{field:i.RECOMMENDATIONS,label:"Recommendations"},{field:i.SMS_RECOMMENDATIONS,label:"SMS Recommendations"}],USER_INFO:[{field:i.UPDATED_BY,label:"Created by"},{field:i.DATE_CREATED,label:"Date created"},{field:i.UID,label:"User ID"},{field:i.ID,label:"ID"}]}},51963:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var i=n(67294),a=n(98813),o=n(67812);function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],[n,r]=(0,i.useState)([]),l=(e,t)=>{var n,i,r,l,s,d;let c="";switch(e){case o.X3.CONDITIONS:for(let e=0;e<(null!=t?t:[]).length;e+=1)c+="".concat(null===(n=a.re[null===(r=t[e])||void 0===r?void 0:null===(i=r.mo)||void 0===i?void 0:i.toUpperCase()])||void 0===n?void 0:n.format,": ")+(null!==(s=null===(l=Object.values(a.MW).find(n=>{var i;return n.label===(null===(i=t[e])||void 0===i?void 0:i.con)}))||void 0===l?void 0:l.sync)&&void 0!==s?s:"n/a"),e<t.length-1&&(c+=", ");break;case o.X3.CONDITION:c=(null===(d=Object.values(a.MW).find(e=>e.label===t))||void 0===d?void 0:d.sync)||"n/a";break;default:c=t}return Array.isArray(c)&&(c=c.toString().split(",").join(", ")),null!=c?c:"n/a"};return(0,i.useEffect)(()=>{if(!(null==e?void 0:e.id)||n.length>0)return;let i=[...o.qv];"seasonal"===e[o.X3.TYPE]&&(i=[...i,...o.GW,...o.$P,...o.KM.USER_INFO]),"ten_day"===e[o.X3.TYPE]&&(i=[...i,...o.GW,...o.vU,...o.KM.USER_INFO]),"special_weather"===e[o.X3.TYPE]&&(i=[...i,...o.I4,...o.KM.USER_INFO]),r(i.map((t,n)=>({...t,id:n,value:l(t.field,null==e?void 0:e[t.field])})).filter(e=>!t.includes(e.field)&&!["-","n/a"].includes(e.value)))},[e,t,n]),{fieldValues:n}}},40923:function(e,t,n){"use strict";n.d(t,{rE:function(){return d},GK:function(){return c},mP:function(){return u},K2:function(){return m}});var i=n(9669),a=n.n(i),o=n(15426);let r={CREATE_CONTACT:"".concat("https://acap-mimaropa-server.onrender.com/api","/contact"),DELETE_CONTACT:"".concat("https://acap-mimaropa-server.onrender.com/api","/contact"),EDIT_CONTACT:"".concat("https://acap-mimaropa-server.onrender.com/api","/contact"),GET_CONTACTS:"".concat("https://acap-mimaropa-server.onrender.com/api","/contacts")};class l extends o.Z{async createContact(e){let t=await this.createRequestObject({body:e});return(await a()({...t,url:r.CREATE_CONTACT,method:"POST"})).data}async deleteContact(e){let t=await this.createRequestObject({body:e});return(await a()({...t,url:r.DELETE_CONTACT,method:"DELETE"})).data}async editContact(e){let t=await this.createRequestObject({body:e});return(await a()({...t,url:r.EDIT_CONTACT,method:"PATCH"})).data}async getContacts(){let e=await this.createRequestObject({});return(await a()({...e,url:r.GET_CONTACTS,method:"GET"})).data.contacts}}let s=new l,d=s.createContact.bind(s),c=s.deleteContact.bind(s),u=s.editContact.bind(s),m=s.getContacts.bind(s)}},function(e){e.O(0,[3153,7023,3745,1664,955,7958,4073,4959,6080,6547,9619,7628,4588,2888,9774,179],function(){return e(e.s=91395)}),_N_E=e.O()}]);