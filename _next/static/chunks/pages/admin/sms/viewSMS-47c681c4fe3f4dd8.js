(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8226],{91395:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/sms/viewSMS",function(){return n(48600)}])},29365:function(e,t){"use strict";t.Z={button:{color:"#FFFFFF",textTransform:"capitalize",fontSize:"14px",fontStyle:"normal",fontWeight:"normal",width:"80px",height:{xs:"40px",sm:"48px"}},container:{padding:"24px",width:"100%",position:"relative",minWidth:"0px",overflowWrap:"break-word",background:"#FFFFFF",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px",borderRadius:"16px",margin:"auto",borderColor:"#E2E8F0"},tabsContainer:{marginTop:e=>e.spacing(8),border:e=>"1px solid ".concat(e.palette.bacap.border),minHeight:"800px",borderRadius:"8px",background:"#FFFFFF",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px"},customizedButtonLink:{cursor:"pointer",color:"#8BC24A",textDecoration:"underline",fontWeight:600}}},48600:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Q}});var i=n(85893),a=n(67294),o=n(11163),r=n(65328),s=n(31695),c=n(40923),d=n(45773),l=n(98813),u=n(92246),m=n(60990),h=n(96788),p=n(49986),x=n(51015),g=n(56912),b=n(68573),j=n(11032),C=n(59591),f=n(24022),T=n(29204),v=n(31051),S=n(31121),Z=n(51778),y=n(6897),E=n(92878),k=n(61730),w=n(9669),R=n.n(w),_=n(15426);let O={SEND_SMS_RECOMMENDATIONS:"".concat("https://amia-cis-tmtk.onrender.com/api","/send")};class N extends _.Z{async sendSMS(e){let t=await this.createRequestObject({body:e});return(await R()({...t,url:O.SEND_SMS_RECOMMENDATIONS,method:"POST"})).data}}let F=new N,D=F.sendSMS.bind(F);var A=n(40155),B=n(42823),L=n(16729),I=n(84325),M=n(67812),P=n(29365),q=n(76975),z=n(51963),W=n(77208),X=n(14971);let G=(0,W.Z)();G.typography.h5={fontSize:"1.2rem","@media (min-width:600px)":{fontSize:"1.5rem"},[G.breakpoints.up("md")]:{fontSize:"2rem"}};var H=function(e){let{contacts:t,contactsState:n,onBackBtnClick:r,report:s,setReport:c,loading:d}=e,[l,u]=(0,a.useState)(null),[w,R]=(0,a.useState)(null),[_,O]=(0,a.useState)([]),N=(0,o.useRouter)(),{fieldValues:F}=(0,z.Z)(s,[M.X3.REGION,M.X3.TYPE,M.X3.UID,M.X3.ID]);(0,a.useEffect)(()=>{0!==t.length&&H(t.filter(e=>e.subscribed_crops.includes(s.crop)))},[t,s.crop,H]);let W=(e,t,n)=>{let i=e.target.checked?n:null;i&&(u(i),O(w[t][n].map(e=>e.cellnumber)))},H=(0,a.useCallback)(e=>{R(e.reduce((e,t)=>(e[t.province]||(e[t.province]={}),e[t.province][t.municipality]||(e[t.province][t.municipality]=[]),t.subscribed_crops.includes(s.crop)&&e[t.province][t.municipality].push(t),e),{}))},[s.crop,R]),K=(0,k.Z)(G.breakpoints.between("xs","md")),Q=async()=>{if(""===s.info){c({...s,sending:!0});let e=[],n=[];_.map(i=>{let a=t.find(e=>e.cellnumber===i);a?(e.push(a.cellnumber),n.push(""===a.name?a.cellnumber:a.name)):e.push(i)});try{await D({docId:s.id,recipientsNumber:e.toString(),message:s.smsRecommendations,currentSmsLogs:(null==s?void 0:s.logs)?s.logs:[],recipientsWithName:n.toString()}),c(e=>({...e,sending:!1,info:"Crop Recommendation sent."}))}catch(e){N.push({pathname:"/admin/sms/",query:{isSent:!1}},"/admin/sms/"),console.error(e.message)}}else N.push({pathname:"/admin/sms/"})},U=()=>{N.push({pathname:"/admin/sms/",query:{toAddContact:!0}},"/admin/sms/")};return(0,i.jsx)("div",{children:d||s.loading?(0,i.jsx)(A.Z,{}):void 0!==s.stages?(0,i.jsxs)(m.Z,{container:!0,sx:P.Z.container,children:[(0,i.jsxs)(m.Z,{sx:{marginBottom:"32px",display:"flex",justifyContent:"space-between"},children:[(0,i.jsx)(X.Z,{theme:G,children:(0,i.jsxs)(m.Z,{children:[(0,i.jsx)(h.Z,{variant:"h5",children:"Send Text-Form Crop Recommendation"}),(0,i.jsx)(h.Z,{variant:"h6",children:I.eT[s.type]})]})}),(0,i.jsxs)(p.Z,{orientation:K?"vertical":"horizontal",children:[(0,i.jsx)(x.Z,{disableElevation:!0,variant:"outlined",color:"primary",sx:{...P.Z.button,color:e=>e.palette.primary.main,borderTopRightRadius:0,borderBottomRightRadius:0},onClick:r,children:"Back"}),(0,i.jsx)(L.Z,{isDisabled:0===_.length||(null==s?void 0:s.smsRecommendations)===void 0,isOpen:!1,maxWidth:"sm",openButtonText:"Send",title:"Send Crop Recommendation",contentText:""!==s.info?s.info:"Sending this allows your contacts to receive the Text-Form Crop Recommendation on their cellphone numbers as text.",confirmBtnText:""!==s.info?"Ok":"Send",modalConfirmHandlerCB:Q,loading:s.sending,modalButtonStyles:{borderTopLeftRadius:0,borderBottomLeftRadius:0,width:"80px"}})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)(m.Z,{sx:q.Z.details,children:[F.map(e=>{var t;return(0,i.jsx)("div",{children:(0,i.jsxs)(h.Z,{variant:"body2",children:[(0,i.jsxs)("strong",{children:[null==e?void 0:e.label,": "]})," ",null!==(t=null==e?void 0:e.value)&&void 0!==t?t:"-"]})},e.id)}),(0,i.jsxs)(h.Z,{variant:"caption",children:[(0,i.jsx)("strong",{children:"ID:"})," ",s.id]})]}),(0,i.jsx)(g.Z,{sx:{marginTop:"32px"}})]}),(0,i.jsxs)(b.ZP,{container:!0,style:{paddingTop:"10px"},children:[(0,i.jsxs)(b.ZP,{item:!0,xs:12,md:5,children:[(0,i.jsx)(h.Z,{variant:"h6",children:"Text-Form Crop Recommendation"}),(0,i.jsx)(j.Z,{children:(null==s?void 0:s.smsRecommendations)||(0,i.jsx)("span",{style:{color:"#ff1744"},children:"No SMS Recommendations available."})})]}),(0,i.jsxs)(b.ZP,{item:!0,xs:12,md:7,children:[(0,i.jsx)(h.Z,{variant:"h6",children:"List of Contacts"}),n.loading?(0,i.jsx)("div",{children:"Loading phonebook..."}):""!==n.error?(0,i.jsx)("div",{children:n.error}):t.length>0?(0,i.jsxs)("div",{children:[(0,i.jsx)(m.Z,{children:(0,i.jsxs)(h.Z,{variant:"body2",children:["These are your contacts that you can send the recommendation thru SMS.",(0,i.jsx)("br",{}),"Need to change some of your contacts? Click"," ",(0,i.jsx)("span",{onClick:U,style:P.Z.customizedButtonLink,children:"here"}),"."]})}),(0,i.jsx)("br",{}),(0,i.jsx)("div",{children:w&&Object.keys(w).sort().map((e,t)=>(0,i.jsxs)(C.Z,{children:[(0,i.jsx)(f.Z,{expandIcon:(0,i.jsx)(v.Z,{}),"aria-controls":"panel1-content",id:"panel1-header",children:e}),(0,i.jsx)(T.Z,{children:Object.keys(w[e]).sort().map(t=>(0,i.jsx)(y.Z,{children:(0,i.jsx)(E.Z,{"aria-labelledby":"demo-radio-buttons-group-label",defaultValue:"female",name:"radio-buttons-group",value:l,onChange:e=>u(e.target.value),children:(0,i.jsx)(Z.Z,{onClick:n=>W(n,e,t),control:(0,i.jsx)(S.Z,{}),label:t,value:t})})},t))})]},t))})]}):(0,i.jsx)("div",{children:(0,i.jsxs)(h.Z,{variant:"subtitle1",children:["No contacts yet. Please add contacts first in your Phonebook\xa0",(0,i.jsx)("span",{onClick:U,style:P.Z.customizedButtonLink,children:"here"}),"."]})})]})]})]}):(0,i.jsx)(B.Z,{})})};let K={loading:!0,error:"",info:"",sending:!1};var Q=(0,r.Z)(function(e){let[t,n]=(0,a.useState)(K),[r,m]=(0,a.useState)(K),[h,p]=(0,a.useState)([]),x=(0,o.useRouter)();return(0,a.useEffect)(()=>{if(t.loading&&Object.keys(x.query).length>0&&null!==e.user){let e=async()=>{try{m({...K,loading:!0});let e=await (0,c.K2)();p(t=>e),m(e=>({...e,loading:!1}))}catch(e){n(t=>({...K,loading:!1,error:e.message})),m(t=>({...K,loading:!1,error:e.message}))}};(async()=>{try{let e=await (0,s.QL)(x.query.docId),t=e.date_created.toDate();e.date_created="".concat(t.toDateString()," ").concat(t.toLocaleTimeString("it-IT",u.W6)),n(t=>({...t,loading:!1,...e}))}catch(e){n({...K,loading:!1,error:e.message})}})(),e()}},[x,t.loading,e.user]),(0,i.jsx)(d.Z,{loading:e.loading,user:e.user,onBtnLogoutClick:e.onBtnLogoutClick,accLevel:l.DW.ADMIN,children:(0,i.jsx)(H,{setReport:n,report:t,loading:e.loading,contacts:h,contactsState:r,onBackBtnClick:()=>{x.push("/admin/sms/")}})})})},40923:function(e,t,n){"use strict";n.d(t,{rE:function(){return d},GK:function(){return l},mP:function(){return u},K2:function(){return m}});var i=n(9669),a=n.n(i),o=n(15426);let r={CREATE_CONTACT:"".concat("https://amia-cis-tmtk.onrender.com/api","/contact"),DELETE_CONTACT:"".concat("https://amia-cis-tmtk.onrender.com/api","/contact"),EDIT_CONTACT:"".concat("https://amia-cis-tmtk.onrender.com/api","/contact"),GET_CONTACTS:"".concat("https://amia-cis-tmtk.onrender.com/api","/contacts")};class s extends o.Z{async createContact(e){let t=await this.createRequestObject({body:e});return(await a()({...t,url:r.CREATE_CONTACT,method:"POST"})).data}async deleteContact(e){let t=await this.createRequestObject({body:e});return(await a()({...t,url:r.DELETE_CONTACT,method:"DELETE"})).data}async editContact(e){let t=await this.createRequestObject({body:e});return(await a()({...t,url:r.EDIT_CONTACT,method:"PATCH"})).data}async getContacts(){let e=await this.createRequestObject({});return(await a()({...e,url:r.GET_CONTACTS,method:"GET"})).data.contacts}}let c=new s,d=c.createContact.bind(c),l=c.deleteContact.bind(c),u=c.editContact.bind(c),m=c.getContacts.bind(c)}},function(e){e.O(0,[3153,6856,190,8583,1664,955,4073,2380,6080,3805,3270,8882,5988,8591,1182,2888,9774,179],function(){return e(e.s=91395)}),_N_E=e.O()}]);