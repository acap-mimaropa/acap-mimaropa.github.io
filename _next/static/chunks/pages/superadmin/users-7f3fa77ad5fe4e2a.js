(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2254],{6241:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/superadmin/users",function(){return t(24372)}])},16729:function(e,a,t){"use strict";t.d(a,{Z:function(){return g}});var i=t(85893),n=t(67294),s=t(45697),l=t.n(s),r=t(51015),o=t(2782),d=t(97182),c=t(33453),u=t(96727),p=t(92365),m=t(40110),h=t(52857),f={button:{color:"#FFFFFF",textTransform:"capitalize",fontSize:"14px",fontStyle:"normal",fontWeight:"normal",height:{xs:"40px",sm:"48px"},"& .text":{display:{xs:"block",sm:"none"}},"& .shortText":{display:{xs:"inline-block",sm:"none"},fontSize:"24px"}},icon:{display:{xs:"block",sm:"none"}},dialogContent:{"& .error":{fontSize:"12px",color:"red"}},dialogActions:{"& button":{minWidth:"100px"}},closeButton:{position:"absolute",right:"8px",top:"8px",color:e=>e.palette.grey[500]}};function x(e){let[a,t]=n.useState({open:null}),{loading:s=!1,isOpen:l=!1,showButtons:x=!0,maxWidth:g="sm",IconSVG:b=null,modalButtonStyles:y={},modalExtraHandlerCB:E=null,modalCancelHandlerCB:w=null,modalConfirmHandlerCB:v=null,modalOpenHandlerCB:T=null,isDisabled:j=!1}=e,{openButtonText:C="Click",title:S="Window Title",extraBtnText:k="",cancelBtnText:Z="Cancel",confirmBtnText:_="Ok",contentText:U="",error:A="",colorTheme:I="primary"}=e;(0,n.useEffect)(()=>{t(e=>({...e,open:l}))},[l]);let B=()=>{t({...a,open:!1}),w&&w()};return(0,i.jsxs)("div",{children:[C&&(0,i.jsxs)(r.Z,{disabled:j,disableElevation:!0,variant:"contained",color:I,onClick:()=>{t({...a,open:!0}),T&&T()},sx:{...f.button,...y},children:[b&&(0,i.jsx)(b,{sx:f.icon}),C]}),(0,i.jsxs)(c.Z,{maxWidth:g,fullWidth:!0,open:a.open||!1,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,i.jsxs)(p.Z,{children:[(0,i.jsx)("span",{children:S}),(0,i.jsx)(h.Z,{"aria-label":"close",sx:f.closeButton,onClick:B,disabled:s,children:(0,i.jsx)(o.Z,{})})]}),(0,i.jsxs)(m.Z,{sx:f.dialogContent,children:[""!==U&&(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{children:U}),(0,i.jsx)("div",{className:"error",children:A})]}),e.children]}),x&&(0,i.jsxs)(u.Z,{sx:f.dialogActions,children:[""!==k&&(0,i.jsx)(r.Z,{onClick:E||B,disabled:s,children:k}),(0,i.jsx)(r.Z,{onClick:w||B,disabled:s,children:Z}),(0,i.jsxs)(r.Z,{variant:"contained",disabled:s,onClick:v||B,children:[(0,i.jsx)("span",{style:{display:s?"none":"block"},children:_}),(0,i.jsx)(d.Z,{size:24,color:"secondary",sx:{display:s?"block":"none"}})]})]})]})]})}x.propTypes={loading:l().bool,isOpen:l().bool,showButtons:l().bool,maxWidth:l().string,IconSVG:l().elementType,modalButtonStyles:l().object,modalCancelHandlerCB:l().func,modalConfirmHandlerCB:l().func,modalOpenHandlerCB:l().func,modalExtraHandlerCB:l().func,openButtonText:l().string,cancelBtnText:l().string,confirmBtnText:l().string,extraBtnText:l().string,title:l().string,contentText:l().string,children:l().node,error:l().string,isDisabled:l().bool,colorTheme:l().string};var g=x},17553:function(e,a,t){"use strict";var i=t(85893),n=t(67294),s=t(45697),l=t.n(s),r=t(70760),o=t(44723);let d=n.forwardRef(function(e,a){return(0,i.jsx)(o.Z,{elevation:6,ref:a,variant:"filled",...e})});function c(e){let{openSnackbar:a,message:t,severity:s="info",closeHandlerCB:l=()=>{}}=e,[o,c]=(0,n.useState)(a);(0,n.useEffect)(()=>{c(a)},[a]);let u=()=>{c(!1),l()},p=function(e){if(null==e)return"";if("string"==typeof e)return e;if(e instanceof Error)return e.message||e.toString();if("object"==typeof e&&"string"==typeof e.message)return e.message;try{return JSON.stringify(e)}catch(a){return String(e)}}(t);return(0,i.jsx)(r.Z,{open:o,autoHideDuration:3e3,onClose:u,children:(0,i.jsx)(d,{onClose:u,severity:s,sx:{width:"100%"},children:p})})}c.propTypes={openSnackbar:l().bool,message:l().any,severity:l().string,closeHandlerCB:l().func},a.Z=c},24372:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return G}});var i=t(85893),n=t(45697),s=t.n(n),l=t(67294),r=t(98813),o=t(94459);class d{isValidEmail(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/^[a-z.A-Z.0-9]+@[a-zA-Z0-9]+\.[A-Za-z]+$/.test(e)&&""!==e}isValidName(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/[a-zA-Z0-9. ]+$/.test(e.trim())&&""!==e}isValidPassword(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.length>0}}let c=new d,u=c.isValidEmail.bind(c),p=c.isValidName.bind(c),m=c.isValidPassword.bind(c);var h=t(65328),f=t(45773),x=t(60990),g=t(96788),b=t(16729),y=t(17553),E=t(42176),w=t(6132),v=t(50853),T=t(40066),j=t(65806),C=t(94143),S=t(15972),k=t(29346),Z=t(13539),_=t(26541),U={width:"parent",display:"flex",flexDirection:"column","& .MuiTextField-root, button":{marginTop:e=>e.spacing(2)}},A={fontSize:"12px",marginTop:e=>e.spacing(3),marginBottom:"4px"},I={marginBottom:e=>e.spacing(2)};function B(e){let{state:a,loadstatus:t,onTextChange:n,type:s="create",inputValidation:l,handleInputClick:r}=e;return(0,i.jsxs)(x.Z,{component:"form",noValidate:!0,autoComplete:"off",sx:U,children:["create"!==s&&(0,i.jsx)(_.Z,{id:"uid",label:"Enter UID",variant:"standard",size:"small",disabled:!0,value:a.uid}),(0,i.jsx)(_.Z,{id:"email",label:"Enter email",variant:"standard",size:"small",error:""!==l.email,helperText:""!==l.email?l.email:"",disabled:t.isLoading,value:a.email,onChange:n,onClick:r}),(0,i.jsx)(_.Z,{id:"displayname",label:"Enter display name",variant:"standard",size:"small",error:""!==l.displayname,helperText:""!==l.displayname?l.displayname:"",disabled:t.isLoading,value:a.displayname,onChange:n,onClick:r}),(0,i.jsx)(_.Z,{id:"password",label:"Enter password",type:"password",placeholder:"create"===a.mode?"Enter password":"Password will not be updated if left blank",variant:"standard",size:"small",error:""!==l.password&&"create"===s,helperText:""!==l.password&&"create"===s?l.password:"",disabled:t.isLoading,value:a.password,onChange:n,onClick:r}),(0,i.jsx)(C.Z,{sx:A,id:"accountlevel-label",children:"Account Type"}),(0,i.jsxs)(k.Z,{labelId:"accountlevel-label",id:"account_level",size:"small",sx:I,disabled:t.isLoading,value:a.account_level,onChange:n,children:[(0,i.jsx)(S.Z,{value:1,size:"small",children:"Superadmin"}),(0,i.jsx)(S.Z,{value:2,size:"small",children:"Admin"})]}),(0,i.jsx)(j.Z,{control:(0,i.jsx)(Z.Z,{checked:a.disabled,disabled:t.isLoading,id:"disabled",name:"disabled",onChange:n}),label:"Account Disabled"}),(0,i.jsx)(j.Z,{control:(0,i.jsx)(Z.Z,{checked:a.emailverified,disabled:t.isLoading,id:"emailverified",name:"emailverified",onChange:n}),label:"Email Verified"})]})}B.propTypes={state:s().object,loadstatus:s().object,onTextChange:s().func,type:s().string,inputValidation:s().object,handleInputClick:s().func};var R={width:"parent",display:"flex",justifyContent:"space-between",fontSize:"14px",alignItems:"center",padding:"12px",borderBottom:"1px solid #f0f0f0","& div:first-child":{color:"#a0a0a0"},"& div:last-child":{color:"#000"}};let D={email:"Email",displayName:"Display Name",acclevel:"Acc. Type",emailVerified:"Email Verified",disabled:"Acc. Disabled",last_signin:"Last Signin"};function L(e){let{userinfo:a}=e;return(0,i.jsx)(x.Z,{children:Object.keys(D).map(e=>(0,i.jsxs)(x.Z,{sx:R,children:[(0,i.jsx)("div",{children:D[e]}),(0,i.jsx)("div",{children:a[e].toString()})]},e))})}L.propTypes={userinfo:s().object};var V={marginTop:"24px",minHeight:500},N={background:"#FFFFFF",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px",borderRadius:"8px","& .MuiDataGrid-main":{borderRadius:2},"& .MuiDataGrid-virtualScrollerRenderZone":{"& .MuiDataGrid-row":{"&:nth-of-type(2n)":{backgroundColor:"rgba(235, 235, 235, .7)"}}},"& .MuiDataGrid-columnHeader:focus-within":{outline:"none !important"},"& .MuiDataGrid-columnHeaders":{color:e=>e.palette.primary.dark,fontSize:16}};function P(e){return(0,i.jsxs)(E.D,{...e,children:[(0,i.jsx)(w.S,{}),(0,i.jsx)(v.M,{})]})}let z={CREATE:0,VIEW:1,EDIT:2,DELETE:3},O={[z.CREATE]:{windowTitle:"Create a New User",buttonText:"Create User",yesBtnText:"Save"},[z.VIEW]:{windowTitle:"User Information",buttonText:"View",yesBtnText:"Edit"},[z.EDIT]:{windowTitle:"Update User Information",buttonText:"Edit",yesBtnText:"Update"},[z.DELETE]:{windowTitle:"User Information",buttonText:"Delete",yesBtnText:"Delete"}};function H(e){let{state:a,loadstatus:t,loadingusers:n,rows:s,columns:r,onTextChange:o,onEditStart:d,handleCreateUser:c,handleDeleteUser:u,handleUpdateUser:p,handleInputClick:m,inputValidation:h,usersLoadingError:f}=e,[E,w]=(0,l.useState)({}),[v,j]=(0,l.useState)(!1),[C,S]=(0,l.useState)(z.CREATE);return(0,i.jsxs)("div",{children:[(0,i.jsx)(g.Z,{variant:"h5",children:"Users Management"}),(0,i.jsx)("p",{children:"Manage admin user accounts"}),(0,i.jsx)("br",{}),(0,i.jsx)(b.Z,{isOpen:t.dialogOpen&&[z.CREATE,z.DELETE].includes(C)||v&&[z.VIEW,z.EDIT].includes(C),maxWidth:"xs",openButtonText:"Create User",title:O[C].windowTitle,confirmBtnText:O[C].yesBtnText,extraBtnText:C===z.VIEW?O[z.DELETE].buttonText:"",loading:t.isLoading,colorTheme:"secondary",modalConfirmHandlerCB:()=>{switch(C){case z.CREATE:c();break;case z.VIEW:S(z.EDIT);break;case z.EDIT:p(),S(z.CREATE)}},modalCancelHandlerCB:()=>{m(),j(!1)},modalOpenHandlerCB:()=>{S(z.CREATE),j(!0)},modalExtraHandlerCB:()=>{S(z.DELETE),u(E.uid,E.email)},children:C===z.CREATE||C===z.EDIT?(0,i.jsx)(B,{state:a,loadstatus:t,onTextChange:o,inputValidation:h,handleInputClick:m,type:"create"}):(0,i.jsx)(L,{userinfo:E})}),(0,i.jsx)(x.Z,{sx:V,style:{height:s.length<=4?"500px":"unset"},children:(0,i.jsx)(T._,{rows:s,columns:r,sx:N,rowHeight:48,autoHeight:s.length>=5,disableDensitySelector:!0,rowsPerPageOptions:[15,30,100],error:""!==f?f:null,components:{Toolbar:P},loading:n,initialState:{columns:{columnVisibilityModel:{rowId:!1}},pagination:{pageSize:12}},onRowClick:e=>{let a={...e.row};a.account_level="Admin"===a.acclevel?2:1,a.displayname=a.displayName,a.emailverified=a.emailVerified,d(a.uid,"edit"),w(a),S(z.VIEW),j(!0)}})}),(""!==t.error||""!==t.message)&&(0,i.jsx)(y.Z,{openSnackbar:!0,message:""!==t.error?t.error:t.message,severity:""!==t.error?"error":"success"})]})}H.propTypes={state:s().object,loadstatus:s().object,onTextChange:s().func,onEditStart:s().func,handleCreateUser:s().func,handleDeleteUser:s().func,handleUpdateUser:s().func,handleInputClick:s().func,inputValidation:s().object,usersLoadingError:s().string};let W={email:"",displayname:"",password:"",account_level:2,disabled:!1,emailverified:!0,mode:"create"},F={isLoading:!1,dialogOpen:!1,error:"",message:""},M={email:"",displayname:"",password:"",account_level:"",disabled:"",emailverified:""};function q(e){let[a,t]=(0,l.useState)(W),[n,s]=(0,l.useState)(F),[d,c]=(0,l.useState)(M),[h,x]=(0,l.useState)([]),{users:g,loading:b,error:y}=function(){let[e,a]=(0,l.useState)(null),[t,i]=(0,l.useState)(!0),[n,s]=(0,l.useState)("");return(0,l.useEffect)(()=>{(async()=>{try{let e=await (0,o.Rf)();i(!1),a(e.data)}catch(a){let e="";void 0!==a.response&&(e=void 0!==a.response.data?a.response.data:""),""===e&&(e=a.message),s(e)}})()},[]),{users:e,loading:t,error:n}}(),[E,w]=(0,l.useState)([]),[v,T]=(0,l.useState)([]);(0,l.useEffect)(()=>{null!==g&&x(e=>g.users)},[g]),(0,l.useEffect)(()=>{if(h.length>0){let e={email:{label:"Email",width:280},displayName:{label:"Display Name",width:200},acclevel:{label:"Acc. Type",width:120},emailVerified:{label:"Email Verified",width:125},disabled:{label:"Acc. Disabled",width:120},last_signin:{label:"Last Signin",width:250}},a=["email","displayName","acclevel","emailVerified","disabled","last_signin"].reduce((a,t,n)=>(a.push({field:t,headerName:e[t].label,width:e[t].width,align:n>1?"center":"left",headerAlign:n>1?"center":"left",editable:!1,sortable:!1,disableColumnMenu:!0,renderCell:e=>(0,i.jsx)("div",{style:{fontSize:"last_signin"===t?"13px":"14px"},children:e.value.toString()})}),a),[]);w(h.filter(e=>void 0!==e.customClaims).map((e,a)=>({id:a,uid:e.uid,email:e.email,displayName:e.displayName,acclevel:1===e.customClaims.account_level?"Superadmin":"Admin",emailVerified:e.emailVerified,disabled:e.disabled,date_created:e.metadata.creationTime,last_signin:e.metadata.lastSignInTime?e.metadata.lastSignInTime:"-"}))),T(a)}},[h]);let j=e=>{let a=Object.keys(W).reduce((a,t)=>(a[t]=e[t],a),{});if(null!==a)return a.uid=e.uid,a.account_level=e.customClaims.account_level,a.displayname=e.displayName,a.emailverified=e.emailVerified,a.password="",a},C=()=>{s({...F,dialogOpen:!0,isLoading:!0})},S=e=>{let{message:a="",error:i=""}=e;s(e=>({...F,message:a,error:i})),t(e=>({...W}))},k=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"create",t=0,i={};return u(a.email)||(i.email="Please check your email input.",t+=1),p(a.displayname)||(i.displayname="Please check your display name.",t+=1),"create"!==e||m(a.password)||(i.password="Please check your password input.",t+=1),c({...d,...i}),0===t},Z=async()=>{if(k("create"))try{C(),await (0,o.r4)(a);let{data:e}=await (0,o.Rf)();x(e.users),S({message:"User successfully ".concat(a.email," created!")})}catch(e){S({error:e.response?e.response.data:e.message})}},_=async(e,a)=>{try{C(),await (0,o.h8)(e);let{data:t}=await (0,o.Rf)();x(t.users),S({message:"Successfully deleted user ".concat(a,"!")})}catch(e){S({error:e.response?e.response.data:e.message})}},U=async()=>{if(k("edit"))try{C(),await (0,o.Nq)(a);let e=await (0,o.PR)({uid:a.uid,email:a.email}),t=h.findIndex(a=>a.uid===e.uid);if(t>=0){let a=[...h];a[t]=e,x(a)}S({message:"Successfully updated ".concat(a.email,"'s details!")})}catch(e){S({error:e.response?e.response.data:e.message})}};return(0,i.jsx)(f.Z,{loading:e.loading,user:e.user,onBtnLogoutClick:e.onBtnLogoutClick,accLevel:r.DW.SUPERADMIN,children:(0,i.jsx)(H,{state:a,loadstatus:n,loadingusers:b,rows:E,columns:v,onTextChange:e=>{let{id:i,value:l,checked:r}=e.target,o=void 0!==i?i:"account_level";["emailverified","disabled"].includes(o)&&(l=r),t({...a,[o]:l}),(""!==n.error||""!==n.message||Object.keys(d).filter(e=>""!==d[e]).length>0)&&(s(F),c(M))},onEditStart:function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"create",i=j(h.find(a=>a.uid===e));t(i={...i,mode:a})},handleCreateUser:Z,handleDeleteUser:_,handleUpdateUser:U,handleInputClick:e=>{if(e){let{id:i}=e.target;t({...a,[i]:""})}else t(W),s(F);c(M)},inputValidation:d,usersLoadingError:y})})}q.propTypes={loading:s().bool,user:s().object,onBtnLogoutClick:s().func,accLevel:s().number};var G=(0,h.Z)(q)},94459:function(e,a,t){"use strict";t.d(a,{r4:function(){return o},h8:function(){return c},PR:function(){return u},Rf:function(){return p},Nq:function(){return d}});var i=t(9669),n=t.n(i),s=t(15426);class l extends s.Z{async createUser(e){let a={};["email","displayname","password","account_level","disabled","emailverified"].forEach(t=>{if(void 0!==e[t]&&""!==e[t])a[t]=e[t];else throw Error("Please check your input.")});let t=await this.createRequestObject({body:a});return(await n()({...t,url:this.USERS_API,method:"POST"})).data}async updateUser(e){let a={};["uid","email","displayname","password","disabled","emailverified","account_level"].forEach(t=>{if(void 0===e[t.toLowerCase()]||"password"===t||""!==e[t])a[t]=e[t];else throw Error("Please check your input.")});let t=await this.createRequestObject({body:a});return(await n()({...t,url:this.USERS_API,method:"PATCH"})).data}async deleteUser(e){let a=await this.createRequestObject({});return(await n().delete("".concat(this.USERS_API,"/").concat(e),a)).data}async getUser(e){let{uid:a,email:t}=e,i={};a&&(i={uid:a}),t&&(i={email:t});let s=await this.createRequestObject({params:i});return(await n().get("".concat(this.BASE_URL,"/user"),s)).data}constructor(){super(),this.getUsers=async()=>await n().get(this.USERS_API_LIST),this.BASE_URL="https://acap-mimaropa-server.onrender.com/api",this.USERS_API="".concat(this.BASE_URL,"/user"),this.USERS_API_LIST="".concat(this.BASE_URL,"/users")}}let r=new l,o=r.createUser.bind(r),d=r.updateUser.bind(r),c=r.deleteUser.bind(r),u=r.getUser.bind(r),p=r.getUsers.bind(r)}},function(e){e.O(0,[3153,7023,3745,1664,6541,8848,6294,5229,232,9998,5837,4723,837,3539,9303,66,2163,8591,2888,9774,179],function(){return e(e.s=6241)}),_N_E=e.O()}]);