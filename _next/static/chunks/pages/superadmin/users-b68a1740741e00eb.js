(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2254],{6241:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/superadmin/users",function(){return t(24372)}])},24372:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return G}});var i=t(85893),s=t(45697),l=t.n(s),n=t(67294),r=t(98813),d=t(94459);class o{isValidEmail(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/^[a-z.A-Z.0-9]+@[a-zA-Z0-9]+\.[A-Za-z]+$/.test(e)&&""!==e}isValidName(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/[a-zA-Z0-9. ]+$/.test(e.trim())&&""!==e}isValidPassword(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.length>0}}let c=new o,u=c.isValidEmail.bind(c),m=c.isValidName.bind(c),p=c.isValidPassword.bind(c);var h=t(65328),f=t(45773),g=t(60990),b=t(96788),E=t(16729),x=t(17553),w=t(42176),y=t(6132),v=t(50853),T=t(64740),S=t(65806),C=t(94143),j=t(15972),_=t(29346),U=t(13539),I=t(26541),A={width:"parent",display:"flex",flexDirection:"column","& .MuiTextField-root, button":{marginTop:e=>e.spacing(2)}},R={fontSize:"12px",marginTop:e=>e.spacing(3),marginBottom:"4px"},k={marginBottom:e=>e.spacing(2)};function D(e){let{state:a,loadstatus:t,onTextChange:s,type:l="create",inputValidation:n,handleInputClick:r}=e;return(0,i.jsxs)(g.Z,{component:"form",noValidate:!0,autoComplete:"off",sx:A,children:["create"!==l&&(0,i.jsx)(I.Z,{id:"uid",label:"Enter UID",variant:"standard",size:"small",disabled:!0,value:a.uid}),(0,i.jsx)(I.Z,{id:"email",label:"Enter email",variant:"standard",size:"small",error:""!==n.email,helperText:""!==n.email?n.email:"",disabled:t.isLoading,value:a.email,onChange:s,onClick:r}),(0,i.jsx)(I.Z,{id:"displayname",label:"Enter display name",variant:"standard",size:"small",error:""!==n.displayname,helperText:""!==n.displayname?n.displayname:"",disabled:t.isLoading,value:a.displayname,onChange:s,onClick:r}),(0,i.jsx)(I.Z,{id:"password",label:"Enter password",type:"password",placeholder:"create"===a.mode?"Enter password":"Password will not be updated if left blank",variant:"standard",size:"small",error:""!==n.password&&"create"===l,helperText:""!==n.password&&"create"===l?n.password:"",disabled:t.isLoading,value:a.password,onChange:s,onClick:r}),(0,i.jsx)(C.Z,{sx:R,id:"accountlevel-label",children:"Account Type"}),(0,i.jsxs)(_.Z,{labelId:"accountlevel-label",id:"account_level",size:"small",sx:k,disabled:t.isLoading,value:a.account_level,onChange:s,children:[(0,i.jsx)(j.Z,{value:1,size:"small",children:"Superadmin"}),(0,i.jsx)(j.Z,{value:2,size:"small",children:"Admin"})]}),(0,i.jsx)(S.Z,{control:(0,i.jsx)(U.Z,{checked:a.disabled,disabled:t.isLoading,id:"disabled",name:"disabled",onChange:s}),label:"Account Disabled"}),(0,i.jsx)(S.Z,{control:(0,i.jsx)(U.Z,{checked:a.emailverified,disabled:t.isLoading,id:"emailverified",name:"emailverified",onChange:s}),label:"Email Verified"})]})}D.propTypes={state:l().object,loadstatus:l().object,onTextChange:l().func,type:l().string,inputValidation:l().object,handleInputClick:l().func};var L={width:"parent",display:"flex",justifyContent:"space-between",fontSize:"14px",alignItems:"center",padding:"12px",borderBottom:"1px solid #f0f0f0","& div:first-child":{color:"#a0a0a0"},"& div:last-child":{color:"#000"}};let V={email:"Email",displayName:"Display Name",acclevel:"Acc. Type",emailVerified:"Email Verified",disabled:"Acc. Disabled",last_signin:"Last Signin"};function Z(e){let{userinfo:a}=e;return(0,i.jsx)(g.Z,{children:Object.keys(V).map(e=>(0,i.jsxs)(g.Z,{sx:L,children:[(0,i.jsx)("div",{children:V[e]}),(0,i.jsx)("div",{children:a[e].toString()})]},e))})}Z.propTypes={userinfo:l().object};var P={marginTop:"24px",minHeight:500},B={background:"#FFFFFF",boxShadow:"rgb(0 0 0 / 2%) 0px 3.5px 5.5px",borderRadius:"8px","& .MuiDataGrid-main":{borderRadius:2},"& .MuiDataGrid-virtualScrollerRenderZone":{"& .MuiDataGrid-row":{"&:nth-of-type(2n)":{backgroundColor:"rgba(235, 235, 235, .7)"}}},"& .MuiDataGrid-columnHeader:focus-within":{outline:"none !important"},"& .MuiDataGrid-columnHeaders":{color:e=>e.palette.primary.dark,fontSize:16}};function N(e){return(0,i.jsxs)(w.D,{...e,children:[(0,i.jsx)(y.S,{}),(0,i.jsx)(v.M,{})]})}let z={CREATE:0,VIEW:1,EDIT:2,DELETE:3},O={[z.CREATE]:{windowTitle:"Create a New User",buttonText:"Create User",yesBtnText:"Save"},[z.VIEW]:{windowTitle:"User Information",buttonText:"View",yesBtnText:"Edit"},[z.EDIT]:{windowTitle:"Update User Information",buttonText:"Edit",yesBtnText:"Update"},[z.DELETE]:{windowTitle:"User Information",buttonText:"Delete",yesBtnText:"Delete"}};function M(e){let{state:a,loadstatus:t,loadingusers:s,rows:l,columns:r,onTextChange:d,onEditStart:o,handleCreateUser:c,handleDeleteUser:u,handleUpdateUser:m,handleInputClick:p,inputValidation:h,usersLoadingError:f}=e,[w,y]=(0,n.useState)({}),[v,S]=(0,n.useState)(!1),[C,j]=(0,n.useState)(z.CREATE);return(0,i.jsxs)("div",{children:[(0,i.jsx)(b.Z,{variant:"h5",children:"Users Management"}),(0,i.jsx)("p",{children:"Manage admin user accounts"}),(0,i.jsx)("br",{}),(0,i.jsx)(E.Z,{isOpen:t.dialogOpen&&[z.CREATE,z.DELETE].includes(C)||v&&[z.VIEW,z.EDIT].includes(C),maxWidth:"xs",openButtonText:"Create User",title:O[C].windowTitle,confirmBtnText:O[C].yesBtnText,extraBtnText:C===z.VIEW?O[z.DELETE].buttonText:"",loading:t.isLoading,colorTheme:"secondary",modalConfirmHandlerCB:()=>{switch(C){case z.CREATE:c();break;case z.VIEW:j(z.EDIT);break;case z.EDIT:m(),j(z.CREATE)}},modalCancelHandlerCB:()=>{p(),S(!1)},modalOpenHandlerCB:()=>{j(z.CREATE),S(!0)},modalExtraHandlerCB:()=>{j(z.DELETE),u(w.uid,w.email)},children:C===z.CREATE||C===z.EDIT?(0,i.jsx)(D,{state:a,loadstatus:t,onTextChange:d,inputValidation:h,handleInputClick:p,type:"create"}):(0,i.jsx)(Z,{userinfo:w})}),(0,i.jsx)(g.Z,{sx:P,style:{height:l.length<=4?"500px":"unset"},children:(0,i.jsx)(T._,{rows:l,columns:r,sx:B,rowHeight:48,autoHeight:l.length>=5,disableDensitySelector:!0,rowsPerPageOptions:[15,30,100],error:""!==f?f:null,components:{Toolbar:N},loading:s,initialState:{columns:{columnVisibilityModel:{rowId:!1}},pagination:{pageSize:12}},onRowClick:e=>{let a={...e.row};a.account_level="Admin"===a.acclevel?2:1,a.displayname=a.displayName,a.emailverified=a.emailVerified,o(a.uid,"edit"),y(a),j(z.VIEW),S(!0)}})}),(""!==t.error||""!==t.message)&&(0,i.jsx)(x.Z,{openSnackbar:!0,message:""!==t.error?t.error:t.message,severity:""!==t.error?"error":"success"})]})}M.propTypes={state:l().object,loadstatus:l().object,onTextChange:l().func,onEditStart:l().func,handleCreateUser:l().func,handleDeleteUser:l().func,handleUpdateUser:l().func,handleInputClick:l().func,inputValidation:l().object,usersLoadingError:l().string};let H={email:"",displayname:"",password:"",account_level:2,disabled:!1,emailverified:!0,mode:"create"},W={isLoading:!1,dialogOpen:!1,error:"",message:""},F={email:"",displayname:"",password:"",account_level:"",disabled:"",emailverified:""};function q(e){let[a,t]=(0,n.useState)(H),[s,l]=(0,n.useState)(W),[o,c]=(0,n.useState)(F),[h,g]=(0,n.useState)([]),{users:b,loading:E,error:x}=function(){let[e,a]=(0,n.useState)(null),[t,i]=(0,n.useState)(!0),[s,l]=(0,n.useState)("");return(0,n.useEffect)(()=>{(async()=>{try{let e=await (0,d.Rf)();i(!1),a(e.data)}catch(a){let e="";void 0!==a.response&&(e=void 0!==a.response.data?a.response.data:""),""===e&&(e=a.message),l(e)}})()},[]),{users:e,loading:t,error:s}}(),[w,y]=(0,n.useState)([]),[v,T]=(0,n.useState)([]);(0,n.useEffect)(()=>{null!==b&&g(e=>b.users)},[b]),(0,n.useEffect)(()=>{if(h.length>0){let e={email:{label:"Email",width:280},displayName:{label:"Display Name",width:200},acclevel:{label:"Acc. Type",width:120},emailVerified:{label:"Email Verified",width:125},disabled:{label:"Acc. Disabled",width:120},last_signin:{label:"Last Signin",width:250}},a=["email","displayName","acclevel","emailVerified","disabled","last_signin"].reduce((a,t,s)=>(a.push({field:t,headerName:e[t].label,width:e[t].width,align:s>1?"center":"left",headerAlign:s>1?"center":"left",editable:!1,sortable:!1,disableColumnMenu:!0,renderCell:e=>(0,i.jsx)("div",{style:{fontSize:"last_signin"===t?"13px":"14px"},children:e.value.toString()})}),a),[]);y(h.filter(e=>void 0!==e.customClaims).map((e,a)=>({id:a,uid:e.uid,email:e.email,displayName:e.displayName,acclevel:1===e.customClaims.account_level?"Superadmin":"Admin",emailVerified:e.emailVerified,disabled:e.disabled,date_created:e.metadata.creationTime,last_signin:e.metadata.lastSignInTime?e.metadata.lastSignInTime:"-"}))),T(a)}},[h]);let S=e=>{let a=Object.keys(H).reduce((a,t)=>(a[t]=e[t],a),{});if(null!==a)return a.uid=e.uid,a.account_level=e.customClaims.account_level,a.displayname=e.displayName,a.emailverified=e.emailVerified,a.password="",a},C=()=>{l({...W,dialogOpen:!0,isLoading:!0})},j=e=>{let{message:a="",error:i=""}=e;l(e=>({...W,message:a,error:i})),t(e=>({...H}))},_=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"create",t=0,i={};return u(a.email)||(i.email="Please check your email input.",t+=1),m(a.displayname)||(i.displayname="Please check your display name.",t+=1),"create"!==e||p(a.password)||(i.password="Please check your password input.",t+=1),c({...o,...i}),0===t},U=async()=>{if(_("create"))try{C(),await (0,d.r4)(a);let{data:e}=await (0,d.Rf)();g(e.users),j({message:"User successfully ".concat(a.email," created!")})}catch(e){j({error:e.response?e.response.data:e.message})}},I=async(e,a)=>{try{C(),await (0,d.h8)(e);let{data:t}=await (0,d.Rf)();g(t.users),j({message:"Successfully deleted user ".concat(a,"!")})}catch(e){j({error:e.response?e.response.data:e.message})}},A=async()=>{if(_("edit"))try{C(),await (0,d.Nq)(a);let e=await (0,d.PR)({uid:a.uid,email:a.email}),t=h.findIndex(a=>a.uid===e.uid);if(t>=0){let a=[...h];a[t]=e,g(a)}j({message:"Successfully updated ".concat(a.email,"'s details!")})}catch(e){j({error:e.response?e.response.data:e.message})}};return(0,i.jsx)(f.Z,{loading:e.loading,user:e.user,onBtnLogoutClick:e.onBtnLogoutClick,accLevel:r.DW.SUPERADMIN,children:(0,i.jsx)(M,{state:a,loadstatus:s,loadingusers:E,rows:w,columns:v,onTextChange:e=>{let{id:i,value:n,checked:r}=e.target,d=void 0!==i?i:"account_level";["emailverified","disabled"].includes(d)&&(n=r),t({...a,[d]:n}),(""!==s.error||""!==s.message||Object.keys(o).filter(e=>""!==o[e]).length>0)&&(l(W),c(F))},onEditStart:function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"create",i=S(h.find(a=>a.uid===e));t(i={...i,mode:a})},handleCreateUser:U,handleDeleteUser:I,handleUpdateUser:A,handleInputClick:e=>{if(e){let{id:i}=e.target;t({...a,[i]:""})}else t(H),l(W);c(F)},inputValidation:o,usersLoadingError:x})})}q.propTypes={loading:l().bool,user:l().object,onBtnLogoutClick:l().func,accLevel:l().number};var G=(0,h.Z)(q)},94459:function(e,a,t){"use strict";t.d(a,{r4:function(){return d},h8:function(){return c},PR:function(){return u},Rf:function(){return m},Nq:function(){return o}});var i=t(9669),s=t.n(i),l=t(15426);class n extends l.Z{async createUser(e){let a={};["email","displayname","password","account_level","disabled","emailverified"].forEach(t=>{if(void 0!==e[t]&&""!==e[t])a[t]=e[t];else throw Error("Please check your input.")});let t=await this.createRequestObject({body:a});return(await s()({...t,url:this.USERS_API,method:"POST"})).data}async updateUser(e){let a={};["uid","email","displayname","password","disabled","emailverified","account_level"].forEach(t=>{if(void 0===e[t.toLowerCase()]||"password"===t||""!==e[t])a[t]=e[t];else throw Error("Please check your input.")});let t=await this.createRequestObject({body:a});return(await s()({...t,url:this.USERS_API,method:"PATCH"})).data}async deleteUser(e){let a=await this.createRequestObject({});return(await s().delete("".concat(this.USERS_API,"/").concat(e),a)).data}async getUser(e){let{uid:a,email:t}=e,i={};a&&(i={uid:a}),t&&(i={email:t});let l=await this.createRequestObject({params:i});return(await s().get("".concat(this.BASE_URL,"/user"),l)).data}constructor(){super(),this.getUsers=async()=>await s().get(this.USERS_API_LIST),this.BASE_URL="https://acap-mimaropa-server.onrender.com/api",this.USERS_API="".concat(this.BASE_URL,"/user"),this.USERS_API_LIST="".concat(this.BASE_URL,"/users")}}let r=new n,d=r.createUser.bind(r),o=r.updateUser.bind(r),c=r.deleteUser.bind(r),u=r.getUser.bind(r),m=r.getUsers.bind(r)}},function(e){e.O(0,[3153,6856,190,8583,1664,6541,955,4073,6455,6080,5837,4723,760,4316,4740,8591,4313,2888,9774,179],function(){return e(e.s=6241)}),_N_E=e.O()}]);