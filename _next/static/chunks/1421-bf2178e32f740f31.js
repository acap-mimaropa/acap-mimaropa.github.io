"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1421],{48414:function(e,t,n){var r=n(85893),a=n(9008),o=n.n(a),i=n(98813);t.Z=function(e){let{title:t,ogDescription:n,ogImageURL:a,ogImgAlt:s="Picture",ogSiteName:l="ACAP-".concat(i.Gt.toUpperCase()),ogURL:c,canonicalURL:d="http://localhost"}=e;return(0,r.jsxs)(o(),{children:[(0,r.jsx)("meta",{name:"description",content:n}),(0,r.jsx)("meta",{rel:"canonical",href:d}),(0,r.jsx)("meta",{name:"og:description",content:n}),(0,r.jsx)("meta",{property:"og:title",content:t}),(0,r.jsx)("meta",{property:"og:site_name",content:l}),(0,r.jsx)("meta",{property:"og:image",content:a}),(0,r.jsx)("meta",{property:"og:image:width",content:"600"}),(0,r.jsx)("meta",{property:"og:image:height",content:"315"}),(0,r.jsx)("meta",{property:"og:image:alt",content:s}),(0,r.jsx)("meta",{property:"og:url",content:c}),(0,r.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,r.jsx)("meta",{name:"twitter:title",content:t}),(0,r.jsx)("meta",{name:"twitter:image",content:a}),(0,r.jsx)("title",{children:t})]})}},44698:function(e,t,n){n.d(t,{Z:function(){return ee}});var r=n(85893),a=n(67294),o=n(18853),i=n(45697),s=n.n(i),l=n(9669),c=n.n(l),d=n(15426),u=n(96171);let p={DELETE_BULLETIN:"".concat("https://acap-mimaropa-server.onrender.com/api","/bulletins")};class m extends d.Z{async deleteBulletin(e){let{type:t,filename:n}=e,r=await this.createRequestObject({body:{type:t,filename:n}});return this.AxiosCancelSource=c().CancelToken.source(),await c()({...r,url:p.DELETE_BULLETIN,method:"DELETE",cancelToken:this.AxiosCancelSource.token})}async getBulletins(e){return await this.FirestoreQuery.getCollectionData(e,"idstr")}cancelAxiosRequest(e){this.AxiosCancelSource.cancel(e)}constructor(...e){super(...e),this.FirestoreQuery=new u.Z,this.AxiosCancelSource=c().CancelToken.source()}}let g=new m,h=g.deleteBulletin.bind(g),x=g.getBulletins.bind(g),f=g.cancelAxiosRequest.bind(g);var E=n(25517),D=n(17585);let L={loading:!1,error:"",status:E.G.IDLE},b=new(n(88002)).d;b.getPageAssetsDoc.bind(b),b.getTyphoonAdvisory.bind(b);let y=b.getPdfDownloadURL.bind(b),v={loading:!1,error:"",status:E.G.IDLE,url:""};var _=n(92246);let S={loading:!1,error:"",status:E.G.IDLE,random:""};var A=n(77527),j=n(38712),I=n(59591),C=n(24022),P=n(29204);let T=(0,A.ZP)(e=>(0,r.jsx)(I.Z,{disableGutters:!0,elevation:0,square:!0,...e}))(e=>{let{theme:t}=e;return{boxShadow:"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px !important","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"}}}),O=(0,A.ZP)(e=>(0,r.jsx)(C.Z,{expandIcon:(0,r.jsx)(j.Z,{sx:{fontSize:"0.9rem"}}),...e}))(e=>{let{theme:t}=e;return{backgroundColor:"dark"===t.palette.mode?"rgba(255, 255, 255, .05)":"rgba(0, 0, 0, .03)","& .MuiAccordionSummary-expandIconWrapper.Mui-expanded":{transform:"rotate(180deg)"},"& .MuiAccordionSummary-content":{marginLeft:t.spacing(1)}}}),R=(0,A.ZP)(P.Z)(e=>{let{theme:t}=e;return{padding:t.spacing(2),borderTop:"1px solid rgba(0, 0, 0, .125)"}});var G=n(97182),w=n(68573),F=n(52857),N=n(96788),Z=n(87300),k=n(61769),U=n(41664),W=n.n(U),B={"& a":{color:e=>e.palette.secondary.main,textDecoration:"none"},"& a:visited":{color:"#000"},"& a:hover, span:hover":{color:e=>e.palette.primary.dark},fontSize:"16px",marginTop:e=>e.spacing(2)},Y=function(e){let{navdata:t}=e;return(0,r.jsx)(Z.Z,{"aria-label":"breadcrumb",sx:B,children:t.map((e,t)=>void 0!==e.href?(0,r.jsx)(W(),{href:e.href,children:(0,r.jsx)(k.Z,{underline:"hover",color:"inherit",children:e.name})},"bcd-".concat(t)):(0,r.jsx)("div",{color:"text.primary",children:e.name},"bcd-".concat(t)))})},z=n(31051),q=n(32539),H=n(47407),M=n(19304),V=n(71687),Q=n(7638),J=n(32200),K={listItem:{"& a":{color:e=>e.palette.text.primary,textDecoration:"none"},"& a:hover":{color:e=>e.palette.third.main,textDecoration:"none"}}};function X(e){let{provinces:t,bulletins:n,isDeleting:a,isFetching:o,isPDFLoading:i,isUser:s,handleClick:l,onDeleteClick:c,subtitle:d=""}=e;return(0,r.jsxs)("div",{role:"presentation",children:[(0,r.jsx)(N.Z,{variant:"h4",children:"Bulletins"}),(0,r.jsx)(N.Z,{variant:"h5",children:d}),(0,r.jsx)(Y,{navdata:[{name:"Bulletins",href:"/bulletins"},{name:d}]}),(0,r.jsx)(w.ZP,{container:!0,justifyContent:"center",sx:{width:"100%",marginTop:e=>e.spacing(6)},children:(0,r.jsx)(w.ZP,{item:!0,xs:10,children:t.map((e,t)=>(0,r.jsxs)(T,{defaultExpanded:0===t,sx:{maxWidth:"720px",..."n/a"===e&&{marginTop:"32px"}},children:[(0,r.jsx)(O,{expandIcon:(0,r.jsx)(z.Z,{}),"aria-controls":"panel1-content",children:(0,r.jsx)(N.Z,{variant:"subtitle1",children:"n/a"!==e?e:"General Special Recommendations"})}),void 0!==n[e]&&(0,r.jsx)(R,{children:n[e].map((e,t)=>(0,r.jsx)(H.Z,{dense:!0,sx:{padding:0},children:(0,r.jsxs)(M.ZP,{children:[(0,r.jsx)(Q.Z,{children:(0,r.jsx)(q.Z,{})}),(0,r.jsx)(J.Z,{sx:K.listItem,primary:(0,r.jsx)("a",{href:"#",disabled:o||a||i,onClick:t=>{t.preventDefault(),o||a||i||l(e.province,e.filename)},children:e.filename}),secondary:"Created on ".concat(e.date_created," ").concat(""!==e.error?"Error: ".concat(e.error):""),primaryTypographyProps:{fontSize:"14px"},secondaryTypographyProps:{fontSize:"11px"}}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,r.jsx)(G.Z,{size:20,color:"third",sx:{display:e.loading&&(o||a||i)?"block":"none"}}),s&&(0,r.jsx)(F.Z,{"aria-label":"delete",color:"primary",disabled:o||a||i,onClick:()=>c(e),children:(0,r.jsx)(V.Z,{})})]})]})},"acc-sub-".concat(t)))})]},"acc-".concat(t)))})})]})}function $(e){let{provinces:t,subtitle:n,currentDefaultBulletin:i}=e,[s,l]=(0,a.useState)(i),c=(0,o.aC)(),{state:d}=function(e){let{type:t,filename:n,action:r}=e,[o,i]=(0,a.useState)(L);return(0,a.useEffect)(()=>()=>{f("Aborting delete bulletin request")},[]),(0,a.useEffect)(()=>{let e=async()=>{try{i(e=>({...e,loading:!0,error:"",status:E.G.PENDING})),await h({type:t,filename:n}),i(e=>({...e,loading:!1,error:"",status:E.G.FULLFILLED}))}catch(e){"Aborting delete bulletin request"!==e.message&&i(t=>{var n;return{...t,loading:!1,error:(null==e?void 0:null===(n=e.response)||void 0===n?void 0:n.data)||e.message,status:E.G.IDLE}})}};n&&r===D.RW.DELETE&&e()},[n,r,t]),{state:o}}(s),{state:u}=function(e){let{filename:t,type:n,urlsegment:r,action:o}=e,[i,s]=(0,a.useState)(v);return(0,a.useEffect)(()=>{let e=()=>{let e="https://acap-mimaropa-server.onrender.com/api";if(!e)throw Error("Missing BASE_API_URL for bulletin download");let r="".concat(e,"/bulletins/download?type=").concat(encodeURIComponent(n),"&filename=").concat(encodeURIComponent(t)),a=document.createElement("a");return a.href=r,a.setAttribute("download",t),a.rel="noopener",a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a),r},a=async()=>{try{s(e=>({...e,loading:!0,error:"",url:"",status:E.G.PENDING}));let e=await y(t,n),a=r&&e.includes(r.keyword)?e.substring(e.indexOf(r.keyword)+r.charlength,e.length).split("?")[0]:t,o=document.createElement("a");o.href=e,o.setAttribute("download",decodeURI(a)),o.rel="noopener",o.target="_blank",document.body.appendChild(o),o.click(),document.body.removeChild(o),s(t=>({...t,loading:!1,url:e,status:E.G.FULLFILLED}))}catch(n){var a,o;let t=(null==n?void 0:null===(a=n.response)||void 0===a?void 0:a.data)||n.message;if((null==n?void 0:n.code)==="storage/unauthorized"||"".concat(t).includes("storage/unauthorized")||(null==n?void 0:null===(o=n.response)||void 0===o?void 0:o.status)===403)try{let t=e();s(e=>({...e,loading:!1,url:t,error:"",status:E.G.FULLFILLED}));return}catch(e){s(n=>({...n,loading:!1,url:"",error:(null==e?void 0:e.message)||t,status:E.G.IDLE}));return}s(e=>({...e,loading:!1,url:"",error:t,status:E.G.IDLE}))}};t&&o===D.RW.DOWNLOAD&&a()},[t,n,r,o]),{state:i}}(s),{state:p,bulletins:m}=function(e){let{currentbulletin:t,statdload:n,statdelete:r,fetch:o}=e,[i,s]=(0,a.useState)(S),[l,c]=(0,a.useState)({}),[d,u]=(0,a.useState)(D.n5),[p,m]=(0,a.useState)(!1),[g,h]=(0,a.useState)(!1),[f,L]=(0,a.useState)("");return(0,a.useEffect)(()=>{let e=!0,n=async()=>{try{s(e=>({...e,loading:!0,error:"",status:E.G.PENDING}));let n=await x(t.collection),r={};n.forEach(e=>{void 0===r[e.province]&&(r[e.province]=[]),r[e.province].push({province:e.province,filename:e.filename,date_created:(0,_.Xn)(e.date_created),loading:!1,error:""})}),e&&(c(r),s(e=>({...e,loading:!1,error:"",status:E.G.FULLFILLED})))}catch(t){e&&s(e=>{var n;return{...e,loading:!1,error:(null==t?void 0:null===(n=t.response)||void 0===n?void 0:n.data)||t.message,status:E.G.IDLE}})}};return o&&e&&n(),()=>{e=!1}},[o,t.collection]),(0,a.useEffect)(()=>{let e=n.status===E.G.PENDING||r.status===E.G.PENDING;h(p!==e),m(e),e||L(t.action===D.RW.DELETE?r.error:n.error)},[n,r,t.action,p]),(0,a.useEffect)(()=>{if(""!==t.province&&""!==t.filename&&u(t),g){let e=""!==t.filename?{...t}:{...d};""!==e.filename&&(e=>{let{province:t,filename:n}=e,r=[...l[t]],a=r.findIndex(e=>e.filename===n);a>=0?(r[a].loading=p,r[a].error=f,c(e=>({...e,[t]:[...r]})),L(""),h(!1)):s(e=>({...e,loading:!1,error:"Index not found.",status:E.G.IDLE}))})({province:e.province,filename:e.filename,loading:p})}},[p,t,d,l,f,g]),{state:i,bulletins:l}}({currentbulletin:s,statdload:u,statdelete:d,fetch:""===s.filename&&""===d.error&&s.action!==D.RW.DOWNLOAD&&[E.G.FULLFILLED,E.G.IDLE].includes(d.status)}),g=(0,a.useMemo)(()=>{if(m&&t)return(null==m?void 0:m["n/a"])?[...t,"n/a"]:t},[m,t]);(0,a.useEffect)(()=>{(d.status===E.G.FULLFILLED||u.status===E.G.FULLFILLED||""!==d.error||""!==u.error)&&""!==s.filename&&l(e=>({...e,filename:"",province:""}))},[d,u,s]);let b=async(e,t)=>{l({...s,filename:t,province:e,action:D.RW.DOWNLOAD})};return(0,r.jsx)(X,{provinces:g,bulletins:m,isDeleting:(null==d?void 0:d.loading)||!1,isFetching:(null==p?void 0:p.loading)||!1,isPDFLoading:(null==u?void 0:u.loading)||!1,isUser:null!==c.user,handleClick:b,onDeleteClick:e=>{let{province:t,filename:n}=e;l({...s,filename:n,province:t,action:D.RW.DELETE})},subtitle:n})}X.propTypes={provinces:s().array,bulletins:s().object,isDeleting:s().bool,isFetching:s().bool,isPDFLoading:s().bool,isUser:s().bool,handleClick:s().func,onDeleteClick:s().func,subtitle:s().string},$.propTypes={provinces:s().array,subtitle:s().string,currentDefaultBulletin:s().object};var ee=$},88002:function(e,t,n){n.d(t,{K:function(){return s},d:function(){return l}});var r=n(96171),a=n(56871),o=n(98813),i=n(84325);let s={MEDIA_ASSETS:"n_page_media",ASSETS:"n_page_assets",PAGE_SEARCH:"n_page_search",GLOBAL_COLLECTIONS:"w_services",TYPHOON_ADVISORY:"typhoon_advisory",CYCLONE_ADVISORY:"cyclone_advisory"};class l extends r.Z{constructor(...e){var t;super(...e),t=this,this.getPageAssetsDoc=async function(e,n){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=[];try{if(!(a=await t.getDocumentData(s.ASSETS,e)))return[];if(!n)return a;if(r)return a.data.filter(e=>e.page===n);return a.data.filter(e=>e.page===n).map(e=>e.url)}catch(e){throw console.error(e.message),Error(e.message)}},this.getTyphoonAdvisory=async()=>{let e=this.doc(this.db,s.GLOBAL_COLLECTIONS,s.TYPHOON_ADVISORY),t=await this.getDoc(e);return t.exists()?t.data():null},this.getWeatherForecast=async(e,t)=>await this.getNestedCollectionData(s.WEATHER_FORECASTS,e,t,"name"),this.getPdfDownloadURL=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.Ry.SEASONAL,n="";switch(t){case i.Ry.SEASONAL:n=o.Do.PDF_STORAGE_SEASONAL;break;case i.Ry.TEN_DAY:n=o.Do.PDF_STORAGE_TENDAY;break;case i.Ry.SPECIAL_WEATHER:n=o.Do.PDF_STORAGE_SPECIAL}try{let t="acap-mimaropa-d77f1.firebasestorage.app";if(t){let r=encodeURIComponent("".concat(n,"/").concat(e));return"https://firebasestorage.googleapis.com/v0/b/".concat(t,"/o/").concat(r,"?alt=media")}let r=(0,a.iH)(a.tO,"".concat(n,"/").concat(e));return await (0,a.Jt)(r)}catch(e){throw Error(e.message)}}}}},17585:function(e,t,n){n.d(t,{Do:function(){return r},RW:function(){return a},n5:function(){return o}});let r={PDF_CROPS:"bulletins_pdf_crops",PDF_CROPS_TENDAY:"bulletins_pdf_tenday",PDF_CROPS_SPECIAL:"bulletins_pdf_special",PDF_STORAGE_TENDAY:"bulletins_tenday",PDF_STORAGE_SPECIAL:"bulletins_special",PDF_STORAGE_SEASONAL:"bulletins_seasonal"},a={DELETE:"delete",DOWNLOAD:"download",IDLE:"idle"},o={action:a.IDLE,type:"",collection:r.PDF_CROPS,filename:"",province:"",keyword:""}}}]);