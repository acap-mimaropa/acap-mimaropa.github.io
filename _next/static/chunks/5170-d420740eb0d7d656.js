"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5170],{48414:function(e,t,n){var r=n(85893),o=n(9008),a=n.n(o),i=n(98813);t.Z=function(e){let{title:t,ogDescription:n,ogImageURL:o,ogImgAlt:l="Picture",ogSiteName:s="ACAP-".concat(i.Gt.toUpperCase()),ogURL:c,canonicalURL:d="http://localhost"}=e;return(0,r.jsxs)(a(),{children:[(0,r.jsx)("meta",{name:"description",content:n}),(0,r.jsx)("meta",{rel:"canonical",href:d}),(0,r.jsx)("meta",{name:"og:description",content:n}),(0,r.jsx)("meta",{property:"og:title",content:t}),(0,r.jsx)("meta",{property:"og:site_name",content:s}),(0,r.jsx)("meta",{property:"og:image",content:o}),(0,r.jsx)("meta",{property:"og:image:width",content:"600"}),(0,r.jsx)("meta",{property:"og:image:height",content:"315"}),(0,r.jsx)("meta",{property:"og:image:alt",content:l}),(0,r.jsx)("meta",{property:"og:url",content:c}),(0,r.jsx)("meta",{name:"twitter:card",content:"summary_large_image"}),(0,r.jsx)("meta",{name:"twitter:title",content:t}),(0,r.jsx)("meta",{name:"twitter:image",content:o}),(0,r.jsx)("title",{children:t})]})}},20257:function(e,t,n){n.d(t,{Z:function(){return M}});var r=n(85893),o=n(67294),a=n(18853),i=n(45697),l=n.n(i),s=n(9669),c=n.n(s),d=n(15426),u=n(96171);let p={DELETE_BULLETIN:"".concat("https://acap-mimaropa-server.onrender.com/api","/bulletins")};class m extends d.Z{async deleteBulletin(e){let{type:t,filename:n}=e,r=await this.createRequestObject({body:{type:t,filename:n}});return this.AxiosCancelSource=c().CancelToken.source(),await c()({...r,url:p.DELETE_BULLETIN,method:"DELETE",cancelToken:this.AxiosCancelSource.token})}async getBulletins(e){return await this.FirestoreQuery.getCollectionData(e,"idstr")}cancelAxiosRequest(e){this.AxiosCancelSource.cancel(e)}constructor(...e){super(...e),this.FirestoreQuery=new u.Z,this.AxiosCancelSource=c().CancelToken.source()}}let h=new m,g=h.deleteBulletin.bind(h),f=h.getBulletins.bind(h),E=h.cancelAxiosRequest.bind(h);var v=n(25517),b=n(17585);let D={loading:!1,error:"",status:v.G.IDLE},y=new(n(88002)).d;y.getPageAssetsDoc.bind(y),y.getTyphoonAdvisory.bind(y);let L=y.getPdfDownloadURL.bind(y),x={loading:!1,error:"",status:v.G.IDLE,url:""};var _=n(92246);let S={loading:!1,error:"",status:v.G.IDLE,random:""};var A=n(88607),C=n(28907),I=n(97182),j=n(68573),O=n(52857),P=n(96788),T=n(87300),R=n(61769),G=n(41664),w=n.n(G),F={"& a":{color:e=>e.palette.secondary.main,textDecoration:"none"},"& a:visited":{color:"#000"},"& a:hover, span:hover":{color:e=>e.palette.primary.dark},fontSize:"16px",marginTop:e=>e.spacing(2)},N=function(e){let{navdata:t}=e;return(0,r.jsx)(T.Z,{"aria-label":"breadcrumb",sx:F,children:t.map((e,t)=>void 0!==e.href?(0,r.jsx)(w(),{href:e.href,children:(0,r.jsx)(R.Z,{underline:"hover",color:"inherit",children:e.name})},"bcd-".concat(t)):(0,r.jsx)("div",{color:"text.primary",children:e.name},"bcd-".concat(t)))})},k=n(32539),Z=n(47407),U=n(19304),B=n(71687),W=n(7638),Y=n(32200),z={listItem:{"& a":{color:e=>e.palette.text.primary,textDecoration:"none"},"& a:hover":{color:e=>e.palette.third.main,textDecoration:"none"}}};function H(e){let{provinces:t,bulletins:n,isDeleting:a,isFetching:i,isPDFLoading:l,isUser:s,handleClick:c,onDeleteClick:d,subtitle:u,groupByCrop:p=!1}=e,[m,h]=(0,o.useState)(0),[g,f]=(0,o.useState)(0);(0,o.useEffect)(()=>{f(0)},[m]);let E=t[m],v=E?null==n?void 0:n[E]:null,b=p&&v?Object.keys(v):[],D=p?b[g]:null,y=p?D?null==v?void 0:v[D]:[]:v;return(0,r.jsxs)("div",{role:"presentation",children:[(0,r.jsx)(P.Z,{variant:"h4",children:"Bulletins"}),(0,r.jsx)(P.Z,{variant:"h5",children:u}),(0,r.jsx)(N,{navdata:[{name:"Bulletins",href:"/bulletins"},{name:u}]}),(0,r.jsx)(j.ZP,{container:!0,justifyContent:"center",sx:{width:"100%",marginTop:e=>e.spacing(6)},children:(0,r.jsxs)(j.ZP,{item:!0,xs:12,children:[(0,r.jsx)(A.Z,{value:m,onChange:(e,t)=>{h(t)},variant:"scrollable",scrollButtons:"auto","aria-label":"province tabs",sx:{borderBottom:1,borderColor:"divider",mb:2},children:t.map((e,t)=>(0,r.jsx)(C.Z,{label:"n/a"!==e?e:"General Special Recommendations",sx:{fontWeight:m===t?700:400,color:m===t?"primary.main":"text.primary",minWidth:120}},"tab-".concat(t)))}),p&&b.length>0&&(0,r.jsx)(A.Z,{value:g,onChange:(e,t)=>{f(t)},variant:"scrollable",scrollButtons:"auto","aria-label":"crop tabs",sx:{borderBottom:1,borderColor:"divider",mb:2},children:b.map((e,t)=>(0,r.jsx)(C.Z,{label:e,sx:{fontWeight:g===t?700:400,color:g===t?"primary.main":"text.primary",minWidth:120}},"crop-tab-".concat(t)))}),E&&y&&y.length>0&&(0,r.jsx)(Z.Z,{dense:!0,sx:{padding:0},children:y.map((e,t)=>(0,r.jsxs)(U.ZP,{children:[(0,r.jsx)(W.Z,{children:(0,r.jsx)(k.Z,{})}),(0,r.jsx)(Y.Z,{sx:z.listItem,primary:(0,r.jsx)("a",{href:"#",disabled:i||a||l,onClick:t=>{t.preventDefault(),i||a||l||c(e.province,e.filename)},children:e.filename}),secondary:"Created on ".concat(e.date_created," ").concat(""!==e.error?"Error: ".concat(e.error):""),primaryTypographyProps:{fontSize:"14px"},secondaryTypographyProps:{fontSize:"11px"}}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,r.jsx)(I.Z,{size:20,color:"third",sx:{display:e.loading&&(i||a||l)?"block":"none"}}),s&&(0,r.jsx)(O.Z,{"aria-label":"delete",color:"primary",disabled:i||a||l,onClick:()=>d(e),children:(0,r.jsx)(B.Z,{})})]})]},"acc-sub-".concat(t)))})]})})]})}function q(e){let{provinces:t,subtitle:n,currentDefaultBulletin:i,groupByCrop:l=!1}=e,[s,c]=(0,o.useState)(i),d=(0,a.aC)(),{state:u}=function(e){let{type:t,filename:n,action:r}=e,[a,i]=(0,o.useState)(D);return(0,o.useEffect)(()=>()=>{E("Aborting delete bulletin request")},[]),(0,o.useEffect)(()=>{let e=async()=>{try{i(e=>({...e,loading:!0,error:"",status:v.G.PENDING})),await g({type:t,filename:n}),i(e=>({...e,loading:!1,error:"",status:v.G.FULLFILLED}))}catch(e){"Aborting delete bulletin request"!==e.message&&i(t=>{var n;return{...t,loading:!1,error:(null==e?void 0:null===(n=e.response)||void 0===n?void 0:n.data)||e.message,status:v.G.IDLE}})}};n&&r===b.RW.DELETE&&e()},[n,r,t]),{state:a}}(s),{state:p}=function(e){let{filename:t,type:n,urlsegment:r,action:a}=e,[i,l]=(0,o.useState)(x);return(0,o.useEffect)(()=>{let e=()=>{let e="https://acap-mimaropa-server.onrender.com/api";if(!e)throw Error("Missing BASE_API_URL for bulletin download");let r="".concat(e,"/bulletins/download?type=").concat(encodeURIComponent(n),"&filename=").concat(encodeURIComponent(t)),o=document.createElement("a");return o.href=r,o.setAttribute("download",t),o.rel="noopener",o.target="_blank",document.body.appendChild(o),o.click(),document.body.removeChild(o),r},o=async()=>{try{l(e=>({...e,loading:!0,error:"",url:"",status:v.G.PENDING}));let e=await L(t,n),o=r&&e.includes(r.keyword)?e.substring(e.indexOf(r.keyword)+r.charlength,e.length).split("?")[0]:t,a=document.createElement("a");a.href=e,a.setAttribute("download",decodeURI(o)),a.rel="noopener",a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a),l(t=>({...t,loading:!1,url:e,status:v.G.FULLFILLED}))}catch(n){var o,a;let t=(null==n?void 0:null===(o=n.response)||void 0===o?void 0:o.data)||n.message;if((null==n?void 0:n.code)==="storage/unauthorized"||"".concat(t).includes("storage/unauthorized")||(null==n?void 0:null===(a=n.response)||void 0===a?void 0:a.status)===403)try{let t=e();l(e=>({...e,loading:!1,url:t,error:"",status:v.G.FULLFILLED}));return}catch(e){l(n=>({...n,loading:!1,url:"",error:(null==e?void 0:e.message)||t,status:v.G.IDLE}));return}l(e=>({...e,loading:!1,url:"",error:t,status:v.G.IDLE}))}};t&&a===b.RW.DOWNLOAD&&o()},[t,n,r,a]),{state:i}}(s),{state:m,bulletins:h}=function(e){let{currentbulletin:t,statdload:n,statdelete:r,fetch:a,groupByCrop:i=!1}=e,[l,s]=(0,o.useState)(S),[c,d]=(0,o.useState)({}),[u,p]=(0,o.useState)(b.n5),[m,h]=(0,o.useState)(!1),[g,E]=(0,o.useState)(!1),[D,y]=(0,o.useState)("");return(0,o.useEffect)(()=>{let e=!0,n=async()=>{try{s(e=>({...e,loading:!0,error:"",status:v.G.PENDING}));let n=await f(t.collection),r={};n.forEach(e=>{void 0===r[e.province]&&(r[e.province]=i?{}:[]);let t={province:e.province,crop:e.crop||"Unknown",filename:e.filename,date_created:(0,_.Xn)(e.date_created),loading:!1,error:""};i?(r[e.province][t.crop]||(r[e.province][t.crop]=[]),r[e.province][t.crop].push(t)):r[e.province].push(t)}),e&&(d(r),s(e=>({...e,loading:!1,error:"",status:v.G.FULLFILLED})))}catch(t){e&&s(e=>{var n;return{...e,loading:!1,error:(null==t?void 0:null===(n=t.response)||void 0===n?void 0:n.data)||t.message,status:v.G.IDLE}})}};return a&&e&&n(),()=>{e=!1}},[a,t.collection]),(0,o.useEffect)(()=>{let e=n.status===v.G.PENDING||r.status===v.G.PENDING;E(m!==e),h(e),e||y(t.action===b.RW.DELETE?r.error:n.error)},[n,r,t.action,m]),(0,o.useEffect)(()=>{if(""!==t.province&&""!==t.filename&&p(t),g){let e=""!==t.filename?{...t}:{...u};""!==e.filename&&(e=>{let{province:t,filename:n}=e,r=c[t];if(!r){s(e=>({...e,loading:!1,error:"Province not found.",status:v.G.IDLE}));return}if(i){let e={...r},o=!1;if(Object.keys(e).forEach(t=>{let r=[...e[t]],a=r.findIndex(e=>e.filename===n);a>=0&&(r[a].loading=m,r[a].error=D,e[t]=r,o=!0)}),o){d(n=>({...n,[t]:e})),y(""),E(!1);return}}else{let e=[...r],o=e.findIndex(e=>e.filename===n);if(o>=0){e[o].loading=m,e[o].error=D,d(n=>({...n,[t]:[...e]})),y(""),E(!1);return}}s(e=>({...e,loading:!1,error:"Index not found.",status:v.G.IDLE}))})({province:e.province,filename:e.filename,loading:m})}},[m,t,u,c,D,g]),{state:l,bulletins:c}}({currentbulletin:s,statdload:p,statdelete:u,groupByCrop:l,fetch:""===s.filename&&""===u.error&&s.action!==b.RW.DOWNLOAD&&[v.G.FULLFILLED,v.G.IDLE].includes(u.status)}),y=(0,o.useMemo)(()=>{if(h&&t)return(null==h?void 0:h["n/a"])?[...t,"n/a"]:t},[h,t]);(0,o.useEffect)(()=>{(u.status===v.G.FULLFILLED||p.status===v.G.FULLFILLED||""!==u.error||""!==p.error)&&""!==s.filename&&c(e=>({...e,filename:"",province:""}))},[u,p,s]);let A=async(e,t)=>{c({...s,filename:t,province:e,action:b.RW.DOWNLOAD})};return(0,r.jsx)(H,{provinces:y,bulletins:h,isDeleting:(null==u?void 0:u.loading)||!1,isFetching:(null==m?void 0:m.loading)||!1,isPDFLoading:(null==p?void 0:p.loading)||!1,isUser:null!==d.user,handleClick:A,onDeleteClick:e=>{let{province:t,filename:n}=e;c({...s,filename:n,province:t,action:b.RW.DELETE})},subtitle:n,groupByCrop:l})}H.propTypes={provinces:l().array,bulletins:l().object,isDeleting:l().bool,isFetching:l().bool,isPDFLoading:l().bool,isUser:l().bool,handleClick:l().func,onDeleteClick:l().func,subtitle:l().string,groupByCrop:l().bool},q.propTypes={provinces:l().array,subtitle:l().string,currentDefaultBulletin:l().object,groupByCrop:l().bool};var M=q},88002:function(e,t,n){n.d(t,{K:function(){return l},d:function(){return s}});var r=n(96171),o=n(56871),a=n(98813),i=n(84325);let l={MEDIA_ASSETS:"n_page_media",ASSETS:"n_page_assets",PAGE_SEARCH:"n_page_search",GLOBAL_COLLECTIONS:"w_services",TYPHOON_ADVISORY:"typhoon_advisory",CYCLONE_ADVISORY:"cyclone_advisory"};class s extends r.Z{constructor(...e){var t;super(...e),t=this,this.getPageAssetsDoc=async function(e,n){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=[];try{if(!(o=await t.getDocumentData(l.ASSETS,e)))return[];if(!n)return o;if(r)return o.data.filter(e=>e.page===n);return o.data.filter(e=>e.page===n).map(e=>e.url)}catch(e){throw console.error(e.message),Error(e.message)}},this.getTyphoonAdvisory=async()=>{let e=this.doc(this.db,l.GLOBAL_COLLECTIONS,l.TYPHOON_ADVISORY),t=await this.getDoc(e);return t.exists()?t.data():null},this.getWeatherForecast=async(e,t)=>await this.getNestedCollectionData(l.WEATHER_FORECASTS,e,t,"name"),this.getPdfDownloadURL=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.Ry.SEASONAL,n="";switch(t){case i.Ry.SEASONAL:n=a.Do.PDF_STORAGE_SEASONAL;break;case i.Ry.TEN_DAY:n=a.Do.PDF_STORAGE_TENDAY;break;case i.Ry.SPECIAL_WEATHER:n=a.Do.PDF_STORAGE_SPECIAL}try{let t="acap-mimaropa-d77f1.firebasestorage.app";if(t){let r=encodeURIComponent("".concat(n,"/").concat(e));return"https://firebasestorage.googleapis.com/v0/b/".concat(t,"/o/").concat(r,"?alt=media")}let r=(0,o.iH)(o.tO,"".concat(n,"/").concat(e));return await (0,o.Jt)(r)}catch(e){throw Error(e.message)}}}}},17585:function(e,t,n){n.d(t,{Do:function(){return r},RW:function(){return o},n5:function(){return a}});let r={PDF_CROPS:"bulletins_pdf_crops",PDF_CROPS_TENDAY:"bulletins_pdf_tenday",PDF_CROPS_SPECIAL:"bulletins_pdf_special",PDF_STORAGE_TENDAY:"bulletins_tenday",PDF_STORAGE_SPECIAL:"bulletins_special",PDF_STORAGE_SEASONAL:"bulletins_seasonal"},o={DELETE:"delete",DOWNLOAD:"download",IDLE:"idle"},a={action:o.IDLE,type:"",collection:r.PDF_CROPS,filename:"",province:"",keyword:""}}}]);